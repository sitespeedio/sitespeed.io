function createHAR(e,t,n,r,i){var s=[];r.forEach(function(t){var n=t.request,r=t.startReply,i=t.endReply;if(!n||!r||!i){return}if(n.url.match(/(^data:image\/.*)/i)){return}s.push({startedDateTime:n.time.toISOString(),time:i.time-n.time,request:{method:n.method,url:n.url,httpVersion:"HTTP/1.1",cookies:[],headers:n.headers,queryString:[],headersSize:-1,bodySize:-1},response:{status:i.status,statusText:i.statusText,httpVersion:"HTTP/1.1",cookies:[],headers:i.headers,redirectURL:"",headersSize:-1,bodySize:r.bodySize,content:{size:r.bodySize,mimeType:i.contentType}},cache:{},timings:{blocked:0,dns:-1,connect:-1,send:0,wait:r.time-n.time,receive:i.time-r.time,ssl:-1},pageref:e})});return{log:{version:"1.2",creator:{name:"PhantomJS",version:phantom.version.major+"."+phantom.version.minor+"."+phantom.version.patch},pages:[{startedDateTime:n.toISOString(),id:e,title:t,pageTimings:{onLoad:i}}],entries:s}}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){function e(e){return e<10?"0"+e:e}function t(e){return e<10?"00"+e:e<100?"0"+e:e}return this.getFullYear()+"-"+e(this.getMonth()+1)+"-"+e(this.getDate())+"T"+e(this.getHours())+":"+e(this.getMinutes())+":"+e(this.getSeconds())+"."+t(this.getMilliseconds())+"Z"}}var resourceWait=1e3,maxRenderWait=2e4,count=0,forcedRenderTimeout,renderTimeout;var i,arg,page,urlCount,viewport,webpage=require("webpage"),args=phantom.args,len=args.length,urls=[],yslowArgs={info:"all",format:"json",ruleset:"ydefault",beacon:false,ua:false,viewport:false,headers:false,console:0,threshold:80,harfilename:""},unaryArgs={help:false,version:false,dict:false,verbose:false},argsAlias={i:"info",f:"format",r:"ruleset",h:"help",V:"version",d:"dict",u:"ua",vp:"viewport",c:"console",b:"beacon",v:"verbose",t:"threshold",ch:"headers",n:"harfilename"};for(i=0;i<len;i+=1){arg=args[i];if(arg[0]!=="-"){if(arg.indexOf("http")!==0){arg="http://"+arg}urls.push(arg)}arg=arg.replace(/^\-\-?/,"");if(yslowArgs.hasOwnProperty(arg)){i+=1;yslowArgs[arg]=args[i]}else{if(yslowArgs.hasOwnProperty(argsAlias[arg])){i+=1;yslowArgs[argsAlias[arg]]=args[i]}else{if(unaryArgs.hasOwnProperty(arg)){unaryArgs[arg]=true}else{if(unaryArgs.hasOwnProperty(argsAlias[arg])){unaryArgs[argsAlias[arg]]=true}}}}}urlCount=urls.length;if(unaryArgs.version){console.log("3.1.8");phantom.exit()}if(len===0||urlCount===0||unaryArgs.help){console.log(["","  Usage: phantomjs [phantomjs options] "+phantom.scriptName+" [yslow options] [url ...]","","  PhantomJS Options:","","    http://y.ahoo.it/phantomjs/options","","  YSlow Options:","","    -h, --help               output usage information","    -V, --version            output the version number","    -i, --info <info>        specify the information to display/log (basic|grade|stats|comps|all) [all]","    -f, --format <format>    specify the output results format (json|xml|plain|tap|junit) [json]","    -r, --ruleset <ruleset>  specify the YSlow performance ruleset to be used (ydefault|yslow1|yblog) [ydefault]","    -b, --beacon <url>       specify an URL to log the results","    -d, --dict               include dictionary of results fields","    -v, --verbose            output beacon response information","    -t, --threshold <score>  for test formats, the threshold to test scores ([0-100]|[A-F]|{JSON}) [80]",'                             e.g.: -t B or -t 75 or -t \'{"overall": "B", "ycdn": "F", "yexpires": 85}\'','    -u, --ua "<user agent>"  specify the user agent string sent to server when the page requests resources',"    -vp, --viewport <WxH>    specify page viewport size WxY, where W = width and H = height [400x300]",'    -ch, --headers <JSON>    specify custom request headers, e.g.: -ch \'{"Cookie": "foo=bar"}\'',"    -c, --console <level>    output page console messages (0: none, 1: message, 2: message + line + source) [0]","    -n, --harfilename <filename>    the name of the HAR file, if no name is supplied, no HAR is created","","  Examples:","","    phantomjs "+phantom.scriptName+" http://yslow.org","    phantomjs "+phantom.scriptName+" -i grade -f xml www.yahoo.com www.cnn.com www.nytimes.com","    phantomjs "+phantom.scriptName+' -info all --format plain --ua "MSIE 9.0" http://yslow.org',"    phantomjs "+phantom.scriptName+" -i basic --rulseset yslow1 -d http://yslow.org","    phantomjs "+phantom.scriptName+" -i grade -b http://www.showslow.com/beacon/yslow/ -v yslow.org","    phantomjs --load-plugins=yes "+phantom.scriptName+" -vp 800x600 http://www.yahoo.com","    phantomjs "+phantom.scriptName+" -i grade -f tap -t 85 http://yslow.org",""].join("\n"));phantom.exit()}yslowArgs.dict=unaryArgs.dict;yslowArgs.verbose=unaryArgs.verbose;urls.forEach(function(e){function n(){var e,n,r,s,o,u,a,f=t.startTime,l=t.resources;o=new Date-f;t.title=t.evaluate(function(){return document.title});har=createHAR(t.address,t.title,t.startTime,t.harresources,o);var h=require("fs");if(yslowArgs.harfilename.length>0){if(!h.exists(yslowArgs.harfilename)){h.write(yslowArgs.harfilename,JSON.stringify(har,undefined,4),"w")}}for(u in l){if(l.hasOwnProperty(u)){a=l[u].response;if(a){a.time=new Date(a.time)-f}}}e=function(){function t(e,t){return(~~e||0)>=(t||0)}if(typeof YSLOW==="undefined"){YSLOW={}}YSLOW.DEBUG=true;YSLOW.registerRule=function(e){YSLOW.controller.addRule(e)};YSLOW.registerRuleset=function(e){YSLOW.controller.addRuleset(e)};YSLOW.registerRenderer=function(e){YSLOW.controller.addRenderer(e)};YSLOW.registerTool=function(e){YSLOW.Tools.addCustomTool(e)};YSLOW.addEventListener=function(e,t,n){YSLOW.util.event.addListener(e,t,n)};YSLOW.removeEventListener=function(e,t){return YSLOW.util.event.removeListener(e,t)};YSLOW.Error=function(e,t){this.name=e;this.message=t};YSLOW.Error.prototype={toString:function(){return this.name+"\n"+this.message}};YSLOW.version="3.1.8";YSLOW.ComponentSet=function(e,t){this.root_node=e;this.components=[];this.outstanding_net_request=0;this.component_info=[];this.onloadTimestamp=t;this.nextID=1;this.notified_fetch_done=false};YSLOW.ComponentSet.prototype={clear:function(){this.components=[];this.component_info=[];this.cleared=true;if(this.outstanding_net_request>0){YSLOW.util.dump("YSLOW.ComponentSet.Clearing component set before all net requests finish.")}},addComponent:function(e,t,n,r){var i,s,o;if(!e){if(!this.empty_url){this.empty_url=[]}this.empty_url[t]=(this.empty_url[t]||0)+1}if(e&&t){if(!YSLOW.ComponentSet.isValidProtocol(e)||!YSLOW.ComponentSet.isValidURL(e)){return i}e=YSLOW.util.makeAbsoluteUrl(e,n);e=YSLOW.util.escapeHtml(e);s=typeof this.component_info[e]!=="undefined";o=t==="doc";if(!s||o){this.component_info[e]={state:"NONE",count:s?this.component_info[e].count:0};i=new YSLOW.Component(e,t,this,r);if(i){i.id=this.nextID+=1;this.components[this.components.length]=i;if(!this.doc_comp&&o){this.doc_comp=i}if(this.component_info[e].state==="NONE"){this.component_info[e].state="REQUESTED";this.outstanding_net_request+=1}}else{this.component_info[e].state="ERROR";YSLOW.util.event.fire("componentFetchError")}}this.component_info[e].count+=1}return i},addComponentNoDuplicate:function(e,t,n){if(e&&t){e=YSLOW.util.escapeHtml(e);e=YSLOW.util.makeAbsoluteUrl(e,n);if(this.component_info[e]===undefined){return this.addComponent(e,t,n)}}},getComponentsByType:function(e,t,n){var r,i,s,o,u,a,f,l=this.components,c=this.component_info,h=[],p={};if(typeof t==="undefined"){t=!YSLOW.util.Preference.getPref("excludeAfterOnload",true)}if(typeof n==="undefined"){n=!YSLOW.util.Preference.getPref("excludeBeaconsFromLint",true)}if(typeof e==="string"){p[e]=1}else{for(r=0,s=e.length;r<s;r+=1){u=e[r];if(u){p[u]=1}}}for(r=0,s=l.length;r<s;r+=1){a=l[r];if(!a||a&&!p[a.type]||a.is_beacon&&!n||a.after_onload&&!t){continue}h[h.length]=a;f=c[r];if(!f||f&&f.count<=1){continue}for(i=1,o=f.count;i<o;i+=1){h[h.length]=a}}return h},getProgress:function(){var e,t=0,n=0;for(e in this.component_info){if(this.component_info.hasOwnProperty(e)&&this.component_info[e]){if(this.component_info[e].state==="RECEIVED"){n+=1}t+=1}}return{total:t,received:n}},onComponentGetInfoStateChange:function(e){var t,n,r;if(e){if(typeof e.comp!=="undefined"){t=e.comp}if(typeof e.state!=="undefined"){n=e.state}}if(typeof this.component_info[t.url]==="undefined"){YSLOW.util.dump("YSLOW.ComponentSet.onComponentGetInfoStateChange(): Unexpected component: "+t.url);return}if(this.component_info[t.url].state==="NONE"&&n==="DONE"){this.component_info[t.url].state="RECEIVED"}else{if(this.component_info[t.url].state==="REQUESTED"&&n==="DONE"){this.component_info[t.url].state="RECEIVED";this.outstanding_net_request-=1;if(this.outstanding_net_request===0){this.notified_fetch_done=true;YSLOW.util.event.fire("componentFetchDone",{component_set:this})}}else{YSLOW.util.dump("Unexpected component info state: ["+t.type+"]"+t.url+"state: "+n+" comp_info_state: "+this.component_info[t.url].state)}}r=this.getProgress();YSLOW.util.event.fire("componentFetchProgress",{total:r.total,current:r.received,last_component_url:t.url})},notifyPeelDone:function(){if(this.outstanding_net_request===0&&!this.notified_fetch_done){this.notified_fetch_done=true;YSLOW.util.event.fire("componentFetchDone",{component_set:this})}},setSimpleAfterOnload:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;if(t){d=t.docBody;v=t.doc;m=t.components;g=t.components}else{d=this.doc_comp&&this.doc_comp.body;v=this.root_node;m=this.components;g=this}if(!d){YSLOW.util.dump("doc body is empty");return e(g)}s=v.createElement("div");s.innerHTML=d;o=s.getElementsByTagName("*");for(n=0,h=m.length;n<h;n+=1){i=m[n];c=i.type;if(c==="cssimage"||c==="doc"){continue}a=false;f=i.url;for(r=0,p=o.length;!a&&r<p;r+=1){l=o[r];u=l.src||l.href||l.getAttribute("src")||l.getAttribute("href")||l.nodeName==="PARAM"&&l.value;a=u===f}i.after_onload=!a}e(g)},setAfterOnload:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v=YSLOW.util,m=v.addEventListener,g=v.removeEventListener,y=setTimeout,b=clearTimeout,w=[],E={},S=function(e){var t,n,r,i,u;b(s);t=e.type;n=e.attrName;r=e.target;i=r.src||r.href||r.getAttribute&&(r.getAttribute("src")||r.getAttribute("href"));u=r.dataOldSrc;if(i&&(t==="DOMNodeInserted"||t==="DOMSubtreeModified"&&i!==u||t==="DOMAttrModified"&&(n==="src"||n==="href"))&&!E[i]){E[i]=1;w.push(r)}s=y(o,1e3)},x=function(){var e,t,n,a,f;b(u);n=r.getElementsByTagName("*");for(e=0,t=n.length;e<t;e+=1){a=n[e];f=a.src||a.href;if(f){a.dataOldSrc=f}}m(i,"DOMSubtreeModified",S);m(i,"DOMNodeInserted",S);m(i,"DOMAttrModified",S);s=y(o,3e3);p=y(o,1e4)};if(t){a=YSLOW.ComponentSet.prototype;f=t.docBody;l=t.doc;c=t.components;h=c}else{a=this;f=a.doc_comp&&a.doc_comp.body;l=a.root_node;c=a.components;h=a}if(typeof MutationEvent==="undefined"||YSLOW.antiIframe){return a.setSimpleAfterOnload(e,t)}if(!f){v.dump("doc body is empty");return e(h)}o=function(){var t,r,o,u,a,f,l;if(d){return}b(p);b(s);g(i,"DOMSubtreeModified",S);g(i,"DOMNodeInserted",S);g(i,"DOMAttrModified",S);g(n,"load",x);g(i,"load",x);for(t=0,o=w.length;t<o;t+=1){a=w[t];f=a.src||a.href||a.getAttribute&&(a.getAttribute("src")||a.getAttribute("href"));if(!f){continue}for(r=0,u=c.length;r<u;r+=1){l=c[r];if(l.url===f){l.after_onload=true}}}n.parentNode.removeChild(n);d=1;e(h)};n=l.createElement("iframe");n.style.cssText="position:absolute;top:-999em;";l.body.appendChild(n);i=n.contentWindow;u=y(o,3e3);if(i){r=i.document}else{i=r=n.contentDocument}m(i,"load",x);m(n,"load",x);r.open().write(f);r.close();m(i,"load",x)}};YSLOW.ComponentSet.validProtocols=["http","https","ftp"];YSLOW.ComponentSet.isValidProtocol=function(e){var t,n,r,i=this.validProtocols,s=i.length;e=e.toLowerCase();n=e.indexOf(":");if(n>0){r=e.substr(0,n);for(t=0;t<s;t+=1){if(r===i[t]){return true}}}return false};YSLOW.ComponentSet.isValidURL=function(e){var t,n;e=e.toLowerCase();t=e.split(":");if(t[0]==="http"||t[0]==="https"){if(t[1].substr(0,2)!=="//"){return false}n=t[1].substr(2);if(n.length===0||n.indexOf("/")===0){return false}}return true};YSLOW.Component=function(e,t,n,r){var i=r&&r.obj,s=r&&r.comp||{};this.url=e;this.type=t;this.parent=n;this.headers={};this.raw_headers="";this.req_headers=null;this.body="";this.compressed=false;this.expires=undefined;this.size=0;this.status=0;this.is_beacon=false;this.method="unknown";this.cookie="";this.respTime=null;this.after_onload=false;this.object_prop=undefined;if(t===undefined){this.type="unknown"}this.get_info_state="NONE";if(i&&t==="image"&&i.width&&i.height){this.object_prop={width:i.width,height:i.height}}if(s.containerNode){this.containerNode=s.containerNode}this.setComponentDetails(r)};YSLOW.Component.prototype.getInfoState=function(){return this.get_info_state};YSLOW.Component.prototype.populateProperties=function(e,t){var n,r,i,s,o,u,a,f=this,l=null,c="undefined";if(f.headers.location&&e&&f.headers.location!==f.url){n=f.parent.addComponentNoDuplicate(f.headers.location,f.type!=="redirect"?f.type:"unknown",f.url);if(n&&f.after_onload){n.after_onload=true}f.type="redirect"}s=f.headers["content-length"];r=YSLOW.util.trim(f.headers["content-encoding"]);if(r==="gzip"||r==="deflate"){f.compressed=r;f.size=f.body.length?f.body.length:l;if(s){f.size_compressed=parseInt(s,10)||s}else{if(typeof f.nsize!==c){f.size_compressed=f.nsize}else{f.size_compressed=Math.round(f.size/3)}}}else{f.compressed=false;f.size_compressed=l;if(s){f.size=parseInt(s,10)}else{if(typeof f.nsize!==c){f.size=parseInt(f.nsize,10)}else{f.size=f.body.length}}}if(!f.size){if(typeof f.nsize!==c){f.size=f.nsize}else{f.size=f.body.length}}f.uncompressed_size=f.body.length;if(f.getMaxAge()!==undefined){f.expires=f.getMaxAge()}else{if(f.headers.expires&&f.headers.expires.length>0){f.expires=new Date(f.headers.expires)}}if(f.type==="image"&&!t){if(typeof Image!==c){u=new Image}else{u=document.createElement("img")}if(f.body.length){o="data:"+f.headers["content-type"]+";base64,"+YSLOW.util.base64Encode(f.body);a=1}else{o=f.url}u.onerror=function(){u.onerror=l;if(a){u.src=f.url}};u.onload=function(){u.onload=l;if(u&&u.width&&u.height){if(f.object_prop){f.object_prop.actual_width=u.width;f.object_prop.actual_height=u.height}else{f.object_prop={width:u.width,height:u.height,actual_width:u.width,actual_height:u.height}}if(u.width<2&&u.height<2){f.is_beacon=true}}};u.src=o}};YSLOW.Component.prototype.hasOldModifiedDate=function(){var e=Number(new Date),t=this.headers["last-modified"];if(typeof t!=="undefined"){return e-Number(new Date(t))>24*60*60*1e3}return false};YSLOW.Component.prototype.hasFarFutureExpiresOrMaxAge=function(){var e,t=Number(new Date),n=YSLOW.util.Preference.getPref("minFutureExpiresSeconds",2*24*60*60),r=n*1e3;if(typeof this.expires==="object"){e=Number(this.expires);if(e-t>r){return true}}return false};YSLOW.Component.prototype.getEtag=function(){return this.headers.etag||""};YSLOW.Component.prototype.getMaxAge=function(){var e,t,n,r=this.headers["cache-control"];if(r){e=r.indexOf("max-age");if(e>-1){t=parseInt(r.substring(e+8),10);if(t>0){n=YSLOW.util.maxAgeToDate(t)}}}return n};YSLOW.Component.prototype.getSetCookieSize=function(){var e,t,n=0;if(this.headers&&this.headers["set-cookie"]){e=this.headers["set-cookie"].split("\n");if(e.length>0){for(t=0;t<e.length;t+=1){n+=e[t].length}}}return n};YSLOW.Component.prototype.getReceivedCookieSize=function(){var e,t,n=0;if(this.cookie&&this.cookie.length>0){e=this.cookie.split("\n");if(e.length>0){for(t=0;t<e.length;t+=1){n+=e[t].length}}}return n};YSLOW.Component.prototype.setComponentDetails=function(e){var t=this,n=function(e,n){var r;t.ttfb=n.starttime-e.starttime;t.status=n.status;t.headers={};t.raw_headers="";n.headers.forEach(function(e){t.headers[e.name.toLowerCase()]=e.value;t.raw_headers+=e.name+": "+e.value+"\n"});t.req_headers={};e.headers.forEach(function(e){t.req_headers[e.name.toLowerCase()]=e.value});t.method=e.method;if(n.contentText){t.body=n.contentText}else{try{r=new XMLHttpRequest;r.open("GET",t.url,false);r.send();t.body=r.responseText}catch(i){t.body={toString:function(){return""},length:n.bodySize||0}}}t.response_type=t.type;t.cookie=(t.headers["set-cookie"]||"")+(t.req_headers.cookie||"");t.nsize=parseInt(t.headers["content-length"],10)||n.bodySize;t.respTime=n.time;t.after_onload=(new Date(e.time)).getTime()>t.parent.onloadTimestamp;t.populateProperties(false,true);t.get_info_state="DONE";t.parent.onComponentGetInfoStateChange({comp:t,state:"DONE"})};if(e.request&&e.response){n(e.request,e.response)}};YSLOW.controller={rules:{},rulesets:{},onloadTimestamp:null,renderers:{},default_ruleset_id:"ydefault",run_pending:0,init:function(){var e,t,n,r;YSLOW.util.event.addListener("onload",function(e){this.onloadTimestamp=e.time;YSLOW.util.setTimer(function(){YSLOW.controller.run_pending_event()})},this);YSLOW.util.event.addListener("onUnload",function(e){this.run_pending=0;this.onloadTimestamp=null},this);e=YSLOW.util.Preference.getPrefList("customRuleset.",undefined);if(e&&e.length>0){for(t=0;t<e.length;t+=1){r=e[t].value;if(typeof r==="string"&&r.length>0){n=JSON.parse(r,null);n.custom=true;this.addRuleset(n)}}}this.default_ruleset_id=YSLOW.util.Preference.getPref("defaultRuleset","ydefault");this.loadRulePreference()},run:function(e,t,n){var r,i,s=e.document;if(!s||!s.location||s.location.href.indexOf("about:")===0||"undefined"===typeof s.location.hostname){if(!n){i="Please enter a valid website address before running YSlow.";YSLOW.ysview.openDialog(YSLOW.ysview.panel_doc,389,150,i,"","Ok")}return}if(!t.PAGE.loaded){this.run_pending={win:e,yscontext:t};return}YSLOW.util.event.fire("peelStart",undefined);r=YSLOW.peeler.peel(s,this.onloadTimestamp);t.component_set=r;YSLOW.util.event.fire("peelComplete",{component_set:r});r.notifyPeelDone()},run_pending_event:function(){if(this.run_pending){this.run(this.run_pending.win,this.run_pending.yscontext,false);this.run_pending=0}},lint:function(e,t,n){var r,i,s,o,u,a,f,l=[],c=[],h=0,p=0,d=this,v=d.rulesets,m=d.default_ruleset_id;if(n){l=v[n]}else{if(m&&v[m]){l=v[m]}else{for(s in v){if(v.hasOwnProperty(s)&&v[s]){l=v[s];break}}}}i=l.rules;for(s in i){if(i.hasOwnProperty(s)&&i[s]&&this.rules.hasOwnProperty(s)){try{r=this.rules[s];o=YSLOW.util.merge(r.config,i[s]);u=r.lint(e,t.component_set,o);a=l.weights?l.weights[s]:undefined;if(a!==undefined){a=parseInt(a,10)}if(a===undefined||a<0||a>100){if(v.ydefault.weights[s]){a=v.ydefault.weights[s]}else{a=5}}u.weight=a;if(u.score!==undefined){if(typeof u.score!=="number"){f=parseInt(u.score,10);if(!isNaN(f)){u.score=f}}if(typeof u.score==="number"){p+=u.weight;if(!YSLOW.util.Preference.getPref("allowNegativeScore",false)){if(u.score<0){u.score=0}if(typeof u.score!=="number"){u.score=-1}}if(u.score!==0){h+=u.score*(typeof u.weight!=="undefined"?u.weight:1)}}}u.name=r.name;u.category=r.category;u.rule_id=s;c[c.length]=u}catch(g){YSLOW.util.dump("YSLOW.controller.lint: "+s,g);YSLOW.util.event.fire("lintError",{rule:s,message:g})}}}t.PAGE.overallScore=h/(p>0?p:1);t.result_set=new YSLOW.ResultSet(c,t.PAGE.overallScore,l);t.result_set.url=t.component_set.doc_comp.url;YSLOW.util.event.fire("lintResultReady",{yslowContext:t});return t.result_set},runTool:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d=YSLOW.Tools.getTool(e);try{if(typeof d==="object"){r=d.run(t.document,t.component_set,n);if(d.print_output){i="";if(typeof r==="object"){i=r.html}else{if(typeof r==="string"){i=r}}s=YSLOW.util.getNewDoc();p=s.body||s.documentElement;p.innerHTML=i;o=s.getElementsByTagName("head")[0];if(typeof r.css==="undefined"){a="chrome://yslow/content/yslow/tool.css";f=new XMLHttpRequest;f.open("GET",a,false);f.send(null);u=f.responseText}else{u=r.css}if(typeof u==="string"){l=s.createElement("style");l.setAttribute("type","text/css");l.appendChild(s.createTextNode(u));o.appendChild(l)}if(typeof r.js!=="undefined"){c=s.createElement("script");c.setAttribute("type","text/javascript");c.appendChild(s.createTextNode(r.js));o.appendChild(c)}if(typeof r.plot_component!=="undefined"&&r.plot_component===true){YSLOW.renderer.plotComponents(s,t)}}}else{h=e+" is not a tool.";YSLOW.util.dump(h);YSLOW.util.event.fire("toolError",{tool_id:e,message:h})}}catch(v){YSLOW.util.dump("YSLOW.controller.runTool: "+e,v);YSLOW.util.event.fire("toolError",{tool_id:e,message:v})}},render:function(e,t,n){var r=this.renderers[e],i="";if(r.supports[t]!==undefined&&r.supports[t]===1){switch(t){case"components":i=r.componentsView(n.comps,n.total_size);break;case"reportcard":i=r.reportcardView(n.result_set);break;case"stats":i=r.statsView(n.stats);break;case"tools":i=r.toolsView(n.tools);break;case"rulesetEdit":i=r.rulesetEditView(n.rulesets);break}}return i},getRenderer:function(e){return this.renderers[e]},addRule:function(e){var t,n,r=["id","name","config","info","lint"];if(YSLOW.doc.rules&&YSLOW.doc.rules[e.id]){n=YSLOW.doc.rules[e.id];if(n.name){e.name=n.name}if(n.info){e.info=n.info}}for(t=0;t<r.length;t+=1){if(typeof e[r[t]]==="undefined"){throw new YSLOW.Error("Interface error","Improperly implemented rule interface")}}if(this.rules[e.id]!==undefined){throw new YSLOW.Error("Rule register error",e.id+" is already defined.")}this.rules[e.id]=e},addRuleset:function(e,t){var n,r=["id","name","rules"];for(n=0;n<r.length;n+=1){if(typeof e[r[n]]==="undefined"){throw new YSLOW.Error("Interface error","Improperly implemented ruleset interface")}if(this.checkRulesetName(e.id)&&t!==true){throw new YSLOW.Error("Ruleset register error",e.id+" is already defined.")}}this.rulesets[e.id]=e},removeRuleset:function(e){var t=this.rulesets[e];if(t&&t.custom===true){delete this.rulesets[e];if(this.default_ruleset_id===e){this.default_ruleset_id="ydefault";YSLOW.util.Preference.setPref("defaultRuleset",this.default_ruleset_id)}return t}return null},saveRulesetToPref:function(e){if(e.custom===true){YSLOW.util.Preference.setPref("customRuleset."+e.id,JSON.stringify(e,null,2))}},deleteRulesetFromPref:function(e){if(e.custom===true){YSLOW.util.Preference.deletePref("customRuleset."+e.id)}},getRuleset:function(e){return this.rulesets[e]},addRenderer:function(e){this.renderers[e.id]=e},getRegisteredRuleset:function(){return this.rulesets},getRegisteredRules:function(){return this.rules},getRule:function(e){return this.rules[e]},checkRulesetName:function(e){var t,n,r=this.rulesets;e=e.toLowerCase();for(t in r){if(r.hasOwnProperty(t)){n=r[t];if(n.id.toLowerCase()===e||n.name.toLowerCase()===e){return true}}}return false},setDefaultRuleset:function(e){if(this.rulesets[e]!==undefined){this.default_ruleset_id=e;YSLOW.util.Preference.setPref("defaultRuleset",e)}},getDefaultRuleset:function(){if(this.rulesets[this.default_ruleset_id]===undefined){this.setDefaultRuleset("ydefault")}return this.rulesets[this.default_ruleset_id]},getDefaultRulesetId:function(){return this.default_ruleset_id},loadRulePreference:function(){var e=this.getRule("yexpires"),t=YSLOW.util.Preference.getPref("minFutureExpiresSeconds",2*24*60*60);if(t>0&&e){e.config.howfar=t}}};YSLOW.util={merge:function(e,t){var n,r={};for(n in e){if(e.hasOwnProperty(n)){r[n]=e[n]}}for(n in t){if(t.hasOwnProperty(n)){r[n]=t[n]}}return r},dump:function(){var e;if(!YSLOW.DEBUG){return}e=Array.prototype.slice.apply(arguments);e=e&&e.length===1?e[0]:e;try{if(typeof Firebug!=="undefined"&&Firebug.Console&&Firebug.Console.log){Firebug.Console.log(e)}else{if(typeof Components!=="undefined"&&Components.classes&&Components.interfaces){Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService).logStringMessage(JSON.stringify(e,null,2))}}}catch(t){try{console.log(e)}catch(n){}}},filter:function(e,t,n){var r,i=n?[]:{};for(r in e){if(e.hasOwnProperty(r)&&t(r,e[r])){i[n?i.length:r]=e[r]}}return i},expires_month:{Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12},prettyExpiresDate:function(e){var t;if(Object.prototype.toString.call(e)==="[object Date]"&&e.toString()!=="Invalid Date"&&!isNaN(e)){t=e.getMonth()+1;return e.getFullYear()+"/"+t+"/"+e.getDate()}else{if(!e){return"no expires"}}return"invalid date object"},maxAgeToDate:function(e){var t=new Date;t=t.getTime()+parseInt(e,10)*1e3;return new Date(t)},plural:function(e,t){var n,r=e,i={are:["are","is"],s:["s",""],"do":["do","does"],num:[t,t]};for(n in i){if(i.hasOwnProperty(n)){r=r.replace(new RegExp("%"+n+"%","gm"),t===1?i[n][1]:i[n][0])}}return r},countExpressions:function(e){var t=0,n;n=e.indexOf("expression(");while(n!==-1){t+=1;n=e.indexOf("expression(",n+1)}return t},countAlphaImageLoaderFilter:function(e){var t,n,r,i,s=0,o=0,u={};t=e.indexOf("filter:");while(t!==-1){r=false;if(t>0&&e.charAt(t-1)==="_"){r=true}n=e.indexOf(";",t+7);if(n!==-1){i=e.substring(t+7,n);if(i.indexOf("AlphaImageLoader")!==-1){if(r){o+=1}else{s+=1}}}t=e.indexOf("filter:",t+1)}if(o>0){u.hackFilter=o}if(s>0){u.filter=s}return u},getHostname:function(e){var t=e.split("/")[2];return t&&t.split(":")[0]||""},getUniqueDomains:function(e,t){var n,r,i,s={},o=[];for(n=0,r=e.length;n<r;n+=1){i=e[n].url.split("/");if(i[2]){s[i[2].split(":")[0]]=1}}for(n in s){if(s.hasOwnProperty(n)){if(!t){o.push(n)}else{i=n.split(".");if(isNaN(parseInt(i[i.length-1],10))){o.push(n)}}}}return o},summaryByDomain:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p={},d=[];t=[].concat(t);l=t.length;for(r=0,s=e.length;r<s;r+=1){f=e[r];o=f.url.split("/");if(o[2]){u=o[2].split(":")[0];a=p[u];if(!a){a={domain:u,count:0};p[u]=a}a.count+=1;for(i=0;i<l;i+=1){c=t[i];h=a["sum_"+c]||0;h+=parseInt(f[c],10)||0;a["sum_"+c]=h}}}for(a in p){if(p.hasOwnProperty(a)){if(!n){d.push(p[a])}else{o=a.split(".");if(isNaN(parseInt(o[o.length-1],10))){d.push(p[a])}}}}return d},isMinified:function(e){var t=e.length,n;if(t===0){return true}n=e.replace(/\n| {2}|\t|\r/g,"").length;if((t-n)/t>.2){return false}return true},isETagGood:function(e){var t=/^[0-9a-f]+:([1-9a-f]|[0-9a-f]{2,})$/,n=/^[0-9a-f]+\-[0-9a-f]+\-[0-9a-f]+$/;if(!e){return true}e=e.replace(/^["']|["'][\s\S]*$/g,"");return!(n.test(e)||t.test(e))},getComponentType:function(e){var t="unknown";if(e&&typeof e==="string"){if(e==="text/html"||e==="text/plain"){t="doc"}else{if(e==="text/css"){t="css"}else{if(/javascript/.test(e)){t="js"}else{if(/flash/.test(e)){t="flash"}else{if(/image/.test(e)){t="image"}else{if(/font/.test(e)){t="font"}}}}}}}return t},base64Encode:function(e){var t,n,r,i,s="",o=0,u=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];for(t=0;t<e.length;t+=3){n=e.charCodeAt(t);if(t+1<e.length){r=e.charCodeAt(t+1)}else{r=0;o+=1}if(t+2<e.length){i=e.charCodeAt(t+2)}else{i=0;o+=1}s+=u[(n&252)>>2];s+=u[(n&3)<<4|(r&240)>>4];if(o>0){s+="="}else{s+=u[(r&15)<<2|(i&192)>>6]}if(o>1){s+="="}else{s+=u[i&63]}}return s},getXHR:function(){var e=0,t=null,n=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];if(typeof XMLHttpRequest==="function"){return new XMLHttpRequest}for(e=0;e<n.length;e+=1){try{t=new ActiveXObject(n[e]);break}catch(r){}}return t},getComputedStyle:function(e,t,n){var r,i,s="";if(e.currentStyle){s=e.currentStyle[t]}if(e.ownerDocument&&e.ownerDocument.defaultView&&document.defaultView.getComputedStyle){r=e.ownerDocument.defaultView.getComputedStyle(e,"");if(r){s=r[t]}}if(!n){return s}if(typeof s!=="string"){return false}i=s.match(/\burl\((\'|\"|)([^\'\"]+?)\1\)/);if(i){return i[2]}else{return false}},escapeHtml:function(e){return(e||"").toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")},escapeQuotes:function(e,t){if(t==="single"){return e.replace(/\'/g,"\\'")}if(t==="double"){return e.replace(/\"/g,'\\"')}return e.replace(/\'/g,"\\'").replace(/\"/g,'\\"')},formatHeaderName:function(){var e={"content-md5":"Content-MD5",dnt:"DNT",etag:"ETag",p3p:"P3P",te:"TE","www-authenticate":"WWW-Authenticate","x-att-deviceid":"X-ATT-DeviceId","x-cdn":"X-CDN","x-ua-compatible":"X-UA-Compatible","x-xss-protection":"X-XSS-Protection"};return function(t){var n=t.toLowerCase();if(e.hasOwnProperty(n)){return e[n]}else{return n.replace(/(^|-)([a-z])/g,function(e,t,n){return t+n.toUpperCase()})}}}(),mod:function(e,t){return Math.round(e-Math.floor(e/t)*t)},briefUrl:function(e,t){var n,r,i,s;t=t||100;if(e===undefined){return""}n=e.indexOf("//");if(-1!==n){r=e.indexOf("?");if(-1!==r){e=e.substring(0,r)+"?..."}if(e.length>t){i=e.indexOf("/",n+2);s=e.lastIndexOf("/");if(-1!==i&&-1!==s&&i!==s){e=e.substring(0,i+1)+"..."+e.substring(s)}else{e=e.substring(0,t+1)+"..."}}}return e},prettyAnchor:function(e,t,n,r,i,s,o){var u,a="",f="",l=0;if(typeof t==="undefined"){t=e}if(typeof n==="undefined"){n=""}else{n=' class="'+n+'"'}if(typeof i==="undefined"){i=100}if(typeof s==="undefined"){s=1}o=o?' rel="'+o+'"':"";t=YSLOW.util.escapeHtml(t);e=YSLOW.util.escapeHtml(e);u=YSLOW.util.escapeQuotes(t,"double");if(r){e=YSLOW.util.briefUrl(e,i);a=' title="'+u+'"'}while(0<e.length){f+="<a"+o+n+a+' href="'+u+'" onclick="javascript:document.ysview.openLink(\''+YSLOW.util.escapeQuotes(t)+"'); return false;\">"+e.substring(0,i);e=e.substring(i);l+=1;if(l>=s){if(0<e.length){f+="[snip]"}f+="</a>";break}else{f+="</a><font style='font-size: 0px;'> </font>"}}return f},kbSize:function(e){var t=e%(e>100?100:10);e-=t;return parseFloat(e/1e3)+(0===e%1e3?".0":"")+"K"},prettyTypes:{image:"Image",doc:"HTML/Text",cssimage:"CSS Image",css:"Stylesheet File",js:"JavaScript File",flash:"Flash Object",iframe:"IFrame",xhr:"XMLHttpRequest",redirect:"Redirect",favicon:"Favicon",unknown:"Unknown"},prettyType:function(e){return YSLOW.util.prettyTypes[e]},prettyScore:function(e){var t="F";if(!parseInt(e,10)&&e!==0){return e}if(e===-1){return"N/A"}if(e>=90){t="A"}else{if(e>=80){t="B"}else{if(e>=70){t="C"}else{if(e>=60){t="D"}else{if(e>=50){t="E"}}}}}return t},getResults:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=/ <button [\s\S]+<\/button>/,C=YSLOW.util,k=C.isArray,L={},A={},O=[],M={},_={};t=(t||"basic").split(",");for(n=0,v=t.length;n<v;n+=1){if(t[n]==="all"){m=y=g=true;break}else{switch(t[n]){case"grade":m=true;break;case"stats":y=true;break;case"comps":g=true;break}}}M.v=YSLOW.version;M.w=parseInt(e.PAGE.totalSize,10);M.o=parseInt(e.PAGE.overallScore,10);M.u=encodeURIComponent(e.result_set.url);M.r=parseInt(e.PAGE.totalRequests,10);E=C.getPageSpaceid(e.component_set);if(E){M.s=encodeURI(E)}M.i=e.result_set.getRulesetApplied().id;if(e.PAGE.t_done){M.lt=parseInt(e.PAGE.t_done,10)}if(m){i=e.result_set.getResults();for(n=0,v=i.length;n<v;n+=1){l={};b=i[n];if(b.hasOwnProperty("score")){if(b.score>=0){l.score=parseInt(b.score,10)}else{if(b.score===-1){l.score="n/a"}}}l.message=b.message.replace(/javascript:document\.ysview\.openLink\('(.+)'\)/,"$1");u=b.components;if(k(u)){l.components=[];for(r=0,w=u.length;r<w;r+=1){a=u[r];if(typeof a==="string"){s=a}else{if(typeof a.url==="string"){s=a.url}}if(s){s=encodeURIComponent(s.replace(N,""));l.components.push(s)}}}_[b.rule_id]=l}M.g=_}if(y){M.w_c=parseInt(e.PAGE.totalSizePrimed,10);M.r_c=parseInt(e.PAGE.totalRequestsPrimed,10);for(o in e.PAGE.totalObjCount){if(e.PAGE.totalObjCount.hasOwnProperty(o)){L[o]={r:e.PAGE.totalObjCount[o],w:e.PAGE.totalObjSize[o]}}}M.stats=L;for(o in e.PAGE.totalObjCountPrimed){if(e.PAGE.totalObjCountPrimed.hasOwnProperty(o)){A[o]={r:e.PAGE.totalObjCountPrimed[o],w:e.PAGE.totalObjSizePrimed[o]}}}M.stats_c=A}if(g){u=e.component_set.components;for(n=0,v=u.length;n<v;n+=1){a=u[n];f=encodeURIComponent(a.url);l={type:a.type,url:f,size:a.size,resp:a.respTime};if(a.size_compressed){l.gzip=a.size_compressed}if(a.expires&&a.expires instanceof Date){l.expires=C.prettyExpiresDate(a.expires)}c=a.getReceivedCookieSize();if(c>0){l.cr=c}h=a.getSetCookieSize();if(h>0){l.cs=h}p=a.getEtag();if(typeof p==="string"&&p.length>0){l.etag=p}l.headers={};if(a.req_headers){x=a.req_headers;l.headers.request={};T=l.headers.request;for(S in x){if(x.hasOwnProperty(S)){T[C.formatHeaderName(S)]=x[S]}}}if(a.headers){x=a.headers;l.headers.response={};T=l.headers.response;for(S in x){if(x.hasOwnProperty(S)){T[C.formatHeaderName(S)]=x[S]}}}O.push(l)}M.comps=O}return M},sendBeacon:function(e,t,n){var r,i,s,o,u,a="",f=YSLOW.util,l=f.Preference,c="get";t=(t||"basic").split(",");for(r=0,i=t.length;r<i;r+=1){if(t[r]==="all"){c="post";break}else{switch(t[r]){case"grade":c="post";break;case"stats":c="post";break;case"comps":c="post";break}}}if(c==="post"){a=JSON.stringify(e,null);s=f.getXHR();s.open("POST",n,true);s.setRequestHeader("Content-Length",a.length);s.setRequestHeader("Content-Type","application/json");s.send(a)}else{for(o in e){if(e.hasOwnProperty(o)){a+=o+"="+e[o]+"&"}}u=new Image;u.src=n+"?"+a}return a},getDict:function(e,t){var n,r,i,s,o,u,a,f=YSLOW,l=f.controller,c=f.doc.rules,h={v:"version",w:"size",o:"overall score",u:"url",r:"total number of requests",s:"space id of the page",i:"id of the ruleset used",lt:"page load time",grades:"100 >= A >= 90 > B >= 80 > C >= 70 > D >= 60 > E >= 50 > F >= 0 > N/A = -1"};e=(e||"basic").split(",");t=t||"ydefault";u=l.rulesets[t].weights;for(n=0,r=e.length;n<r;n+=1){if(e[n]==="all"){i=s=o=true;break}else{switch(e[n]){case"grade":i=true;break;case"stats":s=true;break;case"comps":o=true;break}}}if(i){h.g="scores of all rules in the ruleset";h.rules={};for(a in u){if(u.hasOwnProperty(a)){h.rules[a]=c[a];h.rules[a].weight=u[a]}}}if(s){h.w_c="page weight with primed cache";h.r_c="number of requests with primed cache";h.stats="number of requests and weight grouped by component type";h.stats_c="number of request and weight of components group by component type with primed cache"}if(o){h.comps="array of all the components found on the page"}return h},isObject:function(e){return Object.prototype.toString.call(e).indexOf("Object")>-1},isArray:function(e){if(Array.isArray){return Array.isArray(e)}else{return Object.prototype.toString.call(e).indexOf("Array")>-1}},decodeURIComponent:function(e){try{return decodeURIComponent(e)}catch(t){return e}},decodeEntities:function(e){return String(e).replace(/&/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},safeXML:function(){var e=this.decodeURIComponent,t=/[<&>]/;return function(n,r){if(r){n=e(n)}if(t.test(n)){return"<![CDATA["+n+"]]>"}return n}}(),objToXML:function(e,t){var n,r=YSLOW.util,i=r.safeXML,s='<?xml version="1.0" encoding="UTF-8"?>';n=function(e){var t,o,u,a,f,l;for(t in e){if(e.hasOwnProperty(t)){o=e[t];s+="<"+t+">";if(r.isArray(o)){for(u=0,a=o.length;u<a;u+=1){f=o[u];l=typeof f;s+="<item>";if(l==="string"||l==="number"){s+=i(f,t==="components")}else{n(f)}s+="</item>"}}else{if(r.isObject(o)){n(o)}else{s+=i(o,t==="u"||t==="url")}}s+="</"+t+">"}}};t=t||"results";s+="<"+t+">";n(e);s+="</"+t+">";return s},prettyPrintResults:function(e){var t,n=YSLOW.util,r="",i={},s={v:"version",w:"size",o:"overall score",u:"url",r:"# of requests",s:"space id",i:"ruleset",lt:"page load time",g:"scores",w_c:"page size (primed cache)",r_c:"# of requests (primed cache)",stats:"statistics by component",stats_c:"statistics by component (primed cache)",comps:"components found on the page",components:"offenders",cr:"received cookie size",cs:"set cookie size",resp:"response time"},o=function(e){var t,n=i[e];if(typeof n==="undefined"){t=[];t.length=4*e+1;i[e]=n=t.join(" ")}return n};t=function(e,i){var u,a,f,l,c,h;for(u in e){if(e.hasOwnProperty(u)){a=e[u];r+=o(i)+(s[u]||u)+":";if(n.isArray(a)){r+="\n";for(f=0,l=a.length;f<l;f+=1){c=a[f];h=typeof c;if(h==="string"||h==="number"){r+=o(i+1)+n.decodeURIComponent(c)+"\n"}else{t(c,i+1);if(f<l-1){r+="\n"}}}}else{if(n.isObject(a)){r+="\n";t(a,i+1)}else{if(u==="score"||u==="o"){a=n.prettyScore(a)+" ("+a+")"}if(u==="w"||u==="w_c"||u==="size"||u==="gzip"||u==="cr"||u==="cs"){a=n.kbSize(a)+" ("+a+" bytes)"}r+=" "+n.decodeURIComponent(a)+"\n"}}}}};t(e,0);return r},testResults:function(e,t){var n,r,i,s,o,u,a,f,l=[],c={a:90,b:80,c:70,d:60,e:50,f:0,"n/a":-1},h=YSLOW,p=h.util,d=p.isObject(t),v=h.doc.rules,m=function(e){var t=parseInt(e,10);if(isNaN(t)&&typeof e==="string"){t=c[e.toLowerCase()]}if(t===0){return 0}return t||n||c.b},g=function(e){if(u){return u}if(!d){u=m(t);return u}else{if(t.hasOwnProperty(e)){return m(t[e])}else{return n||c.b}}},y=function(e,t,n,r,i){var s=v.hasOwnProperty(n)&&v[n].name;l.push({ok:e>=t,score:e,grade:p.prettyScore(e),name:n,description:s||"",message:r,offenders:i})};n=g("overall");y(e.o,n,"overall score");s=e.g;if(s){for(i in s){if(s.hasOwnProperty(i)){r=s[i];o=r.score;if(typeof o==="undefined"){o=-1}y(o,g(i),i,r.message,r.components)}}}return l},formatAsTAP:function(e){var t,n,r,i,s,o,u=0,a=e.length,f=[],l=YSLOW.util,c=l.decodeURIComponent;f.push("TAP version 13");f.push("1.."+a);for(t=0;t<a;t+=1){n=e[t];r=n.ok||n.score<0?"ok":"not ok";u+=n.ok||n.score<0?0:1;r+=" "+(t+1)+" "+n.grade+" ("+n.score+") "+n.name;if(n.description){r+=": "+n.description}if(n.score<0){r+=" # SKIP score N/A"}f.push(r);if(n.message){f.push("  ---");f.push("  message: "+n.message)}i=n.offenders;if(i){o=i.length;if(o>0){if(!n.message){f.push("  ---")}f.push("  offenders:");for(s=0;s<o;s+=1){f.push('    - "'+c(i[s])+'"')}}}if(n.message||o>0){f.push("  ...")}}return{failures:u,content:f.join("\n")}},formatAsJUnit:function(e){var t,n,r,i,s,o,u=e.length,a=0,f=0,l=[],c=[],h=YSLOW.util,p=h.decodeURIComponent,d=h.safeXML,v=function(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};for(t=0;t<u;t+=1){n=e[t];r='    <testcase name="'+v(n.name+(n.description?": "+n.description:""))+'"';r+=' status="'+n.grade+" ("+n.score+")";if(n.ok){c.push(r+'"/>')}else{c.push(r+'">');if(n.score<0){a+=1;c.push("      <skipped>score N/A</skipped>")}else{f+=1}r="      <failure";if(n.message){r+=' message="'+v(n.message)+'"'}i=n.offenders;if(i){c.push(r+">");o=i.length;for(s=0;s<o;s+=1){c.push("        "+d(p(i[s])))}c.push("      </failure>")}else{c.push(r+"/>")}c.push("    </testcase>")}}l.push('<?xml version="1.0" encoding="UTF-8" ?>');l.push("<testsuites>");r='  <testsuite name="YSlow" tests="'+u+'"';if(f){r+=' failures="'+f+'"'}if(a){r+=' skipped="'+a+'"'}r+=">";l.push(r);l=l.concat(c);l.push("  </testsuite>");l.push("</testsuites>");return{failures:f,content:l.join("\n")}},getPageSpaceid:function(e){var t,n,r,i,s,o,u,a,f=/^\d+$/,l=e.getComponentsByType("doc");if(l[0]&&typeof l[0].body==="string"&&l[0].body.length>0){t=l[0].body;n=["%2fE%3d","/S=","SpaceID=","?f="," sid="];r=["%2fR%3d",":"," ","&"," "];for(i=0;i<n.length;i+=1){s=n[i];if(-1!==t.indexOf(s)){o=t.indexOf(s)+s.length;u=t.indexOf(r[i],o);if(-1!==u&&u-o<15){a=t.substring(o,u);if(f.test(a)){return a}}}}}return""},loadCSS:function(e,t){var n;if(!t){YSLOW.util.dump("YSLOW.util.loadCSS: doc is not specified");return""}n=t.createElement("link");n.rel="stylesheet";n.type="text/css";n.href=e;t.body.appendChild(n);return n},openLink:function(e){if(YSLOW.util.Preference.getPref("browser.link.open_external")===3){gBrowser.selectedTab=gBrowser.addTab(e)}else{window.open(e," blank")}},smushIt:function(e,t){var n,r=this.getSmushUrl(),i=r+"/ws.php?img="+encodeURIComponent(e),s=YSLOW.util.getXHR();s.open("GET",i,true);s.onreadystatechange=function(e){n=e?e.target:s;if(n.readyState===4){t(JSON.parse(n.responseText))}};s.send(null)},getSmushUrl:function(){var e="http://www.smushit.com/ysmush.it";return YSLOW.util.Preference.getPref("smushItURL",e)+"/"},getNewDoc:function(){var e=null,t=new XMLHttpRequest;getBrowser().selectedTab=getBrowser().addTab("about:blank");e=window;t.open("get","about:blank",false);t.overrideMimeType("text/html");t.send(null);return e.content.document},makeAbsoluteUrl:function(e,t){var n,r,i,s;if(typeof e==="string"&&t){n=t.indexOf("://");s=t.slice(0,4);if(e.indexOf("://")<0&&(s==="http"||s==="file")){if(e.slice(0,1)==="/"){r=t.indexOf("/",n+3);if(r>-1){e=t.slice(0,r)+e}else{e=t+e}}else{i=t.lastIndexOf("/");if(i>n+3){e=t.slice(0,i+1)+e}else{e=t+"/"+e}}}}return e},preventDefault:function(e){if(typeof e.preventDefault==="function"){e.preventDefault()}else{e.returnValue=false}},trim:function(e){try{return e&&e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}catch(t){return e}},addEventListener:function(e,t,n){var r=YSLOW.util;if(e.addEventListener){r.addEventListener=function(e,t,n){e.addEventListener(t,n,false)}}else{if(e.attachEvent){r.addEventListener=function(e,t,n){e.attachEvent("on"+t,n)}}else{r.addEventListener=function(e,t,n){e["on"+t]=n}}}r.addEventListener(e,t,n)},removeEventListener:function(e,t,n){var r=YSLOW.util;if(e.removeEventListener){r.removeEventListener=function(e,t,n){e.removeEventListener(t,n,false)}}else{if(e.detachEvent){r.removeEventListener=function(e,t,n){e.detachEvent("on"+t,n)}}else{r.removeEventListener=function(e,t,n){delete e["on"+t]}}}r.removeEventListener(e,t,n)},getCurrentTarget:function(e){return e.currentTarget||e.srcElement},getTarget:function(e){return e.target||e.srcElement},getInlineTags:function(e,t,n){var r,i,s=function(e,t,n){var r,i,s,o,u=[];if(!e){return u}s=e.getElementsByTagName(t);for(r=0,i=s.length;r<i;r+=1){o=s[r];if(!o.src){u.push({contentNode:n,body:o.innerHTML})}}return u};t=t||e&&e.getElementsByTagName("head")[0];n=n||e&&e.getElementsByTagName("body")[0];r=s(t,"style","head");r=r.concat(s(n,"style","body"));i=s(t,"script","head");i=i.concat(s(n,"script","body"));return{styles:r,scripts:i}},countDOMElements:function(e){return e&&e.getElementsByTagName("*").length||0},getDocCookies:function(e){return e&&e.cookie||""},setInjected:function(e,t,n){var r,i,s,o,u,a,f,l,c={};if(!n){return t}if(typeof e.createElement==="function"){l=e.createElement("div");l.innerHTML=n}else{l=e}s=l.getElementsByTagName("script");for(r=0,i=s.length;r<i;r+=1){o=s[r];u=o.src||o.getAttribute("src");if(u){c[u]={defer:o.defer||o.getAttribute("defer"),async:o.async||o.getAttribute("async")}}}s=l.getElementsByTagName("link");for(r=0,i=s.length;r<i;r+=1){o=s[r];u=o.href||o.getAttribute("href");if(u&&(o.rel==="stylesheet"||o.type==="text/css")){c[u]=1}}s=l.getElementsByTagName("iframe");for(r=0,i=s.length;r<i;r+=1){o=s[r];u=o.src||o.getAttribute("src");if(u){c[u]=1}}s=l.getElementsByTagName("embed");for(r=0,i=s.length;r<i;r+=1){o=s[r];u=o.src||o.getAttribute("src");if(u){c[u]=1}}s=l.getElementsByTagName("param");for(r=0,i=s.length;r<i;r+=1){o=s[r];u=o.value||o.getAttribute("value");if(u){c[u]=1}}s=l.getElementsByTagName("img");for(r=0,i=s.length;r<i;r+=1){o=s[r];u=o.src||o.getAttribute("src");if(u){c[u]=1}}for(r=0,i=t.length;r<i;r+=1){a=t[r];if(a.type==="js"||a.type==="css"||a.type==="flash"||a.type==="flash"||a.type==="image"){f=c[a.url];a.injected=!f;if(a.type==="js"&&f){a.defer=f.defer;a.async=f.async}}}return t},setTimer:function(e,t){setTimeout(e,t)}};YSLOW.util.event={subscribers:{},addListener:function(e,t,n){var r=this.subscribers,i=r[e];if(!i){i=r[e]=[]}i.push({callback:t,that:n})},removeListener:function(e,t){var n,r=this.subscribers[e],i=r&&r.length||0;for(n=0;n<i;n+=1){if(r[n].callback===t){r.splice(n,1);return true}}return false},fire:function(e,t){var n,r;if(typeof this.subscribers[e]==="undefined"){return false}for(n=0;n<this.subscribers[e].length;n+=1){r=this.subscribers[e][n];try{r.callback.call(r.that,t)}catch(i){}}return true}};YSLOW.util.Preference={nativePref:null,registerNative:function(e){this.nativePref=e},getPref:function(e,t){if(this.nativePref){return this.nativePref.getPref(e,t)}return t},getPrefList:function(e,t){if(this.nativePref){return this.nativePref.getPrefList(e,t)}return t},setPref:function(e,t){if(this.nativePref){this.nativePref.setPref(e,t)}},deletePref:function(e){if(this.nativePref){this.nativePref.deletePref(e)}}};YSLOW.doc={tools_desc:undefined,view_names:{},splash:{},rules:{},tools:{},components_legend:{},addRuleInfo:function(e,t,n){if(typeof e==="string"&&typeof t==="string"&&typeof n==="string"){this.rules[e]={name:t,info:n}}},addToolInfo:function(e,t,n){if(typeof e==="string"&&typeof t==="string"&&typeof n==="string"){this.tools[e]={name:t,info:n}}}};YSLOW.doc.addRuleInfo("ynumreq","Make fewer HTTP requests","Decreasing the number of components on a page reduces the number of HTTP requests required to render the page, resulting in faster page loads.  Some ways to reduce the number of components include:  combine files, combine multiple scripts into one script, combine multiple CSS files into one style sheet, and use CSS Sprites and image maps.");YSLOW.doc.addRuleInfo("ycdn","Use a Content Delivery Network (CDN)","User proximity to web servers impacts response times.  Deploying content across multiple geographically dispersed servers helps users perceive that pages are loading faster.");YSLOW.doc.addRuleInfo("yexpires","Add Expires headers","Web pages are becoming increasingly complex with more scripts, style sheets, images, and Flash on them.  A first-time visit to a page may require several HTTP requests to load all the components.  By using Expires headers these components become cacheable, which avoids unnecessary HTTP requests on subsequent page views.  Expires headers are most often associated with images, but they can and should be used on all page components including scripts, style sheets, and Flash.");YSLOW.doc.addRuleInfo("ycompress","Compress components with gzip","Compression reduces response times by reducing the size of the HTTP response.  Gzip is the most popular and effective compression method currently available and generally reduces the response size by about 70%.  Approximately 90% of today's Internet traffic travels through browsers that claim to support gzip.");YSLOW.doc.addRuleInfo("ycsstop","Put CSS at top","Moving style sheets to the document HEAD element helps pages appear to load quicker since this allows pages to render progressively.");YSLOW.doc.addRuleInfo("yjsbottom","Put JavaScript at bottom","JavaScript scripts block parallel downloads; that is, when a script is downloading, the browser will not start any other downloads.  To help the page load faster, move scripts to the bottom of the page if they are deferrable.");YSLOW.doc.addRuleInfo("yexpressions","Avoid CSS expressions","CSS expressions (supported in IE beginning with Version 5) are a powerful, and dangerous, way to dynamically set CSS properties.  These expressions are evaluated frequently:  when the page is rendered and resized, when the page is scrolled, and even when the user moves the mouse over the page.  These frequent evaluations degrade the user experience.");YSLOW.doc.addRuleInfo("yexternal","Make JavaScript and CSS external","Using external JavaScript and CSS files generally produces faster pages because the files are cached by the browser.  JavaScript and CSS that are inlined in HTML documents get downloaded each time the HTML document is requested.  This reduces the number of HTTP requests but increases the HTML document size.  On the other hand, if the JavaScript and CSS are in external files cached by the browser, the HTML document size is reduced without increasing the number of HTTP requests.");YSLOW.doc.addRuleInfo("ydns","Reduce DNS lookups","The Domain Name System (DNS) maps hostnames to IP addresses, just like phonebooks map people's names to their phone numbers.  When you type URL www.yahoo.com into the browser, the browser contacts a DNS resolver that returns the server's IP address.  DNS has a cost; typically it takes 20 to 120 milliseconds for it to look up the IP address for a hostname.  The browser cannot download anything from the host until the lookup completes.");YSLOW.doc.addRuleInfo("yminify","Minify JavaScript and CSS","Minification removes unnecessary characters from a file to reduce its size, thereby improving load times.  When a file is minified, comments and unneeded white space characters (space, newline, and tab) are removed.  This improves response time since the size of the download files is reduced.");YSLOW.doc.addRuleInfo("yredirects","Avoid URL redirects","URL redirects are made using HTTP status codes 301 and 302.  They tell the browser to go to another location.  Inserting a redirect between the user and the final HTML document delays everything on the page since nothing on the page can be rendered and no components can be downloaded until the HTML document arrives.");YSLOW.doc.addRuleInfo("ydupes","Remove duplicate JavaScript and CSS","Duplicate JavaScript and CSS files hurt performance by creating unnecessary HTTP requests (IE only) and wasted JavaScript execution (IE and Firefox).  In IE, if an external script is included twice and is not cacheable, it generates two HTTP requests during page loading.  Even if the script is cacheable, extra HTTP requests occur when the user reloads the page.  In both IE and Firefox, duplicate JavaScript scripts cause wasted time evaluating the same scripts more than once.  This redundant script execution happens regardless of whether the script is cacheable.");YSLOW.doc.addRuleInfo("yetags","Configure entity tags (ETags)","Entity tags (ETags) are a mechanism web servers and the browser use to determine whether a component in the browser's cache matches one on the origin server.  Since ETags are typically constructed using attributes that make them unique to a specific server hosting a site, the tags will not match when a browser gets the original component from one server and later tries to validate that component on a different server.");YSLOW.doc.addRuleInfo("yxhr","Make AJAX cacheable","One of AJAX's benefits is it provides instantaneous feedback to the user because it requests information asynchronously from the backend web server.  However, using AJAX does not guarantee the user will not wait for the asynchronous JavaScript and XML responses to return.  Optimizing AJAX responses is important to improve performance, and making the responses cacheable is the best way to optimize them.");YSLOW.doc.addRuleInfo("yxhrmethod","Use GET for AJAX requests","When using the XMLHttpRequest object, the browser implements POST in two steps:  (1) send the headers, and (2) send the data.  It is better to use GET instead of POST since GET sends the headers and the data together (unless there are many cookies).  IE's maximum URL length is 2 KB, so if you are sending more than this amount of data you may not be able to use GET.");YSLOW.doc.addRuleInfo("ymindom","Reduce the number of DOM elements","A complex page means more bytes to download, and it also means slower DOM access in JavaScript.  Reduce the number of DOM elements on the page to improve performance.");YSLOW.doc.addRuleInfo("yno404","Avoid HTTP 404 (Not Found) error",'Making an HTTP request and receiving a 404 (Not Found) error is expensive and degrades the user experience.  Some sites have helpful 404 messages (for example, "Did you mean ...?"), which may assist the user, but server resources are still wasted.');YSLOW.doc.addRuleInfo("ymincookie","Reduce cookie size","HTTP cookies are used for authentication, personalization, and other purposes.  Cookie information is exchanged in the HTTP headers between web servers and the browser, so keeping the cookie size small minimizes the impact on response time.");YSLOW.doc.addRuleInfo("ycookiefree","Use cookie-free domains","When the browser requests a static image and sends cookies with the request, the server ignores the cookies.  These cookies are unnecessary network traffic.  To workaround this problem, make sure that static components are requested with cookie-free requests by creating a subdomain and hosting them there.");YSLOW.doc.addRuleInfo("ynofilter","Avoid AlphaImageLoader filter","The IE-proprietary AlphaImageLoader filter attempts to fix a problem with semi-transparent true color PNG files in IE versions less than Version 7.  However, this filter blocks rendering and freezes the browser while the image is being downloaded.  Additionally, it increases memory consumption.  The problem is further multiplied because it is applied per element, not per image.");YSLOW.doc.addRuleInfo("yimgnoscale","Do not scale images in HTML","Web page designers sometimes set image dimensions by using the width and height attributes of the HTML image element.  Avoid doing this since it can result in images being larger than needed.  For example, if your page requires image myimg.jpg which has dimensions 240x720 but displays it with dimensions 120x360 using the width and height attributes, then the browser will download an image that is larger than necessary.");YSLOW.doc.addRuleInfo("yfavicon","Make favicon small and cacheable","A favicon is an icon associated with a web page; this icon resides in the favicon.ico file in the server's root.  Since the browser requests this file, it needs to be present; if it is missing, the browser returns a 404 error (see \"Avoid HTTP 404 (Not Found) error\" above).  Since favicon.ico resides in the server's root, each time the browser requests this file, the cookies for the server's root are sent.  Making the favicon small and reducing the cookie size for the server's root cookies improves performance for retrieving the favicon.  Making favicon.ico cacheable avoids frequent requests for it.");YSLOW.doc.addRuleInfo("yemptysrc","Avoid empty src or href","You may expect a browser to do nothing when it encounters an empty image src.  However, it is not the case in most browsers. IE makes a request to the directory in which the page is located; Safari, Chrome, Firefox 3 and earlier make a request to the actual page itself. This behavior could possibly corrupt user data, waste server computing cycles generating a page that will never be viewed, and in the worst case, cripple your servers by sending a large amount of unexpected traffic.");YSLOW.doc.addRuleInfo("thirdpartyasyncjs","Load third party javascript asynchronously","Always load third party javascript asynchronously. Third parties that will be checked are twitter, facebook, google (api, analythics, ajax), linkedin, disqus, pinterest & jquery.");YSLOW.doc.addRuleInfo("cssprint","Avoid loading specific css for print","Loading a specific stylesheet for print, can block rendering in your browser (depending on browser version) and will for almost all browsers, block the onload event to fire (even though the print stylesheet is not even used!).");YSLOW.doc.addRuleInfo("cssinheaddomain","Load CSS in head from document domain","CSS files inside of HEAD should be loaded from the same domain as the main document, in order to avoid DNS lookups, because you want to have the HEAD part of the page finished as fast as possible, for the browser to be abe to start render the page. This is extra important for mobile.");YSLOW.doc.addRuleInfo("syncjsinhead","Never load JS synchronously in head","Javascript files should never be loaded synchronously in HEAD, because it will block the rendering of the page.");YSLOW.doc.addRuleInfo("avoidfont","Avoid use of web fonts","Avoid use of webfonts because they will decrease the performance of the page.");YSLOW.doc.addRuleInfo("totalrequests","Reduce number of total requests","Avoid to have too many requests on your page. The more requests, the slower the page will be for the end user.");YSLOW.doc.addRuleInfo("expiresmod","Have expire headers for static components","By adding HTTP expires headers to your static files, the files will be cached in the end users browser.");YSLOW.doc.addRuleInfo("spof","Frontend single point of failure"," A page can be stopped to be loaded in the browser, if a single script, css and in some cases a font couldn't be fetched or loading slow (the white screen of death), and that is something you really want to avoid. Never load 3rd party components inside of head!  One important note, right now this rule treats domain and subdomains as ok, that match the document domain, all other domains is treated as a SPOF. The score is calculated like this: Synchronously loaded javascripts inside of head, hurts you the most, then CSS files inside of head hurts a little less, font face inside of css files further less, and least inline font face files. One rule SPOF rule missing is the IE specific feature, that a font face will be SPOF if a script is requested before the font face file.");YSLOW.doc.addRuleInfo("nodnslookupswhenfewrequests","Avoid DNS lookups when a page has few requests","If you have few requests on a page, they should all be on the same domain to avoid DNS lookups, because the lookups will cost much.");YSLOW.doc.addRuleInfo("inlinecsswhenfewrequest","Do not load css files when the page has few request","When a page has few requests (or actually maybe always if you dont have a massive amount of css), it is better to inline the css, to make the page to start render as early as possible.");YSLOW.doc.addRuleInfo("criticalpath","Avoid slowing down the critical rendering path","Every request fetched inside of HEAD, will postpone the rendering of the page! Do not load javascript synchronously inside of head, load files from the same domain as the main document (to avoid DNS lookups) and inline CSS for a really fast rendering path. The scoring system for this rule, will give you minus score for synchronously loaded javascript inside of head, css files requested inside of head and minus score for every DNS lookup inside of head.");YSLOW.doc.addRuleInfo("textcontent","Have a reasonable percentage of textual content compared to the rest of the page","Make sure the amount of HTML elements are too many compared to text content.");YSLOW.doc.addRuleInfo("noduplicates","Remove duplicate JavaScript and CSS","Duplicate JavaScript and CSS files hurt performance by creating unnecessary HTTP requests (IE only) and wasted JavaScript execution (IE and Firefox).  In IE, if an external script is included twice and is not cacheable, it generates two HTTP requests during page loading.  Even if the script is cacheable, extra HTTP requests occur when the user reloads the page.  In both IE and Firefox, duplicate JavaScript scripts cause wasted time evaluating the same scripts more than once.  This redundant script execution happens regardless of whether the script is cacheable.");YSLOW.doc.addRuleInfo("cssnumreq","Make fewer HTTP requests for CSS files","Decreasing the number of components on a page reduces the number of HTTP requests required to render the page, resulting in faster page loads. Combine your CSS files into as few as possible.");YSLOW.doc.addRuleInfo("cssimagesnumreq","Make fewer HTTP requests for CSS image files","Decreasing the number of components on a page reduces the number of HTTP requests required to render the page, resulting in faster page loads. Combine your CSS images files into as few CSS sprites as possible.");YSLOW.doc.addRuleInfo("jsnumreq","Make fewer synchronously HTTP requests for Javascript files","Decreasing the number of components on a page reduces the number of HTTP requests required to render the page, resulting in faster page loads. Combine your Javascript files into as few as possible (and load them asynchronously).");YSLOW.doc.addRuleInfo("longexpirehead","Have expires headers equals or longer than one year","Having really long cache headers are beneficial for caching.");YSLOW.doc.addRuleInfo("mindom","Reduce the number of DOM elements","A complex page means more bytes to download, and it also means slower DOM access in JavaScript.  Reduce the number of DOM elements on the page to improve performance.");YSLOW.doc.addRuleInfo("thirdpartyversions","Always use latest versions of third party javascripts","Always use the latest & greatest versions of third party javascripts, this is really important for JQuery, since the latest versions is always faster & better.");YSLOW.doc.addRuleInfo("avoidscalingimages","Never scale images in HTML","Images should always be sent with the correct size else the browser will download an image that is larger than necessary. This is more important today with responsive web design, meaning you want to avoid downloading non scaled images to a mobile phone or tablet. Note: This rule doesn	 check images with size 0 (images in carousels etc), so they will be missed by the rule.");YSLOW.doc.addRuleInfo("ttfb","Keep the time to first byte low","The time to first byte should be as low as possible, so that the browser can start processing the content.");YSLOW.doc.addRuleInfo("redirects","Never do redirects","Redirects is bad for performance, specially for mobile.");YSLOW.doc.tools_desc="Click on the tool name to launch the tool.";YSLOW.doc.addToolInfo("jslint","JSLint","Run JSLint on all JavaScript code in this document");YSLOW.doc.addToolInfo("alljs","All JS","Show all JavaScript code in this document");YSLOW.doc.addToolInfo("jsbeautified","All JS Beautified","Show all JavaScript code in this document in an easy to read format");YSLOW.doc.addToolInfo("jsminified","All JS Minified","Show all JavaScript code in this document in a minified (no comments or white space) format");YSLOW.doc.addToolInfo("allcss","All CSS","Show all CSS code in this document");YSLOW.doc.addToolInfo("cssmin","YUI CSS Compressor","Show all CSS code in the document in a minified format");YSLOW.doc.addToolInfo("smushItAll","All Smush.it&trade;","Run Smush.it&trade; on all image components in this document");YSLOW.doc.addToolInfo("printableview","Printable View","Show a printable view of grades, component lists, and statistics");YSLOW.doc.splash.title="Grade your web pages with YSlow";YSLOW.doc.splash.content={header:"YSlow gives you:",text:"<ul><li>Grade based on the performance of the page (you can define your own ruleset)</li><li>Summary of the page components</li><li>Chart with statistics</li><li>Tools for analyzing performance, including Smush.it&trade; and JSLint</li></ul>"};YSLOW.doc.splash.more_info="Learn more about YSlow and the Yahoo! Developer Network";YSLOW.doc.rulesettings_desc="Choose which ruleset (Sitespeed, YSlow V2, Classic V1, or Small Site/Blog) best fits your specific needs.  Or create a new set and click Save as... to save it.";YSLOW.doc.components_legend.beacon="type column indicates the component is loaded after window onload event";YSLOW.doc.components_legend.after_onload="denotes 1x1 pixels image that may be image beacon";YSLOW.doc.view_names={grade:"Grade",components:"Components",stats:"Statistics",tools:"Tools",rulesetedit:"Rule Settings"};YSLOW.doc.copyright="Copyright &copy; "+(new Date).getFullYear()+" Yahoo! Inc. All rights reserved.";YSLOW.registerRule({id:"ynumreq",url:"http://developer.yahoo.com/performance/rules.html#num_http",category:["content"],config:{max_js:3,points_js:4,max_css:2,points_css:4,max_cssimages:6,points_cssimages:3},lint:function(e,t,n){var r=t.getComponentsByType("js").length-n.max_js,i=t.getComponentsByType("css").length-n.max_css,s=t.getComponentsByType("cssimage").length-n.max_cssimages,o=100,u=[];if(r>0){o-=r*n.points_js;u[u.length]="This page has "+YSLOW.util.plural("%num% external Javascript script%s%",r+n.max_js)+".  Try combining them into one."}if(i>0){o-=i*n.points_css;u[u.length]="This page has "+YSLOW.util.plural("%num% external stylesheet%s%",i+n.max_css)+".  Try combining them into one."}if(s>0){o-=s*n.points_cssimages;u[u.length]="This page has "+YSLOW.util.plural("%num% external background image%s%",s+n.max_cssimages)+".  Try combining them with CSS sprites."}return{score:o,message:u.join("\n"),components:[]}}});YSLOW.registerRule({id:"ycdn",url:"http://developer.yahoo.com/performance/rules.html#cdn",category:["server"],config:{points:10,patterns:["^([^\\.]*)\\.([^\\.]*)\\.yimg\\.com/[^/]*\\.yimg\\.com/.*$","^([^\\.]*)\\.([^\\.]*)\\.yimg\\.com/[^/]*\\.yahoo\\.com/.*$","^sec.yimg.com/","^a248.e.akamai.net","^[dehlps].yimg.com","^(ads|cn|mail|maps|s1).yimg.com","^[\\d\\w\\.]+.yimg.com","^a.l.yimg.com","^us.(js|a)2.yimg.com","^yui.yahooapis.com","^adz.kr.yahoo.com","^img.yahoo.co.kr","^img.(shopping|news|srch).yahoo.co.kr","^pimg.kr.yahoo.com","^kr.img.n2o.yahoo.com","^s3.amazonaws.com","^(www.)?google-analytics.com",".cloudfront.net",".ak.fbcdn.net","platform.twitter.com","cdn.api.twitter.com","apis.google.com",".akamaihd.net",".rackcdn.com"],exceptions:["^chart.yahoo.com","^(a1|f3|f5|f3c|f5c).yahoofs.com","^us.(a1c|f3).yahoofs.com"],servers:["cloudflare-nginx"],types:["js","css","image","cssimage","flash","favicon"]},lint:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v=100,m=[],g=[],y="",b=YSLOW.util,w=b.plural,E=b.kbSize,S=b.getHostname,x=S(t.doc_comp.url),T=t.getComponentsByType(n.types),N=b.Preference.getPref("cdnHostnames",""),C=b.Preference.nativePref;if(N){N=N.split(",")}for(r=0,l=T.length;r<l;r+=1){h=T[r];s=h.url;a=S(s);d=h.headers;if(h.type==="favicon"&&a===x){continue}u=d["x-cdn"]||d["x-amz-cf-id"]||d["x-edge-location"]||d["powered-by-chinacache"];if(u){continue}p=n.patterns;for(i=0,c=p.length;i<c;i+=1){o=new RegExp(p[i]);if(o.test(a)){u=1;break}}if(N){for(i=0,c=N.length;i<c;i+=1){o=new RegExp(b.trim(N[i]));if(o.test(a)){u=1;break}}}if(!u){p=n.servers;for(i=0,c=p.length;i<c;i+=1){o=new RegExp(p[i]);if(o.test(d.server)){u=1;break}}if(!u){p=n.exceptions;for(i=0,c=p.length;i<c;i+=1){o=new RegExp(p[i]);if(o.test(a)){g.push(h);u=1;break}}if(!u){m.push(h)}}}}v-=m.length*n.points;m.concat(g);if(m.length>0){y=w("There %are% %num% static component%s% that %are% not on CDN. ",m.length)}if(g.length>0){y+=w("There %are% %num% component%s% that %are% not on CDN, but %are% exceptions:",g.length)+"<ul>";for(r=0,l=m.length;r<l;r+=1){y+="<li>"+b.prettyAnchor(g[r].url,g[r].url,null,true,120,null,g[r].type)+"</li>"}y+="</ul>"}if(N){y+="<p>Using these CDN hostnames from your preferences: "+N+"</p>"}else{y+="<p>You can specify CDN hostnames in your preferences. See <a href=\"javascript:document.ysview.openLink('https://github.com/marcelduran/yslow/wiki/FAQ#wiki-faq_cdn')\">YSlow FAQ</a> for details.</p>"}if(m.length){m=b.summaryByDomain(m,["size","size_compressed"],true);for(r=0,l=m.length;r<l;r+=1){f=m[r];m[r]=f.domain+": "+w("%num% component%s%, ",f.count)+E(f.sum_size)+(f.sum_size_compressed>0?" ("+E(f.sum_size_compressed)+" GZip)":"")+(C?" <button onclick=\"javascript:document.ysview.addCDN('"+f.domain+"')\">Add as CDN</button>":"")}}return{score:v,message:y,components:m}}});YSLOW.registerRule({id:"yexpires",url:"http://developer.yahoo.com/performance/rules.html#expires",category:["server"],config:{points:11,howfar:172800,types:["css","js","image","cssimage","flash","favicon"]},lint:function(e,t,n){var r,i,s,o,u,a=parseInt(n.howfar,10)*1e3,f=[],l=t.getComponentsByType(n.types);for(i=0,u=l.length;i<u;i+=1){s=l[i].expires;if(typeof s==="object"&&typeof s.getTime==="function"){r=(new Date).getTime();if(s.getTime()>r+a){continue}}f.push(l[i])}o=100-f.length*parseInt(n.points,10);return{score:o,message:f.length>0?YSLOW.util.plural("There %are% %num% static component%s%",f.length)+" without a far-future expiration date.":"",components:f}}});YSLOW.registerRule({id:"ycompress",url:"http://developer.yahoo.com/performance/rules.html#gzip",category:["server"],config:{min_filesize:500,types:["doc","iframe","xhr","js","css"],points:11},lint:function(e,t,n){var r,i,s,o,u=[],a=t.getComponentsByType(n.types);for(r=0,i=a.length;r<i;r+=1){o=a[r];if(o.compressed||o.size<500){continue}u.push(o)}s=100-u.length*parseInt(n.points,10);return{score:s,message:u.length>0?YSLOW.util.plural("There %are% %num% plain text component%s%",u.length)+" that should be sent compressed":"",components:u}}});YSLOW.registerRule({id:"ycsstop",url:"http://developer.yahoo.com/performance/rules.html#css_top",category:["css"],config:{points:10},lint:function(e,t,n){var r,i,s,o,u=t.getComponentsByType("css"),a=[];for(r=0,i=u.length;r<i;r+=1){o=u[r];if(o.containerNode==="body"){a.push(o)}}s=100;if(a.length>0){s-=1+a.length*parseInt(n.points,10)}return{score:s,message:a.length>0?YSLOW.util.plural("There %are% %num% stylesheet%s%",a.length)+" found in the body of the document":"",components:a}}});YSLOW.registerRule({id:"yjsbottom",url:"http://developer.yahoo.com/performance/rules.html#js_bottom",category:["javascript"],config:{points:5},lint:function(e,t,n){var r,i,s,o,u=[],a=t.getComponentsByType("js");for(r=0,i=a.length;r<i;r+=1){s=a[r];if(s.containerNode==="head"&&!s.injected&&(!s.defer||!s.async)){u.push(s)}}o=100-u.length*parseInt(n.points,10);return{score:o,message:u.length>0?YSLOW.util.plural("There %are% %num% JavaScript script%s%",u.length)+" found in the head of the document":"",components:u}}});YSLOW.registerRule({id:"yexpressions",url:"http://developer.yahoo.com/performance/rules.html#css_expressions",category:["css"],config:{points:2},lint:function(e,t,n){var r,i,s,o,u=t.inline&&t.inline.styles||[],a=t.getComponentsByType("css"),f=[],l=100,c=0;for(r=0,i=a.length;r<i;r+=1){o=a[r];if(typeof o.expr_count==="undefined"){s=YSLOW.util.countExpressions(o.body);o.expr_count=s}else{s=o.expr_count}if(s>0){o.yexpressions=YSLOW.util.plural("%num% expression%s%",s);c+=s;f.push(o)}}for(r=0,i=u.length;r<i;r+=1){s=YSLOW.util.countExpressions(u[r].body);if(s>0){f.push("inline &lt;style&gt; tag #"+(r+1)+" ("+YSLOW.util.plural("%num% expression%s%",s)+")");c+=s}}if(c>0){l=90-c*n.points}return{score:l,message:c>0?"There is a total of "+YSLOW.util.plural("%num% expression%s%",c):"",components:f}}});YSLOW.registerRule({id:"yexternal",url:"http://developer.yahoo.com/performance/rules.html#external",category:["javascript","css"],config:{},lint:function(e,t,n){var r,i=t.inline,s=i&&i.styles||[],o=i&&i.scripts||[],u=[];if(s.length){r=YSLOW.util.plural("There is a total of %num% inline css",s.length);u.push(r)}if(o.length){r=YSLOW.util.plural("There is a total of %num% inline script%s%",o.length);u.push(r)}return{score:"n/a",message:"Only consider this if your property is a common user home page.",components:u}}});YSLOW.registerRule({id:"ydns",url:"http://developer.yahoo.com/performance/rules.html#dns_lookups",category:["content"],config:{max_domains:4,points:5},lint:function(e,t,n){var r,i,s,o=YSLOW.util,u=o.kbSize,a=o.plural,f=100,l=o.summaryByDomain(t.components,["size","size_compressed"],true);if(l.length>n.max_domains){f-=(l.length-n.max_domains)*n.points}if(l.length){for(r=0,i=l.length;r<i;r+=1){s=l[r];l[r]=s.domain+": "+a("%num% component%s%, ",s.count)+u(s.sum_size)+(s.sum_size_compressed>0?" ("+u(s.sum_size_compressed)+" GZip)":"")}}return{score:f,message:l.length>n.max_domains?a("The components are split over more than %num% domain%s%",n.max_domains):"",components:l}}});YSLOW.registerRule({id:"yminify",url:"http://developer.yahoo.com/performance/rules.html#minify",category:["javascript","css"],config:{points:10,types:["js","css"]},lint:function(e,t,n){var r,i,s,o,u,a=t.inline,f=a&&a.styles||[],l=a&&a.scripts||[],c=t.getComponentsByType(n.types),h=[];for(r=0,i=c.length;r<i;r+=1){u=c[r];if(typeof u.minified==="undefined"){o=YSLOW.util.isMinified(u.body);u.minified=o}else{o=u.minified}if(!o){h.push(u)}}for(r=0,i=f.length;r<i;r+=1){if(!YSLOW.util.isMinified(f[r].body)){h.push("inline &lt;style&gt; tag #"+(r+1))}}for(r=0,i=l.length;r<i;r+=1){if(!YSLOW.util.isMinified(l[r].body)){h.push("inline &lt;script&gt; tag #"+(r+1))}}s=100-h.length*n.points;return{score:s,message:h.length>0?YSLOW.util.plural("There %are% %num% component%s% that can be minified",h.length):"",components:h}}});YSLOW.registerRule({id:"yredirects",url:"http://developer.yahoo.com/performance/rules.html#redirects",category:["content"],config:{points:10},lint:function(e,t,n){var r,i,s,o,u=[],a=YSLOW.util.briefUrl,f=t.getComponentsByType("redirect");for(r=0,i=f.length;r<i;r+=1){s=f[r];u.push(a(s.url,80)+" redirects to "+a(s.headers.location,60))}o=100-f.length*parseInt(n.points,10);return{score:o,message:f.length>0?YSLOW.util.plural("There %are% %num% redirect%s%",f.length):"",components:u}}});YSLOW.registerRule({id:"ydupes",url:"http://developer.yahoo.com/performance/rules.html#js_dupes",category:["javascript","css"],config:{points:5,types:["js","css"]},lint:function(e,t,n){var r,i,s,o,u={},a=[],f=t.getComponentsByType(n.types);for(r=0,o=f.length;r<o;r+=1){i=f[r].url;if(typeof u[i]==="undefined"){u[i]={count:1,compindex:r}}else{u[i].count+=1}}for(r in u){if(u.hasOwnProperty(r)&&u[r].count>1){a.push(f[u[r].compindex])}}s=100-a.length*parseInt(n.points,10);return{score:s,message:a.length>0?YSLOW.util.plural("There %are% %num% duplicate component%s%",a.length):"",components:a}}});YSLOW.registerRule({id:"yetags",url:"http://developer.yahoo.com/performance/rules.html#etags",category:["server"],config:{points:11,types:["flash","js","css","cssimage","image","favicon"]},lint:function(e,t,n){var r,i,s,o,u,a=[],f=t.getComponentsByType(n.types);for(r=0,i=f.length;r<i;r+=1){o=f[r];u=o.headers&&o.headers.etag;if(u&&!YSLOW.util.isETagGood(u)){a.push(o)}}s=100-a.length*parseInt(n.points,10);return{score:s,message:a.length>0?YSLOW.util.plural("There %are% %num% component%s% with misconfigured ETags",a.length):"",components:a}}});YSLOW.registerRule({id:"yxhr",url:"http://developer.yahoo.com/performance/rules.html#cacheajax",category:["content"],config:{points:5,min_cache_time:3600},lint:function(e,t,n){var r,i,s,o,u,a=parseInt(n.min_cache_time,10)*1e3,f=[],l=t.getComponentsByType("xhr");for(r=0;r<l.length;r+=1){u=l[r].headers["cache-control"];if(u){if(u.indexOf("no-cache")!==-1||u.indexOf("no-store")!==-1){continue}}i=l[r].expires;if(typeof i==="object"&&typeof i.getTime==="function"){s=(new Date).getTime();if(i.getTime()>s+a){continue}}f.push(l[r])}o=100-f.length*parseInt(n.points,10);return{score:o,message:f.length>0?YSLOW.util.plural("There %are% %num% XHR component%s% that %are% not cacheable",f.length):"",components:f}}});YSLOW.registerRule({id:"yxhrmethod",url:"http://developer.yahoo.com/performance/rules.html#ajax_get",category:["server"],config:{points:5},lint:function(e,t,n){var r,i,s=[],o=t.getComponentsByType("xhr");for(r=0;r<o.length;r+=1){if(typeof o[r].method==="string"){if(o[r].method!=="GET"&&o[r].method!=="unknown"){s.push(o[r])}}}i=100-s.length*parseInt(n.points,10);return{score:i,message:s.length>0?YSLOW.util.plural("There %are% %num% XHR component%s% that %do% not use GET HTTP method",s.length):"",components:s}}});YSLOW.registerRule({id:"ymindom",url:"http://developer.yahoo.com/performance/rules.html#min_dom",category:["content"],config:{range:250,points:10,maxdom:900},lint:function(e,t,n){var r=t.domElementsCount,i=100;if(r>n.maxdom){i=99-Math.ceil((r-parseInt(n.maxdom,10))/parseInt(n.range,10))*parseInt(n.points,10)}return{score:i,message:r>n.maxdom?YSLOW.util.plural("There %are% %num% DOM element%s% on the page",r):"",components:[]}}});YSLOW.registerRule({id:"yno404",url:"http://developer.yahoo.com/performance/rules.html#no404",category:["content"],config:{points:5,types:["css","js","image","cssimage","flash","xhr","favicon"]},lint:function(e,t,n){var r,i,s,o,u=[],a=t.getComponentsByType(n.types);for(r=0,i=a.length;r<i;r+=1){s=a[r];if(parseInt(s.status,10)===404){u.push(s)}}o=100-u.length*parseInt(n.points,10);return{score:o,message:u.length>0?YSLOW.util.plural("There %are% %num% request%s% that %are% 404 Not Found",u.length):"",components:u}}});YSLOW.registerRule({id:"ymincookie",url:"http://developer.yahoo.com/performance/rules.html#cookie_size",category:["cookie"],config:{points:10,max_cookie_size:1e3},lint:function(e,t,n){var r,i=t.cookies,s=i&&i.length||0,o="",u=100;if(s>n.max_cookie_size){r=Math.floor(s/n.max_cookie_size);u-=1+r*parseInt(n.points,10);o=YSLOW.util.plural("There %are% %num% byte%s% of cookies on this page",s)}return{score:u,message:o,components:[]}}});YSLOW.registerRule({id:"ycookiefree",url:"http://developer.yahoo.com/performance/rules.html#cookie_free",category:["cookie"],config:{points:5,types:["js","css","image","cssimage","flash","favicon"]},lint:function(e,t,n){var r,i,s,o,u,a=[],f=YSLOW.util.getHostname,l=f(t.doc_comp.url),c=t.getComponentsByType(n.types);for(r=0,i=c.length;r<i;r+=1){o=c[r];if(o.type==="favicon"&&f(o.url)===l){continue}u=o.cookie;if(typeof u==="string"&&u.length){a.push(c[r])}}s=100-a.length*parseInt(n.points,10);return{score:s,message:a.length>0?YSLOW.util.plural("There %are% %num% component%s% that %are% not cookie-free",a.length):"",components:a}}});YSLOW.registerRule({id:"ynofilter",url:"http://developer.yahoo.com/performance/rules.html#no_filters",category:["css"],config:{points:5,halfpoints:2},lint:function(e,t,n){var r,i,s,o,u,a,f,l=t.inline&&t.inline.styles||[],c=t.getComponentsByType("css"),h=[],p=0,d=0;for(r=0,i=c.length;r<i;r+=1){o=c[r];if(typeof o.filter_count==="undefined"){f=YSLOW.util.countAlphaImageLoaderFilter(o.body);o.filter_count=f}else{f=o.filter_count}a=0;for(u in f){if(f.hasOwnProperty(u)){if(u==="hackFilter"){d+=f[u];a+=f[u]}else{p+=f[u];a+=f[u]}}}if(a>0){c[r].yfilters=YSLOW.util.plural("%num% filter%s%",a);h.push(c[r])}}for(r=0,i=l.length;r<i;r+=1){f=YSLOW.util.countAlphaImageLoaderFilter(l[r].body);a=0;for(u in f){if(f.hasOwnProperty(u)){if(u==="hackFilter"){d+=f[u];a+=f[u]}else{p+=f[u];a+=f[u]}}}if(a>0){h.push("inline &lt;style&gt; tag #"+(r+1)+" ("+YSLOW.util.plural("%num% filter%s%",a)+")")}}s=100-(p*n.points+d*n.halfpoints);return{score:s,message:p+d>0?"There is a total of "+YSLOW.util.plural("%num% filter%s%",p+d):"",components:h}}});YSLOW.registerRule({id:"yimgnoscale",url:"http://developer.yahoo.com/performance/rules.html#no_scale",category:["images"],config:{points:5},lint:function(e,t,n){var r,i,s,o=[],u=t.getComponentsByType("image");for(r=0;r<u.length;r+=1){i=u[r].object_prop;if(i&&typeof i.width!=="undefined"&&typeof i.height!=="undefined"&&typeof i.actual_width!=="undefined"&&typeof i.actual_height!=="undefined"){if(i.width<i.actual_width||i.height<i.actual_height){o.push(u[r])}}}s=100-o.length*parseInt(n.points,10);return{score:s,message:o.length>0?YSLOW.util.plural("There %are% %num% image%s% that %are% scaled down",o.length):"",components:o}}});YSLOW.registerRule({id:"yfavicon",url:"http://developer.yahoo.com/performance/rules.html#favicon",category:["images"],config:{points:5,size:2e3,min_cache_time:3600},lint:function(e,t,n){var r,i,s,o,u,a=[],f=parseInt(n.min_cache_time,10)*1e3,l=t.getComponentsByType("favicon");if(l.length){s=l[0];if(parseInt(s.status,10)===404){a.push("Favicon was not found")}if(s.size>n.size){a.push(YSLOW.util.plural("Favicon is more than %num% bytes",n.size))}i=s.expires;if(typeof i==="object"&&typeof i.getTime==="function"){r=(new Date).getTime();u=i.getTime()>=r+f}if(!u){a.push("Favicon is not cacheable")}}o=100-a.length*parseInt(n.points,10);return{score:o,message:a.length>0?a.join("\n"):"",components:[]}}});YSLOW.registerRule({id:"yemptysrc",url:"http://developer.yahoo.com/performance/rules.html#emptysrc",category:["server"],config:{points:100},lint:function(e,t,n){var r,i,s,o=t.empty_url,u=[],a=[],f="",l=parseInt(n.points,10);i=100;if(o){for(r in o){if(o.hasOwnProperty(r)){s=o[r];i-=s*l;a.push(s+" "+r)}}f=a.join(", ")+YSLOW.util.plural(" component%s% with empty link were found.",a.length)}return{score:i,message:f,components:u}}});YSLOW.registerRuleset({id:"ydefault",name:"YSlow(V2)",rules:{ynumreq:{},ycdn:{},yemptysrc:{},yexpires:{},ycompress:{},ycsstop:{},yjsbottom:{},yexpressions:{},yexternal:{},ydns:{},yminify:{},yredirects:{},ydupes:{},yetags:{},yxhr:{},yxhrmethod:{},ymindom:{},yno404:{},ymincookie:{},ycookiefree:{},ynofilter:{},yimgnoscale:{},yfavicon:{}},weights:{ynumreq:8,ycdn:6,yemptysrc:30,yexpires:10,ycompress:8,ycsstop:4,yjsbottom:4,yexpressions:3,yexternal:4,ydns:3,yminify:4,yredirects:4,ydupes:4,yetags:2,yxhr:4,yxhrmethod:3,ymindom:3,yno404:4,ymincookie:3,ycookiefree:3,ynofilter:4,yimgnoscale:3,yfavicon:2}});YSLOW.registerRuleset({id:"yslow1",name:"Classic(V1)",rules:{ynumreq:{},ycdn:{},yexpires:{},ycompress:{},ycsstop:{},yjsbottom:{},yexpressions:{},yexternal:{},ydns:{},yminify:{types:["js"],check_inline:false},yredirects:{},ydupes:{types:["js"]},yetags:{}},weights:{ynumreq:8,ycdn:6,yexpires:10,ycompress:8,ycsstop:4,yjsbottom:4,yexpressions:3,yexternal:4,ydns:3,yminify:4,yredirects:4,ydupes:4,yetags:2}});YSLOW.registerRuleset({id:"yblog",name:"Small Site or Blog",rules:{ynumreq:{},yemptysrc:{},ycompress:{},ycsstop:{},yjsbottom:{},yexpressions:{},ydns:{},yminify:{},yredirects:{},ydupes:{},ymindom:{},yno404:{},ynofilter:{},yimgnoscale:{},yfavicon:{}},weights:{ynumreq:8,yemptysrc:30,ycompress:8,ycsstop:4,yjsbottom:4,yexpressions:3,ydns:3,yminify:4,yredirects:4,ydupes:4,ymindom:3,yno404:4,ynofilter:4,yimgnoscale:3,yfavicon:2}});var e={};e.getTLD=function(e){var t=e;var n=/\.(gov|ac|mil|net|org|co)\.\w\w$/i;if(e.match(n)){var r=/[\w]+\.[\w]+\.[\w]+$/i;t=e.match(r).toString()}else{var i=/[\w]+\.[\w]+$/i;t=e.match(i).toString()}return t};e.getTextLength=function(e){function r(e){if(e.childNodes&&e.childNodes.length>0){for(var i=0;i<e.childNodes.length;i++){r(e.childNodes[i])}}if(e.nodeType==3&&t.indexOf(e.parentNode.tagName.toLowerCase())==-1){n+=e.nodeValue.length}}var t="script style".split(" ");var n=0;r(e);return n};e.versionCompare=function(e,n){if(e===undefined){return true}e=e.split(".");var r=t(e[0],n[0]),i=t(e[1],n[1]),s=t(e[2],n[2]);return!r||r&&!i||r&&i&&!s};e.isSameDomainTLD=function(t,n,r){if(/^http/.test(r)){if(t===e.getTLD(YSLOW.util.getHostname(r))){return true}else{return false}}else{if(t===e.getTLD(YSLOW.util.getHostname(n))){return true}else{return false}}return false};YSLOW.registerRule({id:"cssprint",name:"Do not load print stylesheets, use @media type print instead",info:"Loading a specific stylesheet for printing slows down the page, even though it is not used",category:["css"],config:{points:20},url:"http://sitespeed.io/rules/#cssprint",lint:function(e,t,n){var r,i,s,o,u=[],a={},f=t.getComponentsByType("css"),l=e.getElementsByTagName("link");for(r=0,len=l.length;r<len;r+=1){if(l[r].media==="print"){o=l[r].href;a[o]=1}}for(var r=0;r<f.length;r++){if(a[f[r].url]){u.push(f[r])}}s=100-u.length*parseInt(n.points,10);return{score:s,message:u.length>0?YSLOW.util.plural("There %are% %num% print css files included on the page, that should be @media query instead",u.length):"",components:u}}});YSLOW.registerRule({id:"ttfb",name:"Time to first byte",info:"It is important to have low time to the first byte to be able to render the page fast",category:["server"],config:{points:10,limitInMs:300,hurtEveryMs:100},url:"http://sitespeed.io/rules/#ttfb",lint:function(e,t,n){var r,i=parseInt(n.limitInMs,10),s=parseInt(n.hurtEveryMs,10),o,u,a=t.getComponentsByType("doc");for(r=0,len=a.length;r<len;r++){u=a[r].ttfb;if(u>i){o=100-Math.ceil((u-i)/s)*parseInt(n.points,10)}}if(o<0){o=0}return{score:o,message:o<100?"The TTFB is too slow:"+u+" ms. The limit is "+i+" ms and for every "+s+" ms points are removed":"",components:[""+u]}}});YSLOW.registerRule({id:"cssinheaddomain",name:"Load CSS in head from document domain",info:"Make sure css in head is loaded from same domain as document, in order to have a better user experience and minimize dns lookups",category:["css"],config:{points:10},url:"http://sitespeed.io/rules/#cssinheaddomain",lint:function(e,t,n){var r=e.getElementsByTagName("link"),i=t.getComponentsByType("css"),s,o,u,a={},f=[],l=[],c=100;o=YSLOW.util.getHostname(t.doc_comp.url);for(h=0,len=r.length;h<len;h++){s=r[h];u=s.href||s.getAttribute("href");if(u&&(s.rel==="stylesheet"||s.type==="text/css")){if(s.parentNode.tagName==="HEAD"){a[u]=1}}}for(var h=0;h<i.length;h++){if(a[i[h].url]){if(o!==YSLOW.util.getHostname(i[h].url)){f.push(i[h])}}}l=YSLOW.util.getUniqueDomains(f,true);var p=f.length===0?"":"The following "+YSLOW.util.plural("%num% css",f.length)+" are loaded from a different domain inside head, causing DNS lookups before page is rendered. Unique DNS in head that decreases the score:"+l.length+".";c-=l.length*parseInt(n.points,10);return{score:c,message:p,components:f}}});YSLOW.registerRule({id:"syncjsinhead",name:"Never load JS synchronously in head",info:"Use the JavaScript snippets that load the JS files asynchronously in head in order to speed up the user experience.",category:["js"],config:{points:10},url:"http://sitespeed.io/rules/#syncjsinhead",lint:function(e,t,n){var r=e.getElementsByTagName("script"),i=t.getComponentsByType("js"),s,o={},u=[],a=100;for(f=0,len=r.length;f<len;f++){s=r[f];if(s.parentNode.tagName==="HEAD"){if(s.src){if(!s.async&&!s.defer){o[s.src]=1}}}}for(var f=0;f<i.length;f++){if(o[i[f].url]){u.push(i[f])}}var l=u.length===0?"":"There are "+YSLOW.util.plural("%num% script%s%",u.length)+" that are not loaded asynchronously in head, that will block the rendering.";a-=u.length*parseInt(n.points,10);return{score:a,message:l,components:u}}});YSLOW.registerRule({id:"avoidfont",name:"Try to avoid fonts",info:"Fonts slow down the page load, try to avoid them",category:["css"],config:{points:10},url:"http://sitespeed.io/rules/#avoidfonts",lint:function(e,t,n){var r=t.getComponentsByType("font"),i;i=100-r.length*parseInt(n.points,10);var s=r.length===0?"":"There are "+YSLOW.util.plural("%num% font%s%",r.length)+" that will add extra overhead.";return{score:i,message:s,components:r}}});YSLOW.registerRule({id:"criticalpath",name:"Avoid slowing down the rendering critical path",info:"Every file loaded inside of head, will postpone the rendering of the page, try to avoid loading javascript synchronously, load files from the same domain as the main document, and inline css for really fast critical path.",category:["content"],config:{synchronouslyJSPoints:10,deferJSPoints:3,dnsLookupsPoints:5,cssPoints:5},url:"http://sitespeed.io/rules/#criticalpath",lint:function(e,t,n){var r=e.getElementsByTagName("script"),i=t.getComponentsByType("js"),s=t.getComponentsByType("css"),o=e.getElementsByTagName("link"),u=100,a,f,l=[],c=[],h,p=0,d=0,v=0,m;a=YSLOW.util.getHostname(t.doc_comp.url);for(g=0,len=r.length;g<len;g++){f=r[g];if(f.parentNode.tagName==="HEAD"){if(f.src){if(f.async){continue}else{if(f.defer){l[f.src]=1;u-=n.deferJSPoints;p++}else{l[f.src]=1;u-=n.synchronouslyJSPoints;p++}}}}}for(g=0,len=o.length;g<len;g++){h=o[g];src=h.href||h.getAttribute("href");if(h.media==="print"){continue}else{if(src&&(h.rel==="stylesheet"||h.type==="text/css")){if(h.parentNode.tagName==="HEAD"){l[src]=1;u-=n.cssPoints;d++}}}}for(var g=0;g<i.length;g++){if(l[i[g].url]){c.push(i[g])}}for(var g=0;g<s.length;g++){if(l[s[g].url]){c.push(s[g])}}m=YSLOW.util.getUniqueDomains(c,true);for(var g=0;g<m.length;g++){if(m[g]!==a){v++}}u-=n.dnsLookupsPoints*v;message=u===100?"":"You have "+p+" javascripts in the critical path and "+d+" stylesheets using "+v+" extra domains";return{score:u,message:message,components:c}}});YSLOW.registerRule({id:"totalrequests",name:"Low number of total requests is good",info:"The more number of requests, the slower the page",category:["content"],config:{points:5},url:"http://sitespeed.io/rules/#totalrequests",lint:function(e,t,n){var r=["js","css","image","cssimage","font","flash","favicon","doc","iframe"];var i=t.getComponentsByType(r);var s=100;if(i.length<26){s=100}else{s=s+26-i.length}if(s<0){s=0}var o=s===100?"":"The page uses "+i.length+" requests, that is too many to make the page load fast.";var u=s===100?"":i;return{score:s,message:o,components:u}}});YSLOW.registerRule({id:"spof",name:"Frontend single point of failure",info:"A page should not have a single point of failure a.k.a load content from a provider that can get the page to stop working.",category:["misc"],config:{jsPoints:10,cssPoints:8,fontFaceInCssPoints:8,inlineFontFacePoints:1,cssSpof:true,jsSpof:true,fontFaceInCssSpof:true,inlineFontFaceSpof:true},url:"http://sitespeed.io/rules/#spof",lint:function(t,n,r){var i=t.getElementsByTagName("link"),s=t.getElementsByTagName("script"),o=n.getComponentsByType("css"),u=n.getComponentsByType("js"),a,f,l,c,h=[],d=[],v=0,m=0,g=0,y=0,b=/@font-face[\s\n]*{([^{}]*)}/gim,w=/url\s*\(\s*['"]?([^'"]*)['"]?\s*\)/gim,E="",S=100;a=e.getTLD(YSLOW.util.getHostname(n.doc_comp.url));if(r.cssSpof){for(x=0,len=i.length;x<len;x++){csscomp=i[x];f=csscomp.href||csscomp.getAttribute("href");if(csscomp.media==="print"){continue}if(f&&(csscomp.rel==="stylesheet"||csscomp.type==="text/css")){if(csscomp.parentNode.tagName==="HEAD"){d[f]=1}}}for(var x=0;x<o.length;x++){if(d[o[x].url]){if(a!==e.getTLD(YSLOW.util.getHostname(o[x].url))){h.push(o[x]);y++}}}}if(r.fontFaceInCssSpof){for(var x=0;x<o.length;x++){c=o[x].body.match(b);if(c){c.forEach(function(t){while(l=w.exec(t)){if(!e.isSameDomainTLD(a,o[x].url,l[1])){h.push(l[1]);m++;E+=" The font file:"+l[1]+" is loaded from "+o[x].url}}})}}}if(r.inlineFontFaceSpof){c=t.documentElement.innerHTML.match(b);if(c){c.forEach(function(t){while(l=w.exec(t)){if(!e.isSameDomainTLD(a,n.doc_comp.url,l[1])){h.push(l[1]);v++;E+=" The font file:"+l[1]+" is loaded inline."}}})}}if(r.jsSpof){for(x=0,len=s.length;x<len;x++){jscomp=s[x];if(jscomp.parentNode.tagName==="HEAD"){if(jscomp.src){if(!jscomp.async&&!jscomp.defer){d[jscomp.src]=1}}}}for(var x=0;x<u.length;x++){if(d[u[x].url]){if(a!==e.getTLD(YSLOW.util.getHostname(u[x].url))){h.push(u[x]);g++}}}}var T=h.length===0?"":"There are possible of "+YSLOW.util.plural("%num% assets",h.length)+" that can cause a frontend single point of failure. ";T+=g===0?"":"There are "+YSLOW.util.plural("%num% javascript",g)+" loaded from another domain that can cause SPOF. ";T+=y===0?"":"There are "+YSLOW.util.plural("%num% css ",y)+" loaded from another domain that can cause SPOF. ";T+=m===0?"":"There are "+YSLOW.util.plural("%num%",m)+" font face in css files that can cause SPOF. "+E;T+=v===0?"":"There are "+YSLOW.util.plural("%num% ",v)+" inline font face that can cause minor SPOF. "+E;S-=g*r.jsPoints+y*r.cssPoints+v*r.inlineFontFacePoints+m*r.fontFaceInCssPoints;return{score:S,message:T,components:h}}});YSLOW.registerRule({id:"expiresmod",name:"Check for expires headers",info:"All static components of a page should have a future expire headers.",url:"http://sitespeed.io/rules/#expires",category:["server"],config:{points:11,types:["css","js","image","cssimage","flash","favicon"]},lint:function(e,t,n){var r,i,s,o,u,a,f=[],l=t.getComponentsByType(n.types);for(i=0,u=l.length;i<u;i+=1){s=l[i].expires;if(typeof s==="object"&&typeof s.getTime==="function"){if(typeof l[i].headers.date==="undefined"){r=(new Date).getTime()}else{r=(new Date(l[i].headers.date)).getTime()}if(s.getTime()>r){continue}}f.push(l[i])}o=100-f.length*parseInt(n.points,10);a=f.length>0?YSLOW.util.plural("There %are% %num% static component%s%",f.length)+" without a future expiration date.":"";return{score:o,message:a,components:f}}});YSLOW.registerRule({id:"longexpirehead",name:"Have expires headers equals or longer than one year",info:"All static components of a page should have at least one year expire header. However, analythics scripts will not give you bad points.",url:"http://sitespeed.io/rules/#longexpires",category:["server"],config:{points:5,types:["css","js","image","cssimage","flash","favicon"],skip:["https://secure.gaug.es/track.js","https://ssl.google-analytics.com/ga.js","http://www.google-analytics.com/ga.js"]},lint:function(e,t,n){var r,i,s,o,u,a,f=[],l=[],c=31535e3*1e3,h=t.getComponentsByType(n.types);for(i=0,u=h.length;i<u;i+=1){s=h[i].expires;if(typeof s==="object"&&typeof s.getTime==="function"){if(typeof h[i].headers.date==="undefined"){r=(new Date).getTime()}else{r=(new Date(h[i].headers.date)).getTime()}if(s.getTime()>r+c){continue}else{if(n.skip.indexOf(h[i].url)>1){l.push(h[i].url);continue}}}f.push(h[i])}o=100-f.length*parseInt(n.points,10);a=f.length>0?YSLOW.util.plural("There %are% %num% static component%s%",f.length)+" without a expire header equal or longer than one year.":"";a+=l.length>0?YSLOW.util.plural(" There %are% %num% static component%s% that are skipped from the score calculation",l.length)+":"+l:"";return{score:o,message:a,components:f}}});YSLOW.registerRule({id:"inlinecsswhenfewrequest",name:"Do not load css files when the page has few request",info:"When a page has few requests, it is better to inline the css, to make the page to start render as early as possible",category:["css"],config:{points:20,limit:15,types:["css","js","image","cssimage","flash","favicon"]},url:"http://sitespeed.io/rules/#inlinecsswhenfewrequest",lint:function(e,t,n){var r=t.getComponentsByType(n.types),s=t.getComponentsByType("css"),o="",u=100,a=[];if(r.length<n.limit&&s.length>0){for(i=0,len=s.length;i<len;i++){a.push(s[i].url)}o="The page have "+r.length+" requests and uses "+s.length+" css files. It is better to keep the css inline, when you have so few requests.";u-=a.length*parseInt(n.points,10)}return{score:u,message:o,components:a}}});YSLOW.registerRule({id:"textcontent",name:"Have a reasonable percentage of textual content compared to the rest of the page",info:"Make sure you dont have too much styling etc that hides the text you want to deliver",category:["content"],config:{decimals:2},url:"http://sitespeed.io/rules/#textcontent",lint:function(t,n,r){var i=0,s=100,o=[],u,a;i=e.getTextLength(t);a=i/t.body.innerHTML.length*100;if(a.toFixed(0)<50){s=a.toFixed(0)*2}u="The amount of content percentage: "+a.toFixed(r.decimals)+"%";o.push(a.toFixed(r.decimals));return{score:s,message:u,components:o}}});YSLOW.registerRule({id:"nodnslookupswhenfewrequests",name:"Avoid DNS lookups when the page has few request",info:"If you have few prequest on a page, they should all be to the same domain to avoid DNS lookups, because the lookup will take extra time",category:["content"],config:{points:20,limit:10,types:["css","image","cssimage","flash","favicon"]},url:"http://sitespeed.io/rules/#nodnslookupswhenfewrequests",lint:function(e,t,n){var r,i,s=t.getComponentsByType(n.types),o=t.getComponentsByType("js"),u=100,a="",f=[],l=[],c=e.getElementsByTagName("script");for(h=0,len=c.length;h<len;h++){i=c[h];if(i.src){if(!i.async&&!i.defer){l[i.src]=1}}}for(var h=0;h<o.length;h++){if(l[o[h].url]){s.push(o[h])}}r=YSLOW.util.getUniqueDomains(s);if(s.length<n.limit&&r.length>1){for(h=0,len=s.length;h<len;h++){f.push(s[h].url)}a="Too many domains ("+r.length+") used for a page with only "+s.length+" requests (async javascripts not included)";u-=f.length*parseInt(n.points,10)}return{score:u,message:a,components:f}}});var n={};n.is3p=function(e){var t=["ajax.googleapis.com","apis.google.com",".google-analytics.com","connect.facebook.net","platform.twitter.com","code.jquery.com","platform.linkedin.com",".disqus.com","assets.pinterest.com","widgets.digg.com",".addthis.com","code.jquery.com","ad.doubleclick.net",".lognormal.com","embed.spotify.com"];var n=YSLOW.util.getHostname(e);var r;for(var i=0;i<t.length;i++){r=new RegExp(t[i]);if(r.test(n)){return true}}return false};YSLOW.registerRule({id:"thirdpartyasyncjs",name:"Load 3rd party JS asynchronously",info:"Use the JavaScript snippets that load the JS files asynchronously in order to speed up the user experience.",category:["js"],config:{},url:"http://www.phpied.com/3PO#async",lint:function(e,t,r){var i=e.getElementsByTagName("script"),s=t.getComponentsByType("js"),o,u={},a=[],f=100;for(l=0,len=i.length;l<len;l++){o=i[l];if(o.src&&n.is3p(o.src)){if(!o.async&&!o.defer){u[o.src]=1}}}for(var l=0;l<s.length;l++){if(u[s[l].url]){a.push(s[l])}}var c=a.length===0?"":"The following "+YSLOW.util.plural("%num% 3rd party script%s%",a.length)+" not loaded asynchronously:";f-=a.length*21;return{score:f,message:c,components:a}}});YSLOW.registerRule({id:"cssnumreq",name:"Make fewer HTTP requests for CSS files",info:"The more number of CSS requests, the slower the page will be. Combine your css files into one.",category:["css"],config:{max_css:1,points_css:4},url:"http://sitespeed.io/rules/#cssnumreq",lint:function(e,t,n){var r=t.getComponentsByType("css"),i=100,s=[],o="";if(r.length>n.max_css){i-=(r.length-n.max_css)*n.points_css;o="This page has "+YSLOW.util.plural("%num% external stylesheet%s%",r.length)+". Try combining them into fewer requests.";for(var u=0;u<r.length;u++){s.push(r[u].url)}}return{score:i,message:o,components:s}}});YSLOW.registerRule({id:"cssimagesnumreq",name:"Make fewer HTTP requests for CSS image files",info:"The more number of CSS image requests, the slower the page. Combine your images into one CSS sprite.",url:"http://sitespeed.io/rules/#cssimagsenumreq",category:["css"],config:{max_cssimages:1,points_cssimages:3},lint:function(e,t,n){var r=t.getComponentsByType("cssimage"),i=100,s=[],o="";if(r.length>n.max_cssimages){i-=(r.length-n.max_cssimages)*n.points_cssimages;o="This page has "+YSLOW.util.plural("%num% external css image%s%",r.length)+". Try combining them into fewer request.";for(var u=0;u<r.length;u++){s.push(r[u].url)}}return{score:i,message:o,components:s}}});YSLOW.registerRule({id:"jsnumreq",name:"Make fewer synchronously HTTP requests for Javascript files",info:"Combine the Javascrips into one.",category:["js"],config:{max_js:1,points_js:4},url:"http://sitespeed.io/rules/#jsnumreq",lint:function(e,t,n){var r=e.getElementsByTagName("script"),i=t.getComponentsByType("js"),s,o={},u=[],a="",f=100;for(l=0,len=r.length;l<len;l++){s=r[l];if(s.src){if(!s.async&&!s.defer){o[s.src]=1}}}for(var l=0;l<i.length;l++){if(o[i[l].url]){u.push(i[l])}}if(u.length>n.max_js){a="There "+YSLOW.util.plural("%are% %num% script%s%",u.length)+" loaded synchronously that could be combined into fewer requests.";f-=(u.length-n.max_js)*parseInt(n.points_js,10)}return{score:f,message:a,components:u}}});YSLOW.registerRule({id:"noduplicates",name:"Remove duplicate JS and CSS",info:"It is bad practice include the same js or css twice",category:["js","css"],config:{},url:"http://developer.yahoo.com/performance/rules.html#js_dupes",lint:function(e,t,n){var r,i,s,o,u,a={},f=[],l=t.getComponentsByType(["js","css"]),c=e.getElementsByTagName("script"),h=e.getElementsByTagName("link");for(r=0,o=c.length;r<o;r+=1){i=c[r].src;if(typeof a[i]==="undefined"){a[i]=1}else{a[i]+=1}}for(r=0,o=h.length;r<o;r+=1){u=h[r];i=u.href||u.getAttribute("href");if(i&&(u.rel==="stylesheet"||u.type==="text/css")){if(typeof a[i]==="undefined"){a[i]=1}else{a[i]+=1}}}var f=[];for(var r=0;r<l.length;r++){if(a[l[r].url]&&a[l[r].url]>1){f.push(l[r])}}s=100-f.length*11;return{score:s,message:f.length>0?YSLOW.util.plural("There %are% %num% js/css file%s% included more than once on the page",f.length):"",components:f}}});YSLOW.registerRule({id:"mindom",name:"Reduce the number of DOM elements",info:"The number of dom elements are in correlation to if the page is fast or not",url:"http://developer.yahoo.com/performance/rules.html#min_dom",category:["content"],config:{range:250,points:10,maxdom:900},lint:function(e,t,n){var r=t.domElementsCount,i=100;if(r>n.maxdom){i=99-Math.ceil((r-parseInt(n.maxdom,10))/parseInt(n.range,10))*parseInt(n.points,10)}return{score:i,message:r>n.maxdom?YSLOW.util.plural("There %are% %num% DOM element%s% on the page",r):"",components:[""+r]}}});YSLOW.registerRule({id:"thirdpartyversions",name:"Always use latest versions of third party javascripts",info:"Unisng the latest versions, will make sure you have the fastest and hopefully leanest javascripts.",url:"http://sitespeed.io/rules/#thirdpartyversions",category:["js"],config:{points:10},lint:function(t,n,r){var i="",s,o=0;if(typeof jQuery=="function"){if(e.versionCompare(jQuery.fn.jquery,[2,0,0])){i="You are using an old version of JQuery: "+jQuery.fn.jquery+" Newer version is faster & better. Upgrade to the newest version from http://jquery.com/";o+=1}}s=100-o*parseInt(r.points,10);return{score:s,message:i,components:[]}}});YSLOW.registerRule({id:"avoidscalingimages",name:"Never scale images in HTML",info:"Always use the correct size for images to avoid that a browser download an image that is larger than necessary.",url:"http://sitespeed.io/rules/#avoidscalingimages",category:["images"],config:{reallyBadLimit:100},lint:function(e,t,n){var r="",i,s=[],o={},u=0,a=t.getComponentsByType("image"),f=e.getElementsByTagName("img");for(var l=0;l<f.length;l++){var c=f[l];if(c.clientWidth<c.naturalWidth&&c.clientWidth>0){r=r+" "+c.src+" [browserWidth:"+c.clientWidth+" realImageWidth: "+c.naturalWidth+"]";o[c.src]=1;if(c.clientWidth+n.reallyBadLimit<c.naturalWidth){u++}}}for(var l=0;l<a.length;l++){if(o[a[l].url]){s.push(a[l])}}i=100-(s.length-u)*2-u*10;return{score:i,message:s.length>0?YSLOW.util.plural("You have %num% image%s% that %are% scaled in the HTML:"+r,s.length):"",components:s}}});YSLOW.registerRule({id:"redirects",name:"Never do redirects",info:"Avoid doing redirects, it will kill you web page on mobile.",url:"http://sitespeed.io/rules/#redirects",category:["content"],config:{points:10},lint:function(e,t,n){var r;r=100-t.redirects.length*parseInt(n.points,10);return{score:r,message:t.redirects.length>0?YSLOW.util.plural("There %are% %num% redirect%s%.",t.redirects.length)+" "+t.redirects:"",components:[]}}});YSLOW.registerRuleset({id:"sitespeed.io-desktop",name:"Sitespeed.io desktop rules",rules:{criticalpath:{},spof:{fontFaceInCssSpof:false,inlineFontFaceSpof:false},cssnumreq:{},cssimagesnumreq:{},jsnumreq:{},yemptysrc:{},ycompress:{},ycsstop:{},yjsbottom:{},yexpressions:{},ydns:{},yminify:{},redirects:{},noduplicates:{},yetags:{},yxhr:{},yxhrmethod:{},mindom:{},yno404:{},ymincookie:{},ycookiefree:{},ynofilter:{},avoidscalingimages:{},yfavicon:{},thirdpartyasyncjs:{},cssprint:{},cssinheaddomain:{},syncjsinhead:{},avoidfont:{},totalrequests:{},expiresmod:{},longexpirehead:{},nodnslookupswhenfewrequests:{},inlinecsswhenfewrequest:{},textcontent:{},thirdpartyversions:{}},weights:{criticalpath:15,spof:5,cssnumreq:8,cssimagesnumreq:8,jsnumreq:8,yemptysrc:30,ycompress:8,ycsstop:4,yjsbottom:4,yexpressions:3,ydns:3,yminify:4,redirects:4,noduplicates:4,yetags:2,yxhr:4,yxhrmethod:3,mindom:3,yno404:4,ymincookie:3,ycookiefree:3,ynofilter:4,avoidscalingimages:5,yfavicon:2,thirdpartyasyncjs:10,cssprint:3,cssinheaddomain:8,syncjsinhead:20,avoidfont:1,totalrequests:10,expiresmod:10,longexpirehead:5,nodnslookupswhenfewrequests:8,inlinecsswhenfewrequest:7,textcontent:1,thirdpartyversions:5}});YSLOW.registerRuleset({id:"sitespeed.io-mobile",name:"Sitespeed.io mobile rules",rules:{criticalpath:{},spof:{fontFaceInCssSpof:false,inlineFontFaceSpof:false},cssnumreq:{},cssimagesnumreq:{},jsnumreq:{},yemptysrc:{},ycompress:{},ycsstop:{},yjsbottom:{},yexpressions:{},ydns:{},yminify:{},redirects:{},noduplicates:{},yetags:{},yxhr:{},yxhrmethod:{},mindom:{},yno404:{},ymincookie:{},ycookiefree:{},ynofilter:{},avoidscalingimages:{},yfavicon:{},thirdpartyasyncjs:{},cssprint:{},cssinheaddomain:{},syncjsinhead:{},avoidfont:{},totalrequests:{},expiresmod:{},longexpirehead:{},nodnslookupswhenfewrequests:{},inlinecsswhenfewrequest:{},textcontent:{},thirdpartyversions:{}},weights:{criticalpath:20,spof:5,cssnumreq:8,cssimagesnumreq:8,jsnumreq:8,yemptysrc:30,ycompress:8,ycsstop:4,yjsbottom:4,yexpressions:3,ydns:3,yminify:4,redirects:15,noduplicates:4,yetags:2,yxhr:4,yxhrmethod:3,mindom:3,yno404:4,ymincookie:3,ycookiefree:3,ynofilter:4,avoidscalingimages:10,yfavicon:2,thirdpartyasyncjs:10,cssprint:3,cssinheaddomain:8,syncjsinhead:20,avoidfont:5,totalrequests:14,expiresmod:10,longexpirehead:5,nodnslookupswhenfewrequests:15,inlinecsswhenfewrequest:10,textcontent:1,thirdpartyversions:5}});YSLOW.registerRuleset({id:"sitespeed.io-desktop-http2.0",name:"Sitespeed.io desktop rules for HTTP 2.0",rules:{criticalpath:{},spof:{fontFaceInCssSpof:false,inlineFontFaceSpof:false},yemptysrc:{},ycompress:{},ycsstop:{},yjsbottom:{},yexpressions:{},ydns:{},yminify:{},redirects:{},noduplicates:{},yetags:{},yxhr:{},yxhrmethod:{},mindom:{},yno404:{},ymincookie:{},ycookiefree:{},ynofilter:{},avoidscalingimages:{},yfavicon:{},thirdpartyasyncjs:{},cssprint:{},cssinheaddomain:{},syncjsinhead:{},avoidfont:{},expiresmod:{},longexpirehead:{},textcontent:{},thirdpartyversions:{}},weights:{criticalpath:15,spof:5,yemptysrc:30,ycompress:8,ycsstop:4,yjsbottom:4,yexpressions:3,ydns:3,yminify:4,redirects:4,noduplicates:4,yetags:2,yxhr:4,yxhrmethod:3,mindom:3,yno404:4,ymincookie:3,ycookiefree:3,ynofilter:4,avoidscalingimages:5,yfavicon:2,thirdpartyasyncjs:10,cssprint:3,cssinheaddomain:8,syncjsinhead:20,avoidfont:1,expiresmod:10,longexpirehead:5,textcontent:1,thirdpartyversions:5}});YSLOW.ResultSet=function(e,t,n){this.ruleset_applied=n;this.overall_score=t;this.results=e};YSLOW.ResultSet.prototype={getResults:function(){return this.results},getRulesetApplied:function(){return this.ruleset_applied},getOverallScore:function(){return this.overall_score}};YSLOW.view=function(e,t){var n,r,i,s,o;this.panel_doc=e.document;this.buttonViews={};this.curButtonId="";this.panelNode=e.panelNode;this.loadCSS(this.panel_doc);n=this.panel_doc.createElement("div");n.id="toolbarDiv";n.innerHTML=this.getToolbarSource();n.style.display="block";r=this.panel_doc.createElement("div");r.style.display="block";i='<div class="dialog-box"><h1><div class="dialog-text">text</div></h1><div class="dialog-more-text"></div><div class="buttons"><input class="dialog-left-button" type="button" value="Ok" onclick="javascript:document.ysview.closeDialog(document)"><input class="dialog-right-button" type="button" value="Cancel" onclick="javascript:document.ysview.closeDialog(document)"></div></div><div class="dialog-mask"></div>';s=this.panel_doc.createElement("div");s.id="dialogDiv";s.innerHTML=i;s.style.display="none";this.modaldlg=s;this.tooltip=new YSLOW.view.Tooltip(this.panel_doc,e.panelNode);o=this.panel_doc.createElement("div");o.id="copyrightDiv";o.innerHTML=YSLOW.doc.copyright;this.copyright=o;if(e.panelNode){e.panelNode.id="yslowDiv";e.panelNode.appendChild(s);e.panelNode.appendChild(n);e.panelNode.appendChild(r);e.panelNode.appendChild(o)}this.viewNode=r;this.viewNode.id="viewDiv";this.viewNode.className="yui-skin-sam";this.yscontext=t;YSLOW.util.addEventListener(this.panelNode,"click",function(t){var n,r,i,s,o;var u=FBL.getContentView(e.document);var a=u.ysview.getElementByTagNameAndId(e.panelNode,"div","toolbarDiv");if(a){r=u.ysview.getElementByTagNameAndId(a,"li","helpLink");if(r){i=r.offsetLeft;s=r.offsetTop;o=r.offsetParent;while(o){i+=o.offsetLeft;s+=o.offsetTop;o=o.offsetParent}if(t.clientX>=i&&t.clientY>=s&&t.clientX<i+r.offsetWidth&&t.clientY<s+r.offsetHeight){return}}n=u.ysview.getElementByTagNameAndId(a,"div","helpDiv")}if(n&&n.style.visibility==="visible"){n.style.visibility="hidden"}});YSLOW.util.addEventListener(this.panelNode,"scroll",function(t){var n=FBL.getContentView(e.document);var r=n.ysview.modaldlg;if(r&&r.style.display==="block"){r.style.top=e.panelNode.scrollTop+"px";r.style.left=e.panelNode.scrollLeft+"px"}});YSLOW.util.addEventListener(this.panelNode,"mouseover",function(t){var n;if(t.target&&typeof t.target==="object"){if(t.target.nodeName==="LABEL"&&t.target.className==="rules"){if(t.target.firstChild&&t.target.firstChild.nodeName==="INPUT"&&t.target.firstChild.type==="checkbox"){n=YSLOW.controller.getRule(t.target.firstChild.value);var r=FBL.getContentView(e.document);r.ysview.tooltip.show("<b>"+n.name+"</b><br><br>"+n.info,t.target)}}}});YSLOW.util.addEventListener(this.panelNode,"mouseout",function(t){var n=FBL.getContentView(e.document);n.ysview.tooltip.hide()});YSLOW.util.addEventListener(this.panel_doc.defaultView||this.panel_doc.parentWindow,"resize",function(t){var n=FBL.getContentView(e.document);var r=n.ysview.modaldlg;if(r&&r.style.display==="block"){r.style.display="none"}})};YSLOW.view.prototype={setDocument:function(e){this.panel_doc=e},loadCSS:function(){},addButtonView:function(e,t){var n=this.getButtonView(e);if(!n){n=this.panel_doc.createElement("div");n.style.display="none";this.viewNode.appendChild(n);this.buttonViews[e]=n}n.innerHTML=t;this.showButtonView(e)},clearAllButtonView:function(){var e=this.buttonViews,t=this.viewNode,n=function(n){if(e.hasOwnProperty(n)){t.removeChild(e[n]);delete e[n]}};n("ysPerfButton");n("ysCompsButton");n("ysStatsButton")},showButtonView:function(e){var t,n=this.getButtonView(e);if(!n){YSLOW.util.dump("ERROR: YSLOW.view.showButtonView: Couldn't find ButtonView '"+e+"'.");return}for(t in this.buttonViews){if(this.buttonViews.hasOwnProperty(t)&&t!==e){this.buttonViews[t].style.display="none"}}if(e==="ysPerfButton"){if(this.copyright){this.copyright.style.display="none"}}else{if(this.curButtonId==="ysPerfButton"){if(this.copyright){this.copyright.style.display="block"}}}n.style.display="block";this.curButtonId=e},getButtonView:function(e){return this.buttonViews.hasOwnProperty(e)?this.buttonViews[e]:undefined},setButtonView:function(e,t){var n=this.getButtonView(e);if(!n){YSLOW.util.dump("ERROR: YSLOW.view.setButtonView: Couldn't find ButtonView '"+e+"'.");return}n.innerHTML=t;this.showButtonView(e)},setSplashView:function(e,t,n){var r,i="Grade your web pages with YSlow",s="YSlow gives you:",o="<li>Grade based on the performance (you can define your own rules)</li><li>Summary of the Components in the page</li><li>Chart with statistics</li><li>Tools including Smush.It and JSLint</li>",u="Learn more about YSlow and YDN";if(YSLOW.doc.splash){if(YSLOW.doc.splash.title){i=YSLOW.doc.splash.title}if(YSLOW.doc.splash.content){if(YSLOW.doc.splash.content.header){s=YSLOW.doc.splash.content.header}if(YSLOW.doc.splash.content.text){o=YSLOW.doc.splash.content.text}}if(YSLOW.doc.splash.more_info){u=YSLOW.doc.splash.more_info}}if(typeof n!=="undefined"){YSLOW.hideToolsInfo=n}else{n=YSLOW.hideToolsInfo}if(n){o=o.replace(/<li>Tools[^<]+<\/li>/,"")}r='<div id="splashDiv"><div id="splashDivCenter"><b id="splashImg" width="250" height="150" alt="splash image" src="chrome://yslow/content/yslow/img/speedometer.png"></b><div id="left"><h2>'+i+'</h2><div id="content" class="padding50"><h3>'+s+'</h3><ul id="splashBullets">'+o+"</ul>";if(typeof e!=="undefined"){YSLOW.hideAutoRun=e}else{e=YSLOW.hideAutoRun}if(!e){r+='<label><input type="checkbox" name="autorun" onclick="javascript:document.ysview.setAutorun(this.checked)" ';if(YSLOW.util.Preference.getPref("extensions.yslow.autorun",false)){r+="checked"}r+="> Autorun YSlow each time a web page is loaded</label>"}if(typeof t!=="undefined"){YSLOW.showAntiIframe=t}else{t=YSLOW.showAntiIframe}if(t){r+='<label><input type="checkbox" onclick="javascript:document.ysview.setAntiIframe(this.checked)"> Check here if the current page prevents itself from being embedded/iframed. A simpler post onload detection will be used instead.</label>'}r+='<div id="runtestDiv"><button id="runtest-btn" onclick="javascript:document.ysview.runTest()">Run Test</button></div></div><div class="footer"><div class="moreinfo"><a href="javascript:document.ysview.openLink(\'https://yslow.org/\');"><b>&#187;</b>'+u+"</a></div></div></div></div></div>";this.addButtonView("panel_about",r)},genProgressView:function(){var e='<div id="progressDiv"><div id="peel"><p>Finding components in the page:</p><div id="peelprogress"><div id="progbar"></div></div><div id="progtext"></div></div><div id="fetch"><p>Getting component information:</p><div id="fetchprogress"><div id="progbar2"></div></div><div id="progtext2">start...</div></div></div>';this.setButtonView("panel_about",e)},updateProgressView:function(e,t){var n,r,i,s,o,u,a,f,l="";if(this.curButtonId==="panel_about"){o=this.getButtonView(this.curButtonId);if(e==="peel"){n=this.getElementByTagNameAndId(o,"div","peelprogress");r=this.getElementByTagNameAndId(o,"div","progbar");i=this.getElementByTagNameAndId(o,"div","progtext");l=t.message;s=t.current_step*100/t.total_step}else{if(e==="fetch"){n=this.getElementByTagNameAndId(o,"div","fetchprogress");r=this.getElementByTagNameAndId(o,"div","progbar2");i=this.getElementByTagNameAndId(o,"div","progtext2");l=t.last_component_url;s=t.current*100/t.total}else{if(e==="message"){i=this.getElementByTagNameAndId(o,"div","progtext2");if(i){i.innerHTML=t}return}else{return}}}}if(n&&r&&i){u=n.clientWidth;if(s<0){s=0}if(s>100){s=100}s=100-s;a=u*s/100;if(a>u){a=u}f=u-parseInt(a,10);r.style.width=parseInt(a,10)+"px";r.style.left=parseInt(f,10)+"px";i.innerHTML=l}},updateStatusBar:function(e){var t,n,r,i,s,o=YSLOW,u=o.util,a=o.view,f=u.Preference,l=this.yscontext;if(!l.PAGE.statusbar){l.PAGE.statusbar=true;if(!l.PAGE.overallScore){o.controller.lint(e,l)}if(!l.PAGE.totalSize){l.collectStats()}t=u.kbSize(l.PAGE.totalSize);n=u.prettyScore(l.PAGE.overallScore);a.setStatusBar(n,"yslow_status_grade");a.setStatusBar(t,"yslow_status_size");if(f.getPref("optinBeacon",false)){i=f.getPref("beaconInfo","basic"),s=f.getPref("beaconUrl","http://rtblab.pclick.yahoo.com/images/ysb.gif");r=u.getResults(l,i);u.sendBeacon(r,i,s)}}},getRulesetListSource:function(e){var t,n,r="",i=YSLOW.controller.getDefaultRulesetId();for(t in e){if(e[t]){r+='<option value="'+e[t].id+'" ';if(!n&&e[t].hasOwnProperty("custom")&&e[t].custom){n=true;r+='class="firstInGroup" '}if(i!==undefined&&t===i){r+="selected"}r+=">"+e[t].name+"</option>"}}return r},updateRulesetList:function(){var e,t,n,r=this.panel_doc.getElementsByTagName("select"),i=YSLOW.controller.getRegisteredRuleset(),s=this.getRulesetListSource(i),o=function(e){var t=FBL.getContentView(this.ownerDocument);t.ysview.onChangeRuleset(e)};for(e=0;e<r.length;e+=1){if(r[e].id==="toolbar-rulesetList"){t=r[e].parentNode;if(t&&t.id==="toolbar-ruleset"){n=this.panel_doc.createElement("select");if(n){n.id="toolbar-rulesetList";n.name="rulesets";n.onchange=o;n.innerHTML=s}t.replaceChild(n,r[e])}}}},getToolbarSource:function(){var e,t,n='<div id="menu">',r={home:"Home",grade:"Grade",components:"Components",stats:"Statistics",tools:"Tools"};if(YSLOW.doc&&YSLOW.doc.view_names){for(e in r){if(r.hasOwnProperty(e)&&YSLOW.doc.view_names[e]){r[e]=YSLOW.doc.view_names[e]}}}t=YSLOW.controller.getRegisteredRuleset();n='<div id="toolbar-ruleset" class="floatRight">Rulesets <select id="toolbar-rulesetList" name="rulesets" onchange="javascript:document.ysview.onChangeRuleset(event)">'+this.getRulesetListSource(t)+"</select>";n+='<button onclick="javascript:document.ysview.showRuleSettings()">Edit</button><ul id="tbActions"><li id="printLink" class="first"><a href="javascript:document.ysview.openPrintableDialog(document)"><b class="icon">&asymp;</b><em>Printable View</em></a></li><li id="helpLink"><a href="javascript:document.ysview.showHideHelp()"><b class="icon">?</b><em>Help &darr;</em></a></li></ul></div>';n+='<div id="helpDiv" class="help" style="visibility: hidden"><div><a href="javascript:document.ysview.openLink(\'https://github.com/marcelduran/yslow/wiki/User-Guide\')">YSlow Help</a></div><div><a href="javascript:document.ysview.openLink(\'https://github.com/marcelduran/yslow/wiki/FAQ\')">YSlow FAQ</a></div><div class="new-section"><a href="javascript:document.ysview.openLink(\'http://yslow.org/blog/\')">YSlow Blog</a></div><div><a href="javascript:document.ysview.openLink(\'http://tech.groups.yahoo.com/group/exceptional-performance/\')">YSlow Community</a></div><div class="new-section"><a href="javascript:document.ysview.openLink(\'https://github.com/marcelduran/yslow/issues\')">YSlow Issues</a></div><div class="new-section"><div><a class="social yslow" href="javascript:document.ysview.openLink(\'http://yslow.org/\')">YSlow Home</a></div><div><a class="social facebook" href="javascript:document.ysview.openLink(\'http://www.facebook.com/getyslow\')">Like YSlow</a></div><div><a class="social twitter" href="javascript:document.ysview.openLink(\'http://twitter.com/yslow\')">Follow YSlow</a></div></div><div class="new-section" id="help-version">Version '+YSLOW.version+"</div></div>";n+='<div id="nav-menu"><ul class="yui-nav" id="toolbarLinks"><li class="first selected off" id="ysHomeButton"><a href="javascript:document.ysview.setSplashView()" onclick="javascript:document.ysview.onclickToolbarMenu(event)"><em>'+r.home+'</em><span class="pipe"/></a></li><li id="ysPerfButton"><a href="javascript:document.ysview.showPerformance()" onclick="javascript:document.ysview.onclickToolbarMenu(event)"><em>'+r.grade+'</em><span class="pipe"/></a></li><li id="ysCompsButton"><a href="javascript:document.ysview.showComponents()" onclick="javascript:document.ysview.onclickToolbarMenu(event)"><em>'+r.components+'</em><span class="pipe"/></a></li><li id="ysStatsButton"><a href="javascript:document.ysview.showStats()" onclick="javascript:document.ysview.onclickToolbarMenu(event)"><em>'+r.stats+'</em><span class="pipe"/></a></li><li id="ysToolButton"><a href="javascript:document.ysview.showTools()" onclick="javascript:document.ysview.onclickToolbarMenu(event)"><em>'+r.tools+"</em></a></li></ul></div>";n+="</div>";return n},show:function(e){var t="html",n="";e=e||this.yscontext.defaultview;if(this.yscontext.component_set===null){YSLOW.controller.run(window.top.content,this.yscontext,false);this.yscontext.defaultview=e}else{if(this.getButtonView(e)){this.showButtonView(e)}else{if("ysCompsButton"===e){n+=this.yscontext.genComponents(t);this.addButtonView("ysCompsButton",n)}else{if("ysStatsButton"===e){n+=this.yscontext.genStats(t);this.addButtonView("ysStatsButton",n);YSLOW.renderer.plotComponents(this.getButtonView("ysStatsButton"),this.yscontext)}else{if("ysToolButton"===e){n+=this.yscontext.genToolsView(t);this.addButtonView("ysToolButton",n)}else{n+=this.yscontext.genPerformance(t);this.addButtonView("ysPerfButton",n)}}}}this.panelNode.scrollTop=0;this.panelNode.scrollLeft=0;this.updateStatusBar(this.yscontext.document);this.updateToolbarSelection()}},updateToolbarSelection:function(){var e,t,n;switch(this.curButtonId){case"ysCompsButton":case"ysPerfButton":case"ysStatsButton":case"ysToolButton":e=this.getElementByTagNameAndId(this.panelNode,"li",this.curButtonId);if(e){if(e.className.indexOf("selected")!==-1){return}else{e.className+=" selected";if(e.previousSibling){e.previousSibling.className+=" off"}}}break;default:break}t=this.getElementByTagNameAndId(this.panelNode,"ul","toolbarLinks");n=t.firstChild;while(n){if(n.id!==this.curButtonId&&n.className.indexOf("selected")!==-1){this.unselect(n);if(n.previousSibling){YSLOW.view.removeClassName(n.previousSibling,"off")}}n=n.nextSibling}},showPerformance:function(){this.show("ysPerfButton")},showStats:function(){this.show("ysStatsButton")},showComponents:function(){this.show("ysCompsButton")},showTools:function(){this.show("ysToolButton")},showRuleSettings:function(){var e=this.yscontext.genRulesetEditView("html");this.addButtonView("ysRuleEditButton",e);this.panelNode.scrollTop=0;this.panelNode.scrollLeft=0;this.updateToolbarSelection()},runTest:function(){YSLOW.controller.run(window.top.content,this.yscontext,false)},setAutorun:function(e){YSLOW.util.Preference.setPref("extensions.yslow.autorun",e)},setAntiIframe:function(e){YSLOW.antiIframe=e},addCDN:function(e){var t,n,r=this,i=document,s=r.yscontext,o=YSLOW.util.Preference,u=o.getPref("cdnHostnames",""),a=r.panel_doc,f=a.getElementById("tab-label-list"),l=f.getElementsByTagName("li"),c=l.length;if(u){u=u.replace(/\s+/g,"").split(",");u.push(e);u=u.join()}else{u=e}o.setPref("extensions.yslow.cdnHostnames",u);for(t=0;t<c;t+=1){f=l[t];if(f.className.indexOf("selected")>-1){n=f.id;break}}YSLOW.controller.lint(s.document,s);r.addButtonView("ysPerfButton",s.genPerformance("html"));YSLOW.view.restoreStatusBar(s);r.updateToolbarSelection();f=a.getElementById(n);r.onclickTabLabel({currentTarget:f},true)},onChangeRuleset:function(e){var t,n,r,i,s=YSLOW.util.getCurrentTarget(e),o=s.options[s.selectedIndex];YSLOW.controller.setDefaultRuleset(o.value);t=s.ownerDocument;n="Do you want to run the selected ruleset now?";r="Run Test";i=function(e){var n;t.ysview.closeDialog(t);if(t.yslowContext.component_set===null){YSLOW.controller.run(t.yslowContext.document.defaultView||t.yslowContext.document.parentWindow,t.yslowContext,false)}else{YSLOW.controller.lint(t.yslowContext.document,t.yslowContext)}n=t.yslowContext.genPerformance("html");t.ysview.addButtonView("ysPerfButton",n);t.ysview.panelNode.scrollTop=0;t.ysview.panelNode.scrollLeft=0;YSLOW.view.restoreStatusBar(t.yslowContext);t.ysview.updateToolbarSelection()};this.openDialog(t,389,150,n,undefined,r,i)},onclickTabLabel:function(e,t){var n,r,i,s,o,u,a,f=YSLOW.util.getCurrentTarget(e),l=f.parentNode,c=l.nextSibling;if(f.className.indexOf("selected")!==-1||f.id.indexOf("label")===-1){return false}if(l){n=l.firstChild;while(n){if(this.unselect(n)){r=n.id.substring(5);break}n=n.nextSibling}f.className+=" selected";i=f.id.substring(5);n=c.firstChild;while(n){a=n.id.substring(3);if(!s&&r&&a===r){if(n.className.indexOf("yui-hidden")===-1){n.className+=" yui-hidden"}s=true}if(!o&&i&&a===i){YSLOW.view.removeClassName(n,"yui-hidden");o=true;u=n}if((s||!r)&&(o||!i)){break}n=n.nextSibling}if(t===true&&o===true&&u){this.positionResultTab(u,c,f)}}return false},positionResultTab:function(e,t,n){var r,i,s,o=5,u=this.panel_doc,a=u.defaultView||u.parentWindow,f=a.offsetHeight?a.offsetHeight:a.innerHeight,l=n.offsetTop+e.offsetHeight;t.style.height=l+"px";e.style.position="absolute";e.style.left=n.offsetLeft+n.offsetWidth+"px";e.style.top=n.offsetTop+"px";r=e.offsetTop;i=e.offsetParent;while(i!==null){r+=i.offsetTop;i=i.offsetParent}if(r<this.panelNode.scrollTop||r+e.offsetHeight>this.panelNode.scrollTop+f){if(r<this.panelNode.scrollTop){this.panelNode.scrollTop=r-o}else{s=r+e.offsetHeight-this.panelNode.scrollTop-f+o;if(s>r-this.panelNode.scrollTop){s=r-this.panelNode.scrollTop}this.panelNode.scrollTop+=s}}},onclickResult:function(e){YSLOW.util.preventDefault(e);return this.onclickTabLabel(e,true)},unselect:function(e){return YSLOW.view.removeClassName(e,"selected")},filterResult:function(e,t){var n,r,i,s,o,u,a,f=this.getButtonView("ysPerfButton");if(t==="all"){r=true}if(f){n=this.getElementByTagNameAndId(f,"ul","tab-label-list")}if(n){i=n.firstChild;a=n.nextSibling;o=a.firstChild;while(i){YSLOW.view.removeClassName(i,"first");if(r||i.className.indexOf(t)!==-1){i.style.display="block";if(s===undefined){s=o;u=i;YSLOW.view.removeClassName(o,"yui-hidden");i.className+=" first";if(i.className.indexOf("selected")===-1){i.className+=" selected"}i=i.nextSibling;o=o.nextSibling;continue}}else{i.style.display="none"}if(o.className.indexOf("yui-hidden")===-1){o.className+=" yui-hidden"}this.unselect(i);i=i.nextSibling;o=o.nextSibling}if(s){this.positionResultTab(s,a,u)}}},updateFilterSelection:function(e){var t,n=YSLOW.util.getCurrentTarget(e);YSLOW.util.preventDefault(e);if(n.className.indexOf("selected")!==-1){return}n.className+=" selected";t=n.parentNode.firstChild;while(t){if(t!==n&&this.unselect(t)){break}t=t.nextSibling}this.filterResult(n.ownerDocument,n.id)},onclickToolbarMenu:function(e){var t,n=YSLOW.util.getCurrentTarget(e),r=n.parentNode,i=r.parentNode;if(r.className.indexOf("selected")!==-1){return}r.className+=" selected";if(r.previousSibling){r.previousSibling.className+=" off"}if(i){t=i.firstChild;while(t){if(t!==r&&this.unselect(t)){if(t.previousSibling){YSLOW.view.removeClassName(t.previousSibling,"off")}break}t=t.nextSibling}}},expandCollapseComponentType:function(e,t){var n,r=YSLOW.controller.getRenderer("html"),i=this.getButtonView("ysCompsButton");if(i){n=this.getElementByTagNameAndId(i,"table","components-table");r.expandCollapseComponentType(e,n,t)}},expandAll:function(e){var t,n=YSLOW.controller.getRenderer("html"),r=this.getButtonView("ysCompsButton");if(r){t=this.getElementByTagNameAndId(r,"table","components-table");n.expandAllComponentType(e,t)}},regenComponentsTable:function(e,t,n){var r,i=YSLOW.controller.getRenderer("html"),s=this.getButtonView("ysCompsButton");if(s){r=this.getElementByTagNameAndId(s,"table","components-table");i.regenComponentsTable(e,r,t,n,this.yscontext.component_set)}},showComponentHeaders:function(e){var t,n,r=this.getButtonView("ysCompsButton");if(r){t=this.getElementByTagNameAndId(r,"tr",e);if(t){n=t.firstChild;if(t.style.display==="none"){t.style.display="table-row"}else{t.style.display="none"}}}},openLink:function(e){YSLOW.util.openLink(e)},openPopup:function(e,t,n,r,i){window.open(e,t||"_blank","width="+(n||626)+",height="+(r||436)+","+(i||"toolbar=0,status=1,location=1,resizable=1"))},runTool:function(e,t){YSLOW.controller.runTool(e,this.yscontext,t)},onclickRuleset:function(e){var t,n,r,i,s=YSLOW.util.getCurrentTarget(e),o=s.className.indexOf("ruleset-");YSLOW.util.preventDefault(e);if(o!==-1){n=s.className.indexOf(" ",o+8);if(n!==-1){t=s.className.substring(o+8,n)}else{t=s.className.substring(o+8)}r=this.getButtonView("ysRuleEditButton");if(r){i=this.getElementByTagNameAndId(r,"form","edit-form");YSLOW.renderer.initRulesetEditForm(s.ownerDocument,i,YSLOW.controller.getRuleset(t))}}return this.onclickTabLabel(e,false)},openSaveAsDialog:function(e,t){var n='<label>Save ruleset as: <input type="text" id="saveas-name" class="text-input" name="saveas-name" length="100" maxlength="100"></label>',r="Save",i=function(e){var s,o,u,a,f,l=YSLOW.util.getCurrentTarget(e).ownerDocument;if(l.ysview.modaldlg){s=l.ysview.getElementByTagNameAndId(l.ysview.modaldlg,"input","saveas-name")}if(s){if(YSLOW.controller.checkRulesetName(s.value)===true){o=n+'<div class="error">'+s.value+" ruleset already exists.</div>";l.ysview.closeDialog(l);l.ysview.openDialog(l,389,150,o,"",r,i)}else{u=l.ysview.getButtonView("ysRuleEditButton");if(u){a=l.ysview.getElementByTagNameAndId(u,"form",t);f=l.createElement("input");f.type="hidden";f.name="saveas-name";f.value=s.value;a.appendChild(f);a.submit()}l.ysview.closeDialog(l)}}};this.openDialog(e,389,150,n,undefined,r,i)},openPrintableDialog:function(e){var t="Please run YSlow first before using Printable View.",n="Check which information you want to view or print<br>",r='<div id="printOptions"><label><input type="checkbox" name="print-type" value="grade" checked>Grade</label><label><input type="checkbox" name="print-type" value="components" checked>Components</label><label><input type="checkbox" name="print-type" value="stats" checked>Statistics</label></div>',i="Ok",s=function(e){var t,n=YSLOW.util.getCurrentTarget(e).ownerDocument,n=FBL.getContentView(n);aInputs=n.getElementsByName("print-type"),print_type={};for(t=0;t<aInputs.length;t+=1){if(aInputs[t].checked){print_type[aInputs[t].value]=1}}n.ysview.closeDialog(n);n.ysview.runTool("printableview",{options:print_type,yscontext:n.yslowContext})};if(e.yslowContext.component_set===null){this.openDialog(e,389,150,t,"","Ok");return}this.openDialog(e,389,150,n,r,i,s)},getElementByTagNameAndId:function(e,t,n){var r,i;if(e){i=e.getElementsByTagName(t);if(i.length>0){for(r=0;r<i.length;r+=1){if(i[r].id===n){return i[r]}}}}return null},openDialog:function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b=this.modaldlg,w=b.getElementsByTagName("div");for(u=0;u<w.length;u+=1){if(w[u].className&&w[u].className.length>0){if(w[u].className==="dialog-box"){f=w[u]}else{if(w[u].className==="dialog-text"){l=w[u]}else{if(w[u].className==="dialog-more-text"){c=w[u]}}}}}if(b&&f&&l&&c){l.innerHTML=r?r:"";c.innerHTML=i?i:"";p=b.getElementsByTagName("input");for(a=0;a<p.length;a+=1){if(p[a].className==="dialog-left-button"){h=p[a]}}if(h){h.value=s;h.onclick=o||function(t){e=FBL.getContentView(e);e.ysview.closeDialog(e)}}d=e.defaultView||e.parentWindow;v=d.innerWidth;m=d.innerHeight;g=Math.floor((v-t)/2);y=Math.floor((m-n)/2);f.style.left=(g&&g>0?g:225)+"px";f.style.top=(y&&y>0?y:80)+"px";b.style.left=this.panelNode.scrollLeft+"px";b.style.top=this.panelNode.scrollTop+"px";b.style.display="block";if(p.length>0){p[0].focus()}}},closeDialog:function(e){var t=this.modaldlg;t.style.display="none"},saveRuleset:function(e,t){var n,r=YSLOW.controller.getRenderer("html"),i=this.getButtonView("ysRuleEditButton");if(i){n=this.getElementByTagNameAndId(i,"form",t);r.saveRuleset(e,n)}},deleteRuleset:function(e,t){var n,r=YSLOW.controller.getRenderer("html"),i=this.getButtonView("ysRuleEditButton");if(i){n=this.getElementByTagNameAndId(i,"form",t);r.deleteRuleset(e,n)}},shareRuleset:function(e,t){var n,r,i,s,o,u=YSLOW.controller.getRenderer("html"),a=this.getButtonView("ysRuleEditButton");if(a){n=this.getElementByTagNameAndId(a,"form",t);r=u.getEditFormRulesetId(n);i=YSLOW.controller.getRuleset(r);if(i){s=YSLOW.Exporter.exportRuleset(i);if(s){o="<label>"+s.message+"</label>";this.openDialog(e,389,150,o,"","Ok")}}}},createRuleset:function(e,t){var n,r,i=e.parentNode,s=i.parentNode,o=s.firstChild;while(o){this.unselect(o);o=o.nextSibling}n=this.getButtonView("ysRuleEditButton");if(n){r=this.getElementByTagNameAndId(n,"form",t);YSLOW.renderer.initRulesetEditForm(this.panel_doc,r)}},showHideHelp:function(){var e,t=this.getElementByTagNameAndId(this.panelNode,"div","toolbarDiv");if(t){e=this.getElementByTagNameAndId(t,"div","helpDiv")}if(e){if(e.style.visibility==="visible"){e.style.visibility="hidden"}else{e.style.visibility="visible"}}},smushIt:function(e,t){YSLOW.util.smushIt(t,function(n){var r,i,s,o,u="";if(n.error){u+="<br><div>"+n.error+"</div>"}else{s=YSLOW.util.getSmushUrl();o=YSLOW.util.makeAbsoluteUrl(n.dest,s);u+="<div>Original size: "+n.src_size+" bytes</div><div>Result size: "+n.dest_size+" bytes</div><div>% Savings: "+n.percent+"%</div><div><a href=\"javascript:document.ysview.openLink('"+o+"')\">Click here to view or save the result image.</a></div>"}r='<div class="smushItResult"><div>Image: '+YSLOW.util.briefUrl(t,250)+"</div></div>";i=u;e.ysview.openDialog(e,389,150,r,i,"Ok")})},checkAllRules:function(e,t,n){var r,i,s,o;if(typeof n!=="boolean"){return}i=this.getButtonView("ysRuleEditButton");if(i){s=this.getElementByTagNameAndId(i,"form",t);o=s.elements;for(r=0;r<o.length;r+=1){if(o[r].type==="checkbox"){o[r].checked=n}}}},__exposedProps__:{openLink:"rw",showComponentHeaders:"rw",smushIt:"rw",saveRuleset:"rw",regenComponentsTable:"rw",expandCollapseComponentType:"rw",expandAll:"rw",updateFilterSelection:"rw",openPopup:"rw",runTool:"rw",onclickRuleset:"rw",createRuleset:"rw",addCDN:"rw",closeDialog:"rw",setAutorun:"rw",setAntiIframe:"rw",runTest:"rw",onChangeRuleset:"rw",showRuleSettings:"rw",openPrintableDialog:"rw",showHideHelp:"rw",setSplashView:"rw",onclickToolbarMenu:"rw",showPerformance:"rw",showComponents:"rw",showStats:"rw",showTools:"rw",onclickResult:"rw"}};YSLOW.view.Tooltip=function(e,t){this.tooltip=e.createElement("div");if(this.tooltip){this.tooltip.id="tooltipDiv";this.tooltip.innerHTML="";this.tooltip.style.display="none";if(t){t.appendChild(this.tooltip)}}this.timer=null};YSLOW.view.Tooltip.prototype={show:function(e,t){var n=this;this.text=e;this.target=t;this.tooltipData={text:e,target:t};this.timer=YSLOW.util.setTimer(function(){n.showX()},500)},showX:function(){if(this.tooltipData){this.showTooltip(this.tooltipData.text,this.tooltipData.target)}this.timer=null},showTooltip:function(e,t){var n,r,i,s,o,u,a,f=10,l=0,c=0,h=t.ownerDocument,p=h.defaultView||h.parentWindow,d=p.offsetWidth?p.offsetWidth:p.innerWidth,v=p.offsetHeight?p.offsetHeight:p.innerHeight;this.tooltip.innerHTML=e;this.tooltip.style.display="block";n=this.tooltip.offsetWidth;r=this.tooltip.offsetHeight;if(n>d||r>v){this.tooltip.style.display="none";return}i=t.offsetParent;while(i!==null){l+=i.offsetLeft;c+=i.offsetTop;i=i.offsetParent}l+=t.offsetLeft;c+=t.offsetTop;if(l<h.ysview.panelNode.scrollLeft||c<h.ysview.panelNode.scrollTop||c+t.offsetHeight>h.ysview.panelNode.scrollTop+v){this.tooltip.style.display="none";return}s=l+t.offsetWidth/2;o=c+t.offsetHeight/2;if(l+t.offsetWidth+f+n<d){l+=t.offsetWidth+f;if(c>=h.ysview.panelNode.scrollTop&&c-f+r+f<=h.ysview.panelNode.scrollTop+v){c=c-f;u="right top"}else{c+=t.offsetHeight-r;u="right bottom"}}else{if(c-r-f>=h.ysview.panelNode.scrollTop){c-=r+f;u="top"}else{c+=t.offsetHeight+f;u="bottom"}a=Math.floor(s-n/2);if(a>=h.ysview.panelNode.scrollLeft&&a+n<=h.ysview.panelNode.scrollLeft+d){l=a}else{if(a<h.ysview.panelNode.scrollLeft){l=h.ysview.panelNode.scrollLeft}else{l=h.ysview.panelNode.scrollLeft+d-f-n}}}if(u){this.tooltip.className=u}this.tooltip.style.left=l+"px";this.tooltip.style.top=c+"px"},hide:function(){if(this.timer){clearTimeout(this.timer)}this.tooltip.style.display="none"}};YSLOW.view.setStatusBar=function(e,t){var n=document.getElementById(t||"yslow_status_grade");if(n){n.value=e}};YSLOW.view.clearStatusBar=function(){this.setStatusBar("","yslow_status_time");this.setStatusBar("YSlow","yslow_status_grade");this.setStatusBar("","yslow_status_size")};YSLOW.view.restoreStatusBar=function(e){var t,n,r;if(e){if(e.PAGE.overallScore){t=YSLOW.util.prettyScore(e.PAGE.overallScore);this.setStatusBar(t,"yslow_status_grade")}if(e.PAGE.totalSize){n=YSLOW.util.kbSize(e.PAGE.totalSize);this.setStatusBar(n,"yslow_status_size")}if(e.PAGE.t_done){r=e.PAGE.t_done/1e3+"s";this.setStatusBar(r,"yslow_status_time")}}};YSLOW.view.toggleStatusBar=function(e){document.getElementById("yslow-status-bar").hidden=e};YSLOW.view.removeClassName=function(e,t){var n,r;if(e&&e.className&&e.className.length>0&&t&&t.length>0){r=e.className.split(" ");for(n=0;n<r.length;n+=1){if(r[n]===t){r.splice(n,1);e.className=r.join(" ");return true}}}return false};YSLOW.context=function(e){this.document=e;this.component_set=null;this.result_set=null;this.onloadTimestamp=null;if(YSLOW.renderer){YSLOW.renderer.reset()}this.PAGE={totalSize:0,totalRequests:0,totalObjCount:{},totalObjSize:{},totalSizePrimed:0,totalRequestsPrimed:0,totalObjCountPrimed:{},totalObjSizePrimed:{},canvas_data:{},statusbar:false,overallScore:0,t_done:undefined,loaded:false}};YSLOW.context.prototype={defaultview:"ysPerfButton",computeStats:function(e){var t,n,r,i,s,o,u,a,f,l,c={},h={},p=0;if(!this.component_set){return}t=this.component_set.components;if(!t){return}for(i=0,s=t.length;i<s;i+=1){n=t[i];if(!e||!n.hasFarFutureExpiresOrMaxAge()){p+=1;r=n.type;c[r]=typeof c[r]==="undefined"?1:c[r]+1;o=0;if(!e||!n.hasOldModifiedDate()){if(n.compressed==="gzip"||n.compressed==="deflate"){if(n.size_compressed){o=parseInt(n.size_compressed,10)}}else{o=n.size}}h[r]=typeof h[r]==="undefined"?o:h[r]+o}}u=0;a=YSLOW.peeler.types;f={};for(i=0;i<a.length;i+=1){l=a[i];if(typeof c[l]!=="undefined"){if(h[l]>0){f[l]=h[l]}u+=h[l]}}return{total_size:u,num_requests:p,count_obj:c,size_obj:h,canvas_data:f}},collectStats:function(){var e=this.computeStats();if(e!==undefined){this.PAGE.totalSize=e.total_size;this.PAGE.totalRequests=e.num_requests;this.PAGE.totalObjCount=e.count_obj;this.PAGE.totalObjSize=e.size_obj;this.PAGE.canvas_data.empty=e.canvas_data}e=this.computeStats(true);if(e){this.PAGE.totalSizePrimed=e.total_size;this.PAGE.totalRequestsPrimed=e.num_requests;this.PAGE.totalObjCountPrimed=e.count_obj;this.PAGE.totalObjSizePrimed=e.size_obj;this.PAGE.canvas_data.primed=e.canvas_data}},genPerformance:function(e,t){if(this.result_set===null){if(!t){t=this.document}YSLOW.controller.lint(t,this)}return YSLOW.controller.render(e,"reportcard",{result_set:this.result_set})},genStats:function(e){var t={};if(!this.PAGE.totalSize){this.collectStats()}t.PAGE=this.PAGE;return YSLOW.controller.render(e,"stats",{stats:t})},genComponents:function(e){if(!this.PAGE.totalSize){this.collectStats()}return YSLOW.controller.render(e,"components",{comps:this.component_set.components,total_size:this.PAGE.totalSize})},genToolsView:function(e){var t=YSLOW.Tools.getAllTools();return YSLOW.controller.render(e,"tools",{tools:t})},genRulesetEditView:function(e){return YSLOW.controller.render(e,"rulesetEdit",{rulesets:YSLOW.controller.getRegisteredRuleset()})}};YSLOW.renderer={sortBy:"type",sortDesc:false,bPrintable:false,colors:{doc:"#8963df",redirect:"#FC8C8C",iframe:"#FFDFDF",xhr:"#89631f",flash:"#8D4F5B",js:"#9fd0e8",css:"#aba5eb",cssimage:"#677ab8",image:"#d375cd",favicon:"#a26c00",unknown:"#888888"},reset:function(){this.sortBy="type";this.sortDesc=false},genStats:function(e,t){var n,r,i,s,o,u,a,f,l="",c=0;if(!e.PAGE){return""}if(t){n=e.PAGE.totalObjCountPrimed;r=e.PAGE.totalObjSizePrimed;i=e.PAGE.totalRequestsPrimed;c=e.PAGE.totalSizePrimed}else{n=e.PAGE.totalObjCount;r=e.PAGE.totalObjSize;i=e.PAGE.totalRequests;c=e.PAGE.totalSize}s=YSLOW.peeler.types;o=t?"primed":"empty";for(u=0;u<s.length;u+=1){a=s[u];if(typeof n[a]!=="undefined"){l+='<tr><td class="legend"><div class="stats-legend" style="background: '+this.colors[a]+'">&nbsp;</div></td><td class="count">'+n[a]+'</td><td class="type">'+YSLOW.util.prettyType(a)+'</td><td class="size">'+YSLOW.util.kbSize(r[a])+"</td></tr>"}}f='<div id="stats-detail"><div class="summary-row">HTTP Requests - '+i+'</div><div class="summary-row-2">Total Weight - '+YSLOW.util.kbSize(c)+'</div><table id="stats-table">'+l+"</table></div>";return f},plotComponents:function(e,t){if(typeof e!=="object"){return}this.plotOne(e,t.PAGE.canvas_data.empty,t.PAGE.totalSize,"comp-canvas-empty");this.plotOne(e,t.PAGE.canvas_data.primed,t.PAGE.totalSizePrimed,"comp-canvas-primed")},plotOne:function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p=e.getElementsByTagName("canvas");for(s=0;s<p.length;s+=1){if(p[s].id===r){i=p[s]}}if(!i){return}o=i.getContext("2d");u=[i.width,i.height];a=Math.min(u[0],u[1])/2;f=[u[0]/2,u[1]/2];l=0;for(c in t){if(t.hasOwnProperty(c)&&t[c]){h=t[c]/n;o.beginPath();o.moveTo(f[0],f[1]);o.arc(f[0],f[1],a,Math.PI*(-.5+2*l),Math.PI*(-.5+2*(l+h)),false);o.lineTo(f[0],f[1]);o.closePath();o.fillStyle=this.colors[c];o.fill();l+=h}}},getComponentHeadersTable:function(e){var t,n='<table><tr class="respHeaders"><td colspan=2>Response Headers</td></tr>';for(t in e.headers){if(e.headers.hasOwnProperty(t)&&e.headers[t]){n+='<tr><td class="param-name">'+YSLOW.util.escapeHtml(YSLOW.util.formatHeaderName(t))+'</td><td class="param-value">'+YSLOW.util.escapeHtml(e.headers[t])+"</td></tr>"}}if(e.req_headers){n+='<tr class="reqHeaders"><td colspan=2>Request Headers</td></tr>';for(t in e.req_headers){if(e.req_headers.hasOwnProperty(t)&&e.req_headers[t]){n+='<tr><td class="param-name">'+YSLOW.util.escapeHtml(YSLOW.util.formatHeaderName(t))+'</td><td class="param-value"><p>'+YSLOW.util.escapeHtml(e.req_headers[t])+"</p></td></tr>"}}}n+="</table>";return n},genComponentRow:function(e,t,n,r){var i,s,o,u,a,f,l;if(typeof n!=="string"){n=""}if(t.status>=400&&t.status<500){n+=" compError"}if(t.after_onload===true){n+=" afteronload"}i="compHeaders"+t.id;s='<tr class="'+n+" type-"+t.type+'"'+(r?' style="display:none"':"")+">";for(o in e){if(e.hasOwnProperty(o)){u=o;a="";if(o==="type"){a+=t[o];if(t.is_beacon){a+=" &#8224;"}if(t.after_onload){a+=" *"}}else{if(o==="size"){a+=YSLOW.util.kbSize(t.size)}else{if(o==="url"){if(t.status>=400&&t.status<500){s+='<td class="'+u+'">'+t[o]+" (status: "+t.status+")</td>";continue}else{a+=YSLOW.util.prettyAnchor(t[o],t[o],undefined,!YSLOW.renderer.bPrintable,100,1,t.type)}}else{if(o==="gzip"&&(t.compressed==="gzip"||t.compressed==="deflate")){a+=t.size_compressed!==undefined?YSLOW.util.kbSize(t.size_compressed):"uncertain"}else{if(o==="set-cookie"){f=t.getSetCookieSize();a+=f>0?f:""}else{if(o==="cookie"){l=t.getReceivedCookieSize();a+=l>0?l:""}else{if(o==="etag"){a+=t.getEtag()}else{if(o==="expires"){a+=YSLOW.util.prettyExpiresDate(t.expires)}else{if(o==="headers"){if(YSLOW.renderer.bPrintable){continue}if(t.raw_headers&&t.raw_headers.length>0){a+="<a href=\"javascript:document.ysview.showComponentHeaders('"+i+'\')"><b class="mag"></b></a>'}}else{if(o==="action"){if(YSLOW.renderer.bPrintable){continue}if(t.type==="cssimage"||t.type==="image"){if(t.response_type===undefined||t.response_type==="image"){a+="<a href=\"javascript:document.ysview.smushIt(document, '"+t.url+"')\">smush.it</a>"}}}else{if(t[o]!==undefined){a+=t[o]}}}}}}}}}}}s+='<td class="'+u+'">'+a+"</td>"}}s+="</tr>";if(t.raw_headers&&t.raw_headers.length>0){s+='<tr id="'+i+'" class="headers" style="display:none;"><td colspan="12">'+this.getComponentHeadersTable(t)+"</td></tr>"}return s},componentSortCallback:function(e,t){var n,r,i,s="",o="",u=YSLOW.renderer.sortBy,a=YSLOW.renderer.sortDesc;switch(u){case"type":s=e.type;o=t.type;break;case"size":s=e.size?Number(e.size):0;o=t.size?Number(t.size):0;break;case"gzip":s=e.size_compressed?Number(e.size_compressed):0;o=t.size_compressed?Number(t.size_compressed):0;break;case"set-cookie":s=e.getSetCookieSize();o=t.getSetCookieSize();break;case"cookie":s=e.getReceivedCookieSize();o=t.getReceivedCookieSize();break;case"headers":break;case"url":s=e.url;o=t.url;break;case"respTime":s=e.respTime?Number(e.respTime):0;o=t.respTime?Number(t.respTime):0;break;case"etag":s=e.getEtag();o=t.getEtag();break;case"action":if(e.type==="cssimage"||e.type==="image"){s="smush.it"}if(t.type==="cssimage"||t.type==="image"){o="smush.it"}break;case"expires":s=e.expires||0;o=t.expires||0;break}if(s===o){if(e.id>t.id){return a?-1:1}if(e.id<t.id){return a?1:-1}}if(u==="type"){r=YSLOW.peeler.types;for(n=0,i=r.length;n<i;n+=1){if(e.type===r[n]){return a?1:-1}if(t.type===r[n]){return a?-1:1}}}if(s>o){return a?-1:1}if(s<o){return a?1:-1}return 0},sortComponents:function(e,t,n){var r=e;this.sortBy=t;this.sortDesc=n;r.sort(this.componentSortCallback);return r},genRulesCheckbox:function(e){var t,n,r,i,s="",o=0,u=YSLOW.controller.getRegisteredRules(),a=0,f='<div class="column1">',l='<div class="column2">',c='<div class="column3">';for(n in u){if(u.hasOwnProperty(n)&&u[n]){r=u[n];t='<label class="rules"><input id="rulesetEditRule'+n+'" name="rules" value="'+n+'" type="checkbox"'+(e.rules[n]?" checked":"")+">"+r.name+"</label><br>";if(e.rules[n]!==undefined){o+=1}if(e.weights!==undefined&&e.weights[n]!==undefined){s+='<input type="hidden" name="weight-'+n+'" value="'+e.weights[r.id]+'">'}i=a%3;switch(i){case 0:f+=t;break;case 1:l+=t;break;case 2:c+=t;break}a+=1}}f+="</div>";l+="</div>";c+="</div>";return'<h4><span id="rulesetEditFormTitle">'+e.name+'</span> Ruleset <span id="rulesetEditFormNumRules" class="font10">(includes '+parseInt(o,10)+" of "+parseInt(a,10)+' rules)</span></h4><div class="rulesColumns"><table><tr><td>'+f+"</td><td>"+l+"</td><td>"+c+'</td></tr></table><div id="rulesetEditWeightsDiv" class="weightsDiv">'+s+"</div></div>"},genRulesetEditForm:function(e){var t="";t+='<div id="rulesetEditFormDiv"><form id="edit-form" action="javascript:document.ysview.saveRuleset(document, \'edit-form\')"><div class="floatRight"><a href="javascript:document.ysview.checkAllRules(document, \'edit-form\', true)">Check All</a>|<a href="javascript:document.ysview.checkAllRules(document, \'edit-form\', false)">Uncheck All</a></div>'+YSLOW.renderer.genRulesCheckbox(e)+'<div class="buttons"><input type="button" value="Save ruleset as ..." onclick="javascript:document.ysview.openSaveAsDialog(document, \'edit-form\')"><span id="rulesetEditCustomButtons" style="visibility: '+(e.custom===true?"visible":"hidden")+'"><input type="button" value="Save" onclick="this.form.submit()"><!--<input type="button" value="Share" onclick="javascript:document.ysview.shareRuleset(document, \'edit-form\')">--><input class="btn_delete" type="button" value="Delete" onclick="javascript:document.ysview.deleteRuleset(document, \'edit-form\')"></span></div><div id="rulesetEditRulesetId"><input type="hidden" name="ruleset-id" value="'+e.id+'"></div><div id="rulesetEditRulesetName"><input type="hidden" name="ruleset-name" value="'+e.name+'"></div></form></div>';return t},initRulesetEditForm:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m=t.elements,g="",y=[],b=0,w=0;for(i=0;i<m.length;i+=1){if(m[i].name==="rules"){m[i].checked=false;y[m[i].id]=m[i];w+=1}else{if(m[i].name==="saveas-name"){t.removeChild(m[i])}}}r=t.getElementsByTagName("div");for(i=0;i<r.length;i+=1){if(r[i].id==="rulesetEditWeightsDiv"){c=r[i]}else{if(r[i].id==="rulesetEditRulesetId"){a=r[i]}else{if(r[i].id==="rulesetEditRulesetName"){f=r[i]}}}}d=t.parentNode.getElementsByTagName("span");for(s=0;s<d.length;s+=1){if(d[s].id==="rulesetEditFormTitle"){l=d[s]}else{if(d[s].id==="rulesetEditCustomButtons"){u=d[s];if(n!==undefined&&n.custom===true){u.style.visibility="visible"}else{u.style.visibility="hidden"}}else{if(d[s].id==="rulesetEditFormNumRules"){p=d[s]}}}}if(n){h=n.rules;for(o in h){if(h.hasOwnProperty(o)&&h[o]){v=y["rulesetEditRule"+o];if(v){v.checked=true}if(n.weights!==undefined&&n.weights[o]!==undefined){g+='<input type="hidden" name="weight-'+o+'" value="'+n.weights[o]+'">'}b+=1}}p.innerHTML="(includes "+parseInt(b,10)+" of "+parseInt(w,10)+" rules)";a.innerHTML='<input type="hidden" name="ruleset-id" value="'+n.id+'">';f.innerHTML='<input type="hidden" name="ruleset-name" value="'+n.name+'">';l.innerHTML=n.name}else{a.innerHTML="";f.innerHTML="";l.innerHTML="New";p.innerHTML=""}c.innerHTML=g}};YSLOW.registerRenderer({id:"html",supports:{components:1,reportcard:1,stats:1,tools:1,rulesetEdit:1},genComponentsTable:function(e,t,n){var r,i,s,o,u={type:"TYPE",size:"SIZE<br> (KB)",gzip:"GZIP<br> (KB)","set-cookie":"COOKIE&nbsp;RECEIVED<br>(bytes)",cookie:"COOKIE&nbsp;SENT<br>(bytes)",headers:"HEADERS",url:"URL",expires:"EXPIRES<br>(Y/M/D)",respTime:"RESPONSE<br> TIME&nbsp;(ms)",etag:"ETAG",action:"ACTION"},a=false,f="",l="",c=0,h=0;if(t!==undefined&&u[t]===undefined){return""}if(YSLOW.renderer.bPrintable){t=YSLOW.renderer.sortBy;n=YSLOW.renderer.sortDesc}else{if(t===undefined||t==="type"){t="type";a=true}}e=YSLOW.renderer.sortComponents(e,t,n);f+='<table id="components-table"><tr>';for(r in u){if(u.hasOwnProperty(r)&&u[r]){if(YSLOW.renderer.bPrintable&&(r==="action"||r==="components"||r==="headers")){continue}f+="<th";if(t===r){f+=' class=" sortBy"'}f+=">";if(YSLOW.renderer.bPrintable){f+=u[r]}else{f+='<div class="';if(t===r){f+=n?" sortDesc":" sortAsc"}f+='"><a href="javascript:document.ysview.regenComponentsTable(document, \''+r+"'"+(t===r?n?", false":", true":"")+')">'+(t===r?n?"&darr;":"&uarr;":"")+" "+u[r]+"</a></div>"}}}f+="</tr>";for(i=0;i<e.length;i+=1){o=e[i];if((t===undefined||t==="type")&&!YSLOW.renderer.bPrintable){if(s===undefined){s=o.type}else{if(s!==o.type){f+='<tr class="type-summary '+(a?"expand":"collapse")+'"><td><a href="javascript:document.ysview.expandCollapseComponentType(document, \''+s+'\')"><b class="expcol"><b class="exp exph"></b><b class="exp expv"></b><b class="col"></b></b><span class="rowTitle type-'+s+'">'+s+"&nbsp;("+c+')</span></a></td><td class="size">'+YSLOW.util.kbSize(h)+"</td><td><!-- GZIP --></td><td></td><td></td><td><!-- HEADERS --></td><td><!-- URL --></td><td><!-- EXPIRES --></td><td><!-- RESPTIME --></td><td><!-- ETAG --></td><td><!-- ACTION--></td></tr>";f+=l;l="";c=0;h=0;s=o.type}}l+=YSLOW.renderer.genComponentRow(u,o,c%2===0?"even":"odd",a);c+=1;h+=o.size}else{f+=YSLOW.renderer.genComponentRow(u,o,i%2===0?"even":"odd",false)}}if(l.length>0){f+='<tr class="type-summary '+(a?"expand":"collapse")+'"><td><a href="javascript:document.ysview.expandCollapseComponentType(document, \''+s+'\')"><b class="expcol"><b class="exp exph"></b><b class="exp expv"></b><b class="col"></b></b><span class="rowTitle type-'+s+'">'+s+"&nbsp;("+c+')</span></a></td><td class="size">'+YSLOW.util.kbSize(h)+"</td><td><!-- GZIP --></td><td></td><td></td><td><!-- HEADERS --></td><td><!-- URL --></td><td><!-- EXPIRES --></td><td><!-- RESPTIME --></td><td><!-- ETAG --></td><td><!-- ACTION--></td></tr>";f+=l}f+="</table>";return f},componentsView:function(e,t){var n,r=this.genComponentsTable(e,YSLOW.renderer.sortBy,false),i="in type column indicates the component is loaded after window onload event.",s="denotes 1x1 pixels image that may be image beacon",o="Components";if(YSLOW.doc){if(YSLOW.doc.components_legend){if(YSLOW.doc.components_legend.beacon){i=YSLOW.doc.components_legend.beacon}if(YSLOW.doc.components_legend.after_onload){s=YSLOW.doc.components_legend.after_onload}}if(YSLOW.doc.view_names&&YSLOW.doc.view_names.components){o=YSLOW.doc.view_names.components}}n='<div id="componentsDiv"><div id="summary"><span class="view-title">'+o+'</span>The page has a total of <span class="number">'+e.length+'</span> components and a total weight of <span class="number">'+YSLOW.util.kbSize(t)+'</span> bytes</div><div id="expand-all"><a href="javascript:document.ysview.expandAll(document)"><b>&#187;</b><span id="expand-all-text">Expand All</span></a></div><div id="components">'+r+'</div><div class="legend">* '+i+"<br>&#8224; "+s+"</div></div>";return n},reportcardPrintableView:function(e,t,n){var r,i,s,o,u,a='<div id="reportDiv"><table><tr class="header"><td colspan="2">Overall Grade: '+t+"  (Ruleset applied: "+n.name+")</td></tr>";for(r=0;r<e.length;r+=1){s=e[r];if(typeof s==="object"){o=YSLOW.util.prettyScore(s.score);u="grade-"+(o==="N/A"?"NA":o);a+='<tr><td class="grade '+u+'"><b>'+o+'</b></td><td class="desc"><p>'+s.name+'<br><div class="message">'+s.message+"</div>";if(s.components&&s.components.length>0){a+='<ul class="comps-list">';for(i=0;i<s.components.length;i+=1){if(typeof s.components[i]==="string"){a+="<li>"+s.components[i]+"</li>"}else{if(s.components[i].url!==undefined){a+="<li>"+YSLOW.util.briefUrl(s.components[i].url,60)+"</li>"}}}a+="</ul><br>"}a+="</p></td></tr>"}}a+="</table></div>";return a},getFilterCode:function(e,t,n,r){var i,s,o,u,a,f,l,c=t.length,h=[];for(s in e){if(e.hasOwnProperty(s)&&e[s]){h.push(s)}}h.sort();i='<div id="filter"><ul><li class="first selected" id="all" onclick="javascript:document.ysview.updateFilterSelection(event)"><a href="#">ALL ('+c+')</a></li><li class="first">FILTER BY: </li>';for(o=0,u=h.length;o<u;o+=1){i+="<li";if(o===0){i+=' class="first"'}i+=' id="'+h[o]+'" onclick="javascript:document.ysview.updateFilterSelection(event)"><a href="#">'+h[o].toUpperCase()+" ("+e[h[o]]+")</a></li>"}a="http://yslow.org/scoremeter/?url="+encodeURIComponent(r)+"&grade="+n;for(o=0;o<c;o+=1){f=t[o];l=parseInt(f.score,10);if(l>=0&&l<100){a+="&"+f.rule_id.toLowerCase()+"="+l}}a=encodeURIComponent(encodeURIComponent(a));r=encodeURIComponent(encodeURIComponent(r.slice(0,60)+(r.length>60?"...":"")));i+='<li class="social"><a class="facebook" href="javascript:document.ysview.openPopup(\'http://www.facebook.com/sharer.php?t=YSlow%20Scoremeter&u='+a+"', 'facebook')\" title=\"Share these results\"><span>Share</span></a></li>";i+='<li class="social"><a class="twitter" href="javascript:document.ysview.openPopup(\'http://twitter.com/share?original_referer=&source=tweetbutton&text=YSlow%20grade%20'+n+"%20for%20"+r+"&url="+a+"&via=yslow', 'twitter')\" title=\"Tweet these results\"><span>Tweet</spam></a></li>";i+="</ul></div>";return i},reportcardView:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v='<div id="reportDiv">',m=e.getRulesetApplied(),g=e.getResults(),y=e.url,b="Grade",w="",E="",S={};if(YSLOW.doc){if(YSLOW.doc.view_names&&YSLOW.doc.view_names.grade){b=YSLOW.doc.view_names.grade}}t=YSLOW.util.prettyScore(e.getOverallScore());if(YSLOW.renderer.bPrintable){return this.reportcardPrintableView(g,t,m)}v+='<div id="summary"><table><tr><td><div class="bigFont">'+b+'</div></td><td class="padding5"><div id="overall-grade" class="grade-'+t+'">'+t+'</div></td><td class="padding15">Overall performance score '+Math.round(e.getOverallScore())+'</td><td class="padding15">Ruleset applied: '+m.name+'</td><td class="padding15">URL: '+YSLOW.util.briefUrl(y,100)+"</td></tr></table></div>";for(n=0;n<g.length;n+=1){s=g[n];if(typeof s==="object"){o=YSLOW.util.prettyScore(s.score);u=n+1;a="";f="grade-"+(o==="N/A"?"NA":o);l=parseInt(s.score,10);if(isNaN(l)||s.score===-1){l="n/a"}else{l+="%"}w+='<li id="label'+u+'"';if(n===0){a+="first selected"}if(s.category){for(i=0;i<s.category.length;i+=1){if(a.length>0){a+=" "}a+=s.category[i];if(S[s.category[i]]===undefined){S[s.category[i]]=0}S[s.category[i]]+=1}}if(a.length>0){w+=' class="'+a+'"'}w+=' onclick="javascript:document.ysview.onclickResult(event)"><a href="#" class="'+f+'"><div class="tab-label"><span class="grade" title="'+l+'">'+o+'</span><span class="desc">'+s.name+"</span></div></a></li>";E+='<div id="tab'+u+'" class="result-tab';if(n!==0){E+=" yui-hidden"}c=s.message.split("\n");if(c){s.message=c.join("<br>")}E+='"><h4>Grade '+o+" on "+s.name+"</h4><p>"+s.message+"<br>";if(s.components&&s.components.length>0){E+='<ul class="comps-list">';for(r=0;r<s.components.length;r+=1){h=s.components[r];if(typeof h==="string"){E+="<li>"+h+"</li>"}else{if(h.url!==undefined){E+="<li>";p=s.rule_id.toLowerCase();if(s.rule_id.match("expires")){E+="("+YSLOW.util.prettyExpiresDate(h.expires)+") "}E+=YSLOW.util.prettyAnchor(h.url,h.url,undefined,true,120,undefined,h.type)+"</li>"}}}E+="</ul><br>"}E+="</p>";d=YSLOW.controller.getRule(s.rule_id);if(d){E+='<hr><p class="rule-info">'+(d.info||"** To be added **")+"</p>";if(d.url!==undefined){E+='<p class="more-info"><a href="javascript:document.ysview.openLink(\''+d.url+"')\"><b>&#187;</b>Read More</a></p>"}}E+="</div>"}}v+='<div id="reportInnerDiv">'+this.getFilterCode(S,g,t,y)+'<div id="result" class="yui-navset yui-navset-left"><ul class="yui-nav" id="tab-label-list">'+w+'</ul><div class="yui-content">'+E+'</div><div id="copyright2">'+YSLOW.doc.copyright+"</div></div></div></div>";return v},statsView:function(e){var t="",n="Stats";if(YSLOW.doc){if(YSLOW.doc.view_names&&YSLOW.doc.view_names.stats){n=YSLOW.doc.view_names.stats}}t+='<div id="statsDiv"><div id="summary"><span class="view-title">'+n+'</span>The page has a total of <span class="number">'+e.PAGE.totalRequests+'</span> HTTP requests and a total weight of <span class="number">'+YSLOW.util.kbSize(e.PAGE.totalSize)+"</span> bytes with empty cache</div>";t+='<div class="section-header">WEIGHT GRAPHS</div>';t+='<div id="empty-cache"><div class="stats-graph floatLeft"><div class="canvas-title">Empty Cache</div><canvas id="comp-canvas-empty" width="150" height="150"></canvas></div><div class="yslow-stats-empty">'+YSLOW.renderer.genStats(e,false)+"</div></div>";t+='<div id="primed-cache"><div class="stats-graph floatLeft"><div class="canvas-title">Primed Cache</div><canvas id="comp-canvas-primed" width="150" height="150"></canvas></div><div class="yslow-stats-primed">'+YSLOW.renderer.genStats(e,true)+"</div></div>";t+="</div>";return t},toolsView:function(e){var t,n,r,i="<table>",s="Tools",o="Click the Launch Tool link next to the tool you want to run to start the tool.";if(YSLOW.doc){if(YSLOW.doc.tools_desc){o=YSLOW.doc.tools_desc}if(YSLOW.doc.view_names&&YSLOW.doc.view_names.tools){s=YSLOW.doc.view_names.tools}}for(t=0;t<e.length;t+=1){r=e[t];i+='<tr><td class="name"><b><a href="#" onclick="javascript:document.ysview.runTool(\''+r.id+"', {'yscontext': document.yslowContext })\">"+r.name+"</a></b></td><td>-</td><td>"+(r.short_desc||"Short text here explaining what are the main benefits of running this App")+"</td></tr>"}i+="</table>";n='<div id="toolsDiv"><div id="summary"><span class="view-title">'+s+"</span>"+o+'</div><div id="tools">'+i+"</div></div>";return n},rulesetEditView:function(e){var t,n,r,i,s='<div id="settingsDiv" class="yui-navset yui-navset-left">',o,u,a=0,f=false,l,c,h="Rule Settings",p="Choose which ruleset better fit your specific needs. You can Save As an existing rule, based on an existing ruleset.";if(YSLOW.doc){if(YSLOW.doc.rulesettings_desc){p=YSLOW.doc.rulesettings_desc}if(YSLOW.doc.view_names&&YSLOW.doc.view_names.rulesetedit){h=YSLOW.doc.view_names.rulesetedit}}c=YSLOW.controller.getDefaultRulesetId();o='<ul class="yui-nav"><li class="header">STANDARD SETS</li>';for(t in e){if(e.hasOwnProperty(t)&&e[t]){n=e[t];r="tab"+a;if(!f&&n.custom===true){o+='<li class="new-section header" id="custom-set-title">CUSTOM SETS</li>';f=true}o+='<li id="label'+a+'" class="ruleset-'+n.id;if(t===c){l=e[t];o+=' selected"'}o+='" onclick="javascript:document.ysview.onclickRuleset(event)"><a href="#'+r+'">'+n.name+"</a></li>";a+=1}}o+='<li class="new-section create-ruleset" id="create-ruleset"><input type="button" value="New Set" onclick="javascript:document.ysview.createRuleset(this, \'edit-form\')"></li></ul>';u='<div class="yui-content">'+YSLOW.renderer.genRulesetEditForm(l)+"</div>";s+=o+u;i='<div id="rulesetEditDiv"><div id="summary"><span class="view-title">'+h+"</span>"+p+"</div>"+s+"</div>";return i},rulesetEditUpdateTab:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y=t.parentNode.parentNode.parentNode;if(y&&y.id==="settingsDiv"&&n.custom===true){s=y.firstChild;o=s.nextSibling;if(r<1){u=s.firstChild;while(u){a=u.className.indexOf("ruleset-");if(a!==-1){f=u.className.substring(a+8);a=f.indexOf(" ");if(a!==-1){f=f.substring(0,a)}if(n.id===f){a=u.id.indexOf("label");if(a!==-1){l=u.id.substring(a+5);if(u.className.indexOf("selected")!==-1){c={};c.currentTarget=v;e.ysview.onclickRuleset(c)}if(u.previousSibling&&u.previousSibling.id==="custom-set-title"&&u.nextSibling&&u.nextSibling.id==="create-ruleset"){h=u.previousSibling}s.removeChild(u);if(h){s.removeChild(h)}}break}else{v=u}}u=u.nextSibling}}else{u=s.lastChild;while(u){d=u.id.indexOf("label");if(d!==-1){p=u.id.substring(d+5);break}u=u.previousSibling}p=Number(p)+1;u=e.createElement("li");u.className="ruleset-"+n.id;u.id="label"+p;u.onclick=function(t){e.ysview.onclickRuleset(t)};u.innerHTML='<a href="#tab'+p+'">'+n.name+"</a>";s.insertBefore(u,s.lastChild);m=s.firstChild;while(m){if(m.id&&m.id==="custom-set-title"){h=m;break}m=m.nextSibling}if(!h){h=e.createElement("li");h.className="new-section header";h.id="custom-set-title";h.innerHTML="CUSTOM SETS";s.insertBefore(h,u)}if(i){g={};g.currentTarget=u;e.ysview.onclickRuleset(g)}}}},hasClassName:function(e,t){var n,r=e.split(" ");if(r){for(n=0;n<r.length;n+=1){if(r[n]===t){return true}}}return false},expandCollapseComponentType:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=this.hasClassName,w={expand:0,collapse:0};if(typeof i==="boolean"&&i===true){a=true}if(t){for(o=0,d=t.rows.length;o<d;o+=1){f=t.rows[o];p=f.className;if(b(p,"type-summary")){if(b(p,"expand")){w.expand+=1;s=false}else{if(b(p,"collapse")){w.collapse+=1;s=true}}l=f.getElementsByTagName("span")[0];if(a||b(l.className,"type-"+n)){if(a){c=l.className.split(" ");for(u=0;u<c.length;u+=1){if(c[u].substring(0,5)==="type-"){n=c[u].substring(5)}}}if(typeof s!=="boolean"||typeof r==="boolean"&&r===s){if(a){s=!r;continue}else{return}}YSLOW.view.removeClassName(f,s?"collapse":"expand");f.className+=s?" expand":" collapse";if(s){w.collapse-=1;w.expand+=1}else{w.collapse+=1;w.expand-=1}}}else{if(b(p,"type-"+n)){if(s){f.style.display="none";h=f.nextSibling;if(h.id.indexOf("compHeaders")!==-1){h.style.display="none"}}else{f.style.display="table-row"}}}}}if(w.expand===0||w.collapse===0){v=t.parentNode.previousSibling;if(v){m=v.getElementsByTagName("span");for(o=0;o<m.length;o+=1){if(m[o].id==="expand-all-text"){g=m[o]}}y=false;if(g.innerHTML.indexOf("Expand")!==-1){y=true}if(y){if(w.expand===0){g.innerHTML="Collapse All"}}else{if(w.collapse===0){g.innerHTML="Expand All"}}}}},expandAllComponentType:function(e,t){var n,r,i=false,s=t.parentNode.previousSibling,o=s.getElementsByTagName("span");for(r=0;r<o.length;r+=1){if(o[r].id==="expand-all-text"){n=o[r]}}if(n){if(n.innerHTML.indexOf("Expand")!==-1){i=true}}this.expandCollapseComponentType(e,t,undefined,i,true);if(n){n.innerHTML=i?"Collapse All":"Expand All"}},regenComponentsTable:function(e,t,n,r,i){var s,o,u;if(t){if(r===undefined){r=false}if(n==="type"){s=true}o=t.parentNode.previousSibling;if(o.id==="expand-all"){o.style.visibility=s?"visible":"hidden"}u=this.genComponentsTable(i.components,n,r);t.parentNode.innerHTML=u}},saveRuleset:function(e,t){var n,r,i,s,o,u,a,f,l={},c={};if(t){l.custom=true;l.rules={};l.weights={};for(n=0;n<t.elements.length;n+=1){r=t.elements[n];if(r.name==="rules"&&r.type==="checkbox"){if(r.checked){l.rules[r.value]={}}}else{if(r.name==="saveas-name"){o=r.value}else{if(r.name==="ruleset-name"){u=r.value}else{if(r.name==="ruleset-id"){a=r.value}else{if((i=r.name.indexOf("weight-"))!==-1){c[r.name.substring(i)]=r.value}}}}}}f=l.rules;for(s in f){if(f.hasOwnProperty(s)&&c["weight-"+s]){l.weights[s]=parseInt(c["weight-"+s],10)}}if(o){l.id=o.replace(/\s/g,"-");l.name=o}else{l.id=a;l.name=u}if(l.id&&l.name){YSLOW.controller.addRuleset(l,true);YSLOW.controller.saveRulesetToPref(l);if(o!==undefined){this.updateRulesetUI(e,t,l,1)}}}},updateRulesetUI:function(e,t,n,r){var i,s=e.getElementsByTagName("form");for(i=0;i<s.length;i+=1){if(s[i].id===t.id){this.rulesetEditUpdateTab(e,s[i],n,r,s[i]===t)}}e.ysview.updateRulesetList()},deleteRuleset:function(e,t){var n=this.getEditFormRulesetId(t),r=YSLOW.controller.removeRuleset(n);if(r&&r.custom){YSLOW.controller.deleteRulesetFromPref(r);this.updateRulesetUI(e,t,r,-1)}},getEditFormRulesetId:function(e){var t,n=e.getElementsByTagName("input");for(t=0;t<n.length;t+=1){if(n[t].name==="ruleset-id"){return n[t].value}}return undefined}});YSLOW.registerRenderer({id:"xml",supports:{components:1,reportcard:1,stats:1},componentsView:function(e,t){var n,r,i="<components>";for(n=0;n<e.length;n+=1){i+="<component>";i+="<type>"+e[n].type+"</type>";i+="<size>"+e[n].size+"</size>";if(e[n].compressed===false){i+="<gzip/>"}else{i+="<gzip>"+(e[n].size_compressed!==undefined?parseInt(e[n].size_compressed,10):"uncertain")+"</gzip>"}r=e[n].getSetCookieSize();if(r>0){i+="<set-cookie>"+parseInt(r,10)+"</set-cookie>"}r=e[n].getReceivedCookieSize();if(r>0){i+="<cookie>"+parseInt(r,10)+"</cookie>"}i+="<url>"+encodeURI(e[n].url)+"</url>";i+="<expires>"+e[n].expires+"</expires>";i+="<resptime>"+e[n].respTime+"</resptime>";i+="<etag>"+e[n].getEtag()+"</etag>";i+="</component>"}i+="</components>";return i},reportcardView:function(e){var t,n,r,i=e.getOverallScore(),s=YSLOW.util.prettyScore(i),o=e.getRulesetApplied(),u=e.getResults(),a='<performance ruleset="'+o.name+'" url="'+e.url+'">';a+='<overall grade="'+s+'" score="'+i+'" />';for(t=0;t<u.length;t+=1){r=u[t];a+='<lints id="'+r.rule_id+'" ruletext="'+r.name+'" hreftext="'+YSLOW.controller.getRule(r.rule_id).url+'" grade="'+YSLOW.util.prettyScore(r.score)+'" score="'+r.score+'" category="'+r.category.join(",")+'">';a+="<message>"+r.message+"</message>";if(u.components&&u.components.length>0){a+="<offenders>";for(n=0;n<r.components.length;n+=1){if(typeof r.components[n]==="string"){a+="<offender>"+r.components[n]+"</offender>"}else{if(r.components[n].url!==undefined){a+="<offender>"+r.components[n].url+"</offender>"}}}a+="</offenders>"}a+="</lints>"}a+="</performance>";return a},statsView:function(e){var t,n,r,i='<items type="primedCache">',s='<items type="emptyCache">',o=YSLOW.peeler.types;for(t=0;t<o.length;t+=1){n=o[t];if(e.PAGE.totalObjCountPrimed[n]!==undefined){i+='<item type="'+n+'" count="'+e.PAGE.totalObjCountPrimed[n]+'" size="'+e.PAGE.totalObjSizePrimed[n]+'" />'}if(e.PAGE.totalObjCount[n]!==undefined){s+='<item type="'+n+'" count="'+e.PAGE.totalObjCount[n]+'" size="'+e.PAGE.totalObjSize[n]+'" />'}}i+="</items>";s+="</items>";r='<stats numRequests="'+e.PAGE.totalRequests+'" totalSize="'+e.PAGE.totalSize+'" numRequests_p="'+e.PAGE.totalRequestsPrimed+'" totalSize_p="'+e.PAGE.totalSizePrimed+'">'+i+s+"</stats>";return r}});YSLOW.peeler={types:["doc","js","css","iframe","flash","cssimage","image","favicon","xhr","redirect","font"],NODETYPE:{ELEMENT:1,DOCUMENT:9},CSSRULE:{IMPORT_RULE:3,FONT_FACE_RULE:5},peel:function(e,t){},findDocuments:function(e){var t,n,r,i,s,o,u,a,f,l={};YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:1,message:"Finding documents"});if(!e){return}if(!YSLOW.util.Preference.getPref("extensions.yslow.getFramesComponents",true)){l[e.URL]={document:e,type:"doc"};return l}i="doc";if(e.nodeType===this.NODETYPE.DOCUMENT){n=e;r=e.URL}else{if(e.nodeType===this.NODETYPE.ELEMENT&&e.nodeName.toLowerCase()==="frame"){n=e.contentDocument;r=e.src}else{if(e.nodeType===this.NODETYPE.ELEMENT&&e.nodeName.toLowerCase()==="iframe"){n=e.contentDocument;r=e.src;i="iframe";try{f=e.contentWindow;f=f&&f.parent;f=f&&f.document;f=f||e.ownerDocument;if(f&&f.URL===r){r=!e.getAttribute("src")?"":"about:blank"}}catch(c){YSLOW.util.dump(c)}}else{return l}}}l[r]={document:n,type:i};try{t=n.getElementsByTagName("iframe");for(s=0,o=t.length;s<o;s+=1){u=t[s];if(u.src){a=this.findDocuments(u);if(a){l=YSLOW.util.merge(l,a)}}}t=n.getElementsByTagName("frame");for(s=0,o=t.length;s<o;s+=1){u=t[s];a=this.findDocuments(u);if(a){l=YSLOW.util.merge(l,a)}}}catch(h){YSLOW.util.dump(h)}return l},findComponentsInNode:function(e,t,n){var r=[];try{r=this.findStyleSheets(e,t)}catch(i){YSLOW.util.dump(i)}try{r=r.concat(this.findScripts(e))}catch(s){YSLOW.util.dump(s)}try{r=r.concat(this.findFlash(e))}catch(o){YSLOW.util.dump(o)}try{r=r.concat(this.findCssImages(e))}catch(u){YSLOW.util.dump(u)}try{r=r.concat(this.findImages(e))}catch(a){YSLOW.util.dump(a)}try{if(n==="doc"){r=r.concat(this.findFavicon(e,t))}}catch(f){YSLOW.util.dump(f)}return r},addComponentsNotInNode:function(e,t){var n,r,i,s,o,u=["flash","js","css","doc","redirect"],a=YSLOW.net.getResponseURLsByType("xhr");if(a.length>0){for(r=0;r<a.length;r+=1){e.addComponent(a[r],"xhr",t)}}i=YSLOW.net.getResponseURLsByType("image");if(i.length>0){for(r=0;r<i.length;r+=1){s="image";if(i[r].indexOf("favicon.ico")!==-1){s="favicon"}e.addComponentNoDuplicate(i[r],s,t)}}for(n=0;n<u.length;n+=1){o=YSLOW.net.getResponseURLsByType(u[n]);for(r=0;r<o.length;r+=1){e.addComponentNoDuplicate(o[r],u[n],t)}}},findStyleSheets:function(e,t){var n,r,i,s,o=e.getElementsByTagName("head")[0],u=e.getElementsByTagName("body")[0],a=[],f=this,l=function(n,r){var i,s,o,u,l;for(i=0,s=n.length;i<s;i+=1){o=n[i];u=o.href||o.getAttribute("href");if(u&&(o.rel==="stylesheet"||o.type==="text/css")){a.push({type:"css",href:u===e.URL?"":u,containerNode:r});l=YSLOW.util.makeAbsoluteUrl(u,t);a=a.concat(f.findImportedStyleSheets(o.sheet,l))}}};YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:2,message:"Finding StyleSheets"});if(o||u){if(o){l(o.getElementsByTagName("link"),"head")}if(u){l(u.getElementsByTagName("link"),"body")}}else{l(e.getElementsByTagName("link"))}n=e.getElementsByTagName("style");for(i=0,s=n.length;i<s;i+=1){r=n[i];a=a.concat(f.findImportedStyleSheets(r.sheet,t))}return a},findImportedStyleSheets:function(e,t){var n,r,i,s,o,u,a=/url\s*\(["']*([^"'\)]+)["']*\)/i,f=[];try{if(!(r=e.cssRules)){return f}for(n=0,u=r.length;n<u;n+=1){i=r[n];if(i.type===YSLOW.peeler.CSSRULE.IMPORT_RULE&&i.styleSheet&&i.href){f.push({type:"css",href:i.href,base:t});s=YSLOW.util.makeAbsoluteUrl(i.href,t);f=f.concat(this.findImportedStyleSheets(i.styleSheet,s))}else{if(i.type===YSLOW.peeler.CSSRULE.FONT_FACE_RULE){if(i.style&&typeof i.style.getPropertyValue==="function"){o=i.style.getPropertyValue("src");o=a.exec(o);if(o){o=o[1];f.push({type:"font",href:o,base:t})}}}else{break}}}}catch(l){YSLOW.util.dump(l)}return f},findScripts:function(e){var t=[],n=e.getElementsByTagName("head")[0],r=e.getElementsByTagName("body")[0],i=function(n,r){var i,s,o,u,a;for(i=0,s=n.length;i<s;i+=1){o=n[i];u=o.type;if(u&&u.toLowerCase().indexOf("javascript")<0){continue}a=o.src||o.getAttribute("src");if(a){t.push({type:"js",href:a===e.URL?"":a,containerNode:r})}}};YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:3,message:"Finding JavaScripts"});if(n||r){if(n){i(n.getElementsByTagName("script"),"head")}if(r){i(r.getElementsByTagName("script"),"body")}}else{i(e.getElementsByTagName("script"))}return t},findFlash:function(e){var t,n,r,i,s=[];YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:4,message:"Finding Flash"});r=e.getElementsByTagName("embed");for(t=0,i=r.length;t<i;t+=1){n=r[t];if(n.src){s.push({type:"flash",href:n.src})}}r=e.getElementsByTagName("object");for(t=0,i=r.length;t<i;t+=1){n=r[t];if(n.data&&n.type==="application/x-shockwave-flash"){s.push({type:"flash",href:n.data})}}return s},findCssImages:function(e){var t,n,r,i,s,o,u,a=[],f={},l=["backgroundImage","listStyleImage","content","cursor"],c=l.length;YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:5,message:"Finding CSS Images"});i=e.getElementsByTagName("*");for(t=0,u=i.length;t<u;t+=1){r=i[t];for(n=0;n<c;n+=1){s=l[n];o=YSLOW.util.getComputedStyle(r,s,true);if(o&&!f[o]){a.push({type:"cssimage",href:o});f[o]=1}}}return a},findImages:function(e){var t,n,r,i,s,o=[],u={};YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:6,message:"Finding Images"});r=e.getElementsByTagName("img");for(t=0,s=r.length;t<s;t+=1){n=r[t];i=n.src;if(i&&!u[i]){o.push({type:"image",href:i,obj:{width:n.width,height:n.height}});u[i]=1}}return o},findFavicon:function(e,t){var n,r,i,s,o,u=[];YSLOW.util.event.fire("peelProgress",{total_step:7,current_step:7,message:"Finding favicon"});s=e.getElementsByTagName("link");for(n=0,r=s.length;n<r;n+=1){i=s[n];o=(i.rel||"").toLowerCase();if(i.href&&(o==="icon"||o==="shortcut icon")){u.push({type:"favicon",href:i.href})}}if(!u.length){u.push({type:"favicon",href:YSLOW.util.makeAbsoluteUrl("/favicon.ico",t)})}return u},getBaseHref:function(e){var t;try{t=e.getElementsByTagName("base")[0];t=t&&t.href||e.URL}catch(n){YSLOW.util.dump(n)}return t}};YSLOW.peeler.peel=function(e){var t,n,r,i,s,o=[];try{n=this.findDocuments(e);for(t in n){if(n.hasOwnProperty(t)){r=n[t];if(r){o.push({type:r.type,href:t});i=r.document;if(i&&t){s=this.getBaseHref(i);o=o.concat(this.findComponentsInNode(i,s,r.type))}}}}}catch(u){YSLOW.util.dump(u);YSLOW.util.event.fire("peelError",{message:u})}return o}};n="YSLOW.phantomjs = {resources: "+JSON.stringify(l)+",args: "+JSON.stringify(yslowArgs)+",loadTime: "+JSON.stringify(o)+",redirects: "+JSON.stringify(t.redirects)+"};";r=function(){YSLOW.phantomjs.run=function(){try{var e,t,n,r,i=document,s=YSLOW,o=new s.context(i),u=s.peeler,a=u.peel(i),f=u.getBaseHref(i),l=new s.ComponentSet(i),c=s.phantomjs,h=c.resources,p=c.args,d=s.util,v=function(e){var t=(p.format||"").toLowerCase(),n={tap:{func:d.formatAsTAP,contentType:"text/plain"},junit:{func:d.formatAsJUnit,contentType:"text/xml"}};switch(t){case"xml":return{content:d.objToXML(e),contentType:"text/xml"};case"plain":return{content:d.prettyPrintResults(e),contentType:"text/plain"};case"tap":case"junit":try{r=JSON.parse(p.threshold)}catch(i){r=p.threshold}return{content:n[t].func(d.testResults(e,r)),contentType:n[t].contentType};default:return{content:JSON.stringify(e),contentType:"application/json"}}},m=function(e){var t=/^([^:]+):\s*([\s\S]+)$/,n=/[\n\r]/g,r={};e.split("\n").forEach(function(e){var i=t.exec(e.replace(n,""));if(i){r[i[1]]=i[2]}});return r};a.forEach(function(e){var n=h[s.util.makeAbsoluteUrl(e.href,e.base)]||{};if(n.response===undefined){try{var r,i,o,u,a,c,p,d=/^([^:]+):\s*([\s\S]+)$/,v,m=new Object,g=new Object;t=new XMLHttpRequest;c=(new Date).getTime();t.open("GET",s.util.makeAbsoluteUrl(e.href,e.base),false);t.send();p=(new Date).getTime();v=t.getAllResponseHeaders();i=v.split("\n");g.headers=[];g.url=s.util.makeAbsoluteUrl(e.href,e.base);g.method="GET";g.time="2013-05-22T20:40:33.381Z";m.bodySize="-1";m.contentType="";m.headers=[];m.id="-1";m.redirectURL=null;m.stage="end";m.status=t.status;m.time=p-c;m.url=s.util.makeAbsoluteUrl(e.href,e.base);i=v.split("\n");for(o=0,u=i.length;o<u;o+=1){a=d.exec(i[o]);if(a){m.headers.push({name:a[1],value:a[2]})}}n.response=m;n.request=g}catch(y){console.log(y)}}l.addComponent(e.href,e.type,e.base||f,{obj:e.obj,request:n.request,response:n.response})});l.inline=d.getInlineTags(i);l.domElementsCount=d.countDOMElements(i);l.cookies=l.doc_comp.cookie;l.components=d.setInjected(i,l.components,l.doc_comp.body);l.redirects=c.redirects;o.component_set=l;s.controller.lint(i,o,p.ruleset);o.result_set.url=f;o.PAGE.t_done=c.loadTime;o.collectStats();e=d.getResults(o,p.info);if(p.dict&&p.format!=="plain"){e.dictionary=d.getDict(p.info,p.ruleset)}n=v(e);if(p.beacon){try{t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState===4&&p.verbose){e.beacon={status:t.status,headers:m(t.getAllResponseHeaders()),body:t.responseText};n=v(e)}};t.open("POST",p.beacon,false);t.setRequestHeader("Content-Type",n.contentType);t.send(n.content)}catch(g){if(p.verbose){e.beacon={error:g};n=v(e)}}}return n.content}catch(y){return y}};return YSLOW.phantomjs.run()};e=e.toString();e=e.slice(13,e.length-1);if(e.slice(e.length-1)!==";"){e+=";"}r=r.toString();r=r.slice(13,r.length-1);s=new Function(e+n+r);console.log(t.evaluate(s));urlCount-=1;if(urlCount===0){phantom.exit()}}console.log("url test :"+e);var t=webpage.create();t.resources={};t.harresources=[];t.address=e;t.redirects=[];t.settings.webSecurityEnabled=false;t.onLoadStarted=function(){t.startTime=new Date};t.onResourceRequested=function(e){t.resources[e.url]={request:e};e.starttime=e.time.getTime();t.harresources[e.id]={request:e,startReply:null,endReply:null};count+=1;clearTimeout(renderTimeout)};t.onResourceReceived=function(e){if(e.stage==="start"){t.harresources[e.id].startReply=e}if(e.stage==="end"){t.harresources[e.id].endReply=e;if(e.status===301||e.status===302){var r;for(var i=0;i<e.headers.length;i++){if(e.headers[i].name==="Location"){r=e.headers[i].value}}t.redirects.push("From "+e.url+" to "+r+".")}count-=1;if(count===0){renderTimeout=setTimeout(n,resourceWait)}}var s,o=t.resources[e.url].response;if(!o){t.resources[e.url].response=e;if(e.stage==="start"){t.resources[e.url].response.starttime=e.time.getTime()}}else{for(s in e){if(e.hasOwnProperty(s)){o[s]=e[s]}}}};yslowArgs.console=parseInt(yslowArgs.console,10)||0;if(yslowArgs.console){if(yslowArgs.console===1){t.onConsoleMessage=function(e){console.log(e)};t.onError=function(e){console.error(e)}}else{t.onConsoleMessage=function(e,t,n){console.log(JSON.stringify({message:e,lineNumber:t,source:n},null,4))};t.onError=function(e,t){console.error(JSON.stringify({message:e,stacktrace:t}))}}}else{t.onError=function(){}}if(yslowArgs.ua){t.settings.userAgent=yslowArgs.ua}if(yslowArgs.viewport){viewport=yslowArgs.viewport.toLowerCase();t.viewportSize={width:parseInt(viewport.slice(0,viewport.indexOf("x")),10)||t.viewportSize.width,height:parseInt(viewport.slice(viewport.indexOf("x")+1),10)||t.viewportSize.height}}if(yslowArgs.headers){try{t.customHeaders=JSON.parse(yslowArgs.headers)}catch(r){console.log("Invalid custom headers: "+r)}}t.startTime=new Date;t.open(e,function(e){if(e!=="success"){console.log("FAIL to load ");urlCount-=1;if(urlCount===0){phantom.exit()}}else{forcedRenderTimeout=setTimeout(function(){console.log(count);n()},maxRenderWait)}})})
